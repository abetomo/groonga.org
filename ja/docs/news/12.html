

<!DOCTYPE html>


<html lang="ja" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>お知らせ - 12系 &#8212; Groonga v13.0.6ドキュメント</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-7532323-1"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-7532323-1');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'news/12';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://groonga.org/docs/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'japanese';
        </script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ja"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://groonga.org/ja/">
  
  
  
  
    
    
      
    
    
    <img src="../_static/groonga.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/groonga.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="/ja/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-blog"></i></span>
            <label class="sr-only">Blog</label></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      japanese  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="/ja/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-blog"></i></span>
            <label class="sr-only">Blog</label></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      japanese  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">お知らせ - 12系</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="news-12-series">
<h1>お知らせ - 12系<a class="headerlink" href="#news-12-series" title="この見出しへのパーマリンク">#</a></h1>
<section id="release-12-1-2-2023-01-29">
<span id="release-12-1-2"></span><h2>12.1.2リリース - 2023-01-29<a class="headerlink" href="#release-12-1-2-2023-01-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="improvements">
<h3>改良<a class="headerlink" href="#improvements" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.3に更新しました。</p></li>
</ul>
</section>
</section>
<section id="release-12-1-1-2023-01-06">
<span id="release-12-1-1"></span><h2>12.1.1リリース - 2023-01-06<a class="headerlink" href="#release-12-1-1-2023-01-06" title="この見出しへのパーマリンク">#</a></h2>
<section id="id1">
<h3>改良<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>][<a class="reference internal" href="../reference/commands/select.html#select-drilldowns-label-key-vector-expansions-power-set"><span class="std std-ref">POWER_SET</span></a>] ドリルダウンでベクターのべき集合を集計できるようになりました。</p>
<p>ドリルダウンに 新しいオプション <code class="docutils literal notranslate"><span class="pre">key_vector_expansion</span></code> を追加しました。 <code class="docutils literal notranslate"><span class="pre">key_vector_expansion</span></code> は、ドリルダウン対象のキーがベクターのときに、キーの展開方法を指定します。 現状は、<code class="docutils literal notranslate"><span class="pre">key_vector_expansion</span></code> には <code class="docutils literal notranslate"><span class="pre">NONE</span></code> または <code class="docutils literal notranslate"><span class="pre">POWER_SET</span></code> が指定できます。</p>
<p><code class="docutils literal notranslate"><span class="pre">key_vector_expansion</span></code> に <code class="docutils literal notranslate"><span class="pre">POWER_SET</span></code> を指定することで、べき集合での集計ができるようになります。 この集計方法は、例えばタグの出現回数と、タグの組み合わせの出現回数を一度に集計したい場合に便利です。</p>
<p>以下は、 <code class="docutils literal notranslate"><span class="pre">Groonga</span></code> 、 <code class="docutils literal notranslate"><span class="pre">Mroonga</span></code> 、 <code class="docutils literal notranslate"><span class="pre">PGroonga</span></code> という３つのタグに対して、これらのタグの出現回数と、 これらの組み合わせの出現回数を集計するケースを考えます。</p>
<p>実行例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">PowersetDrilldownMemos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="n">PowersetDrilldownMemos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">PowersetDrilldownMemos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga uses Groonga!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;PGroonga uses Groonga!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;PGroonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga and PGroonga are Groonga family&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;PGroonga&quot;</span><span class="p">]}</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 4]</span>
<span class="n">select</span> <span class="n">PowersetDrilldownMemos</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">key_vector_expansion</span> <span class="n">POWER_SET</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">power_set</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">initial</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">power_set</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="n">_key</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">power_set</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">sort_keys</span> <span class="s1">&#39;power_set&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="s1">&#39;power_set, _nsubrecs&#39;</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="mi">0</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         4</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;tags&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ]</span>
<span class="c1">#     ],</span>
<span class="c1">#     {</span>
<span class="c1">#       &quot;tags&quot;: [</span>
<span class="c1">#         [</span>
<span class="c1">#           7</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;power_set&quot;,</span>
<span class="c1">#             &quot;Text&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;_nsubrecs&quot;,</span>
<span class="c1">#             &quot;Int32&quot;</span>
<span class="c1">#           ]</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Groonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           4</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Mroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           2</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;PGroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           2</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Groonga&quot;,</span>
<span class="c1">#             &quot;Mroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           2</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Groonga&quot;,</span>
<span class="c1">#             &quot;PGroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           2</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Mroonga&quot;,</span>
<span class="c1">#             &quot;PGroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           1</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;Groonga&quot;,</span>
<span class="c1">#             &quot;Mroonga&quot;,</span>
<span class="c1">#             &quot;PGroonga&quot;</span>
<span class="c1">#           ],</span>
<span class="c1">#           1</span>
<span class="c1">#         ]</span>
<span class="c1">#       ]</span>
<span class="c1">#     }</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>この集計結果から、以下のことがわかります。</p>
<table class="table">
<tbody>
<tr class="row-odd"><td><p>タグ</p></td>
<td><p>登場回数</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Groonga</span></code></p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Mroonga</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PGroonga</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Groonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">Mroonga</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Groonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">PGroonga</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Mroonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">PGroonga</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Groonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">Mroonga</span></code> かつ <code class="docutils literal notranslate"><span class="pre">PGroonga</span></code></p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>複雑な機能なので、 <a class="reference internal" href="../reference/commands/select.html#select-drilldowns-label-key-vector-expansions-power-set"><span class="std std-ref">POWER_SET</span></a> も合わせて参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] ベクターカラムの特定の要素のみを対象に検索できるようになりました。</p>
<p><code class="docutils literal notranslate"><span class="pre">match_columns</span></code> にベクターカラムの特定の要素をインデックス番号で指定することで、ベクターカラムの特定の要素のみを対象に検索できるようになりました。</p>
<p>以下はこの機能の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">contents</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Lexicon</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span>
<span class="n">column_create</span> <span class="n">Lexicon</span> <span class="n">memo_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span><span class="o">|</span><span class="n">WITH_SECTION</span> <span class="n">Memos</span> <span class="n">contents</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;contents&quot;</span><span class="p">],</span>
<span class="p">[[</span><span class="s2">&quot;I like Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Use Groonga with Ruby&quot;</span><span class="p">]],</span>
<span class="p">[[</span><span class="s2">&quot;I like Ruby&quot;</span><span class="p">,</span> <span class="s2">&quot;Use Groonga&quot;</span><span class="p">]]</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="s2">&quot;contents[1]&quot;</span> \
  <span class="o">--</span><span class="n">query</span> <span class="n">Ruby</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;contents, _score&quot;</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     0.0,</span>
<span class="c1">#     0.0</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;contents&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_score&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;I like Groonga&quot;,</span>
<span class="c1">#           &quot;Use Groonga with Ruby&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         1</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">--match_columns</span> <span class="pre">&quot;contents[1]&quot;</span></code> とすることで、 <code class="docutils literal notranslate"><span class="pre">contents</span></code> ベクターの第2要素のみを <code class="docutils literal notranslate"><span class="pre">--query</span></code> の対象にしています。この例では、 <code class="docutils literal notranslate"><span class="pre">[&quot;I</span> <span class="pre">like</span> <span class="pre">Groonga&quot;,</span> <span class="pre">&quot;Use</span> <span class="pre">Groonga</span> <span class="pre">with</span> <span class="pre">Ruby&quot;]</span></code> は第2要素 <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">Groonga</span> <span class="pre">with</span> <span class="pre">Ruby</span></code> に <code class="docutils literal notranslate"><span class="pre">Ruby</span></code> を含むのでヒットしていますが、 <code class="docutils literal notranslate"><span class="pre">[&quot;I</span> <span class="pre">like</span> <span class="pre">Ruby&quot;,</span> <span class="pre">&quot;Use</span> <span class="pre">Groonga&quot;]</span></code> は第2要素 <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">Groonga</span></code> に <code class="docutils literal notranslate"><span class="pre">Ruby</span></code> を含まないのでヒットしていません。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> 形式をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> は一般的な時間形式です。この形式をサポートしたことで、 <code class="docutils literal notranslate"><span class="pre">load</span></code> がより使いやすくなりました。</p>
<p>ロードされた値の時間部分は、現地時間の <code class="docutils literal notranslate"><span class="pre">00:00:00</span></code> になります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">time</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">table_create</span> <span class="n">Logs</span> <span class="n">TABLE_NO_KEY</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">created_at</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">created_at_text</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="c1"># [[0,0.0,0.0],1]</span>
<span class="n">select</span> <span class="n">Logs</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;time_format_iso8601(created_at), created_at_text&quot;</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     0.0,</span>
<span class="c1">#     0.0</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;time_format_iso8601&quot;,</span>
<span class="c1">#           null</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;created_at_text&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;2000-01-01T00:00:00.000000+09:00&quot;,</span>
<span class="c1">#         &quot;2000-01-01&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="fixes">
<h3>修正<a class="headerlink" href="#fixes" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">command_version</span></code> が <code class="docutils literal notranslate"><span class="pre">3</span></code> のとき、 <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> の結果のラベルが不正になる問題を修正しました。 [groonga-dev,05005][篠田さんの報告]</p>
<p>以下はこの機能の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Documents</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Documents</span> <span class="n">tag1</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Documents</span> <span class="n">tag2</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Documents</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;tag1&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;tag2&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Documents</span> <span class="o">--</span><span class="n">drilldown</span> <span class="n">tag1</span><span class="p">,</span><span class="n">tag2</span> <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;header&quot;: {</span>
<span class="c1">#     &quot;return_code&quot;: 0,</span>
<span class="c1">#     &quot;start_time&quot;: 1672123380.653039,</span>
<span class="c1">#     &quot;elapsed_time&quot;: 0.0005846023559570312</span>
<span class="c1">#   },</span>
<span class="c1">#   &quot;body&quot;: {</span>
<span class="c1">#     &quot;n_hits&quot;: 1,</span>
<span class="c1">#     &quot;columns&quot;: [</span>
<span class="c1">#       {</span>
<span class="c1">#         &quot;name&quot;: &quot;_id&quot;,</span>
<span class="c1">#         &quot;type&quot;: &quot;UInt32&quot;</span>
<span class="c1">#       },</span>
<span class="c1">#       {</span>
<span class="c1">#         &quot;name&quot;: &quot;tag1&quot;,</span>
<span class="c1">#         &quot;type&quot;: &quot;ShortText&quot;</span>
<span class="c1">#       },</span>
<span class="c1">#       {</span>
<span class="c1">#         &quot;name&quot;: &quot;tag2&quot;,</span>
<span class="c1">#         &quot;type&quot;: &quot;ShortText&quot;</span>
<span class="c1">#       }</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;records&quot;: [</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;1&quot;,</span>
<span class="c1">#         &quot;2&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;drilldowns&quot;: {</span>
<span class="c1">#       &quot;ctor&quot;: {</span>
<span class="c1">#         &quot;n_hits&quot;: 1,</span>
<span class="c1">#         &quot;columns&quot;: [</span>
<span class="c1">#           {</span>
<span class="c1">#             &quot;name&quot;: &quot;_key&quot;,</span>
<span class="c1">#             &quot;type&quot;: &quot;ShortText&quot;</span>
<span class="c1">#           },</span>
<span class="c1">#           {</span>
<span class="c1">#             &quot;name&quot;: &quot;_nsubrecs&quot;,</span>
<span class="c1">#             &quot;type&quot;: &quot;Int32&quot;</span>
<span class="c1">#           }</span>
<span class="c1">#         ],</span>
<span class="c1">#         &quot;records&quot;: [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;1&quot;,</span>
<span class="c1">#             1</span>
<span class="c1">#           ]</span>
<span class="c1">#         ]</span>
<span class="c1">#       },</span>
<span class="c1">#       &quot;tag2&quot;: {</span>
<span class="c1">#         &quot;n_hits&quot;: 1,</span>
<span class="c1">#         &quot;columns&quot;: [</span>
<span class="c1">#           {</span>
<span class="c1">#             &quot;name&quot;: &quot;_key&quot;,</span>
<span class="c1">#             &quot;type&quot;: &quot;ShortText&quot;</span>
<span class="c1">#           },</span>
<span class="c1">#           {</span>
<span class="c1">#             &quot;name&quot;: &quot;_nsubrecs&quot;,</span>
<span class="c1">#             &quot;type&quot;: &quot;Int32&quot;</span>
<span class="c1">#           }</span>
<span class="c1">#         ],</span>
<span class="c1">#         &quot;records&quot;: [</span>
<span class="c1">#           [</span>
<span class="c1">#             &quot;2&quot;,</span>
<span class="c1">#             1</span>
<span class="c1">#           ]</span>
<span class="c1">#         ]</span>
<span class="c1">#       }</span>
<span class="c1">#     }</span>
<span class="c1">#   }</span>
<span class="c1"># }</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> の実行結果の <code class="docutils literal notranslate"><span class="pre">drilldowns</span></code> 直後の <code class="docutils literal notranslate"><span class="pre">ctor</span></code> は、本来 <code class="docutils literal notranslate"><span class="pre">tag1</span></code> であるべきです。 この例では <code class="docutils literal notranslate"><span class="pre">tag1</span></code> ではなく <code class="docutils literal notranslate"><span class="pre">ctor</span></code> という値になっていますが、どのような値になるかは不定です。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a>] 特定の定義が <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> に存在する場合、Groongaがクラッシュすることがある問題を修正しました。 [GitHub:pgroonga/pgroonga#279][i10aさんの報告]</p>
<p>以下の例を考えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Normalizations</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Normalizations</span> <span class="n">normalized</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Normalizations</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Ⅰ&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Ⅱ&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Ⅲ&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">normalize</span> <span class="s1">&#39;NormalizerTable(&quot;normalized&quot;, &quot;Normalizations.normalized&quot;)&#39;</span>   <span class="s2">&quot;ⅡⅡ&quot;</span>
</pre></div>
</div>
<p>この問題は、以下の1.、2.、3.の条件を満たした時に発生します。</p>
<ol class="arabic">
<li><p>対象となるテーブルのキーがノーマライズされる</p>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">Normalizations</span></code> に <code class="docutils literal notranslate"><span class="pre">--normalizer</span> <span class="pre">NormalizerNFKC130</span></code> が指定されているので、この条件を満たしています。<code class="docutils literal notranslate"><span class="pre">Ⅰ</span></code> 、 <code class="docutils literal notranslate"><span class="pre">Ⅱ</span></code> 、 <code class="docutils literal notranslate"><span class="pre">Ⅲ</span></code> はそれぞれ <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> によって <code class="docutils literal notranslate"><span class="pre">i</span></code> 、 <code class="docutils literal notranslate"><span class="pre">ii</span></code> 、 <code class="docutils literal notranslate"><span class="pre">iii</span></code> にノーマライズされます。</p>
</li>
<li><p>ノーマライズされた文字列に他のノーマライズされた文字列が含まれている</p>
<p>上記のノーマライズ後の値を考えると、 <code class="docutils literal notranslate"><span class="pre">iii</span></code> が <code class="docutils literal notranslate"><span class="pre">ii</span></code> と <code class="docutils literal notranslate"><span class="pre">i</span></code> を含んでいるため、条件を満たしています。<code class="docutils literal notranslate"><span class="pre">ii</span></code> は <code class="docutils literal notranslate"><span class="pre">i</span></code> それぞれノーマライズ前の <code class="docutils literal notranslate"><span class="pre">Ⅱ</span></code> と <code class="docutils literal notranslate"><span class="pre">Ⅰ</span></code> に対応します。</p>
</li>
<li><p>2.の文字列を複数使用する</p>
<p><code class="docutils literal notranslate"><span class="pre">normaize</span></code> の対象である <code class="docutils literal notranslate"><span class="pre">ⅡⅡ</span></code> は <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> によって <code class="docutils literal notranslate"><span class="pre">iiii</span></code> にノーマライズされます。 この値に対して、 <code class="docutils literal notranslate"><span class="pre">Normalizations</span></code> の <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> によるノーマライズ後の値が一致条件として使用されてノーマライズされます。</p>
<p>したがって、 <code class="docutils literal notranslate"><span class="pre">iiii</span></code> を <code class="docutils literal notranslate"><span class="pre">Normalizations</span></code> でノーマライズしようとするときには、以下の順番でノーマライズされるため、この条件を満たしています。</p>
<ul>
<li><p>最初の <code class="docutils literal notranslate"><span class="pre">iii</span></code> （ <code class="docutils literal notranslate"><span class="pre">Ⅲ</span></code> に対応）</p>
<p><a class="reference internal" href="../reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> は最長共通接頭辞探索を行うため、 最初は <code class="docutils literal notranslate"><span class="pre">ii</span></code> や <code class="docutils literal notranslate"><span class="pre">i</span></code> ではなく <code class="docutils literal notranslate"><span class="pre">iii</span></code> が使用されます。</p>
</li>
<li><p>残りの <code class="docutils literal notranslate"><span class="pre">i</span></code> （ <code class="docutils literal notranslate"><span class="pre">Ⅰ</span></code> に対応）</p></li>
</ul>
</li>
</ol>
</li>
</ul>
</section>
<section id="thanks">
<h3>感謝<a class="headerlink" href="#thanks" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>i10aさん</p></li>
<li><p>篠田さん</p></li>
</ul>
</section>
</section>
<section id="release-12-1-0-2022-11-29">
<span id="release-12-1-0"></span><h2>12.1.0リリース - 2022-11-29<a class="headerlink" href="#release-12-1-0-2022-11-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id2">
<h3>改良<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] <code class="docutils literal notranslate"><span class="pre">load</span></code> のスローログの出力に対応しました。</p>
<p>この機能は、Groongaのパフォーマンスチューニングに使用します。例えば、 <code class="docutils literal notranslate"><span class="pre">load</span></code> が遅いときに、この機能を使うことで平均よりも時間がかかっているレコードを検出できます。</p>
<p>環境変数 <code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> を指定することで、スローログの出力が有効になります。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> については以下のとおりです。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> にはしきい値となる時間を秒単位で指定します。小数を指定することで、1秒よりも短い時間も指定できます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> で指定された時間よりも時間がかかっている処理がある場合、デバッグレベルのログが出力されます。</p></li>
</ul>
<p>ログレベルの設定は <a class="reference internal" href="../reference/executables/groonga.html#cmdoption-groonga-l"><code class="xref std std-option docutils literal notranslate"><span class="pre">log-level</span></code></a> オプションまたは <a class="reference internal" href="../reference/commands/log_level.html"><span class="doc">log_level</span></a> コマンドで変更可能です。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> にどのような値を指定すべきかは環境や調べたい内容に依存します。例えば、 <code class="docutils literal notranslate"><span class="pre">load</span></code> の件数と所要時間から、1レコードあたりの所要時間を求め、その値を指定することが考えられます。こうすることで、平均よりも <code class="docutils literal notranslate"><span class="pre">load</span></code> に時間がかかっているレコードを調べることができます。</p>
<p><code class="docutils literal notranslate"><span class="pre">load</span></code> の所要時間は <a class="reference internal" href="../reference/log.html#query-log"><span class="std std-ref">クエリーログ</span></a> から確認することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">27.139000</span><span class="o">|</span><span class="mi">000000</span><span class="n">CE63AFF640</span><span class="o">|&gt;</span><span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memo</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mf">40.841000</span><span class="o">|</span><span class="mi">000000</span><span class="n">CE63AFF640</span><span class="o">|</span><span class="p">:</span><span class="mi">000133702000000</span> <span class="n">load</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span> <span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">100000</span><span class="p">]</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mf">40.842000</span><span class="o">|</span><span class="mi">000000</span><span class="n">CE63AFF640</span><span class="o">|</span><span class="p">:</span><span class="mi">000133703000000</span> <span class="n">send</span><span class="p">(</span><span class="mi">46</span><span class="p">)</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mf">40.842000</span><span class="o">|</span><span class="mi">000000</span><span class="n">CE63AFF640</span><span class="o">|&lt;</span><span class="mi">000133703000000</span> <span class="n">rc</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>この例では、所要時間は以下のようになっています。</p>
<ul class="simple">
<li><p>レコード数: 100000件</p></li>
<li><p>所要時間: 2分13秒 = 133秒 （ <code class="docutils literal notranslate"><span class="pre">load</span></code> の開始時間 16:43:27 と <code class="docutils literal notranslate"><span class="pre">load</span></code> の終了時間（ <code class="docutils literal notranslate"><span class="pre">rc=0</span></code> ）16:43:40 に基づいています。 ）</p></li>
<li><p>1行あたりの所要時間: 0.00133 秒</p></li>
</ul>
<p>したがって、どのレコードが時間がかかっているのか調べるためには、 <code class="docutils literal notranslate"><span class="pre">GRN_SLOW_LOG_THRESHOLD</span></code> に <code class="docutils literal notranslate"><span class="pre">0.00133</span></code> を指定します。</p>
<p>スローログを有効化すると以下の悪影響があることに注意してください。</p>
<ul class="simple">
<li><p>パフォーマンスの悪化</p></li>
<li><p>ログサイズの肥大化</p></li>
</ul>
<p>そのため、必要な場合にのみこのスローログを有効にすることを推奨します。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_is_reference_count_enable()</span></code> を追加しました。</p>
<p>参照カウントモードが有効になっているかどうかの真偽値を返却します。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_set_reference_count_enable(bool</span> <span class="pre">enable)</span></code> を追加しました。</p>
<p>参照カウントモードの有効/無効を切り替えます。</p>
<p>安全のため、複数のテーブルを開いている場合は参照カウントモードを切り替えません。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_is_back_trace_enable()</span></code> を追加しました。</p>
<p>バックトレースの出力が有効になっているかどうかの真偽値を返却します。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/api.html"><span class="doc">API</span></a>] 新しいAPI <code class="docutils literal notranslate"><span class="pre">grn_set_back_trace_enable(bool</span> <span class="pre">enable)</span></code> を追加しました。</p>
<p>バックトレース(back trace)の出力の有効/無効を切り替えます。</p>
<p>バックトレースの出力時にクラッシュする環境があるため、その環境では無効化します。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">back_trace</span></code> と <code class="docutils literal notranslate"><span class="pre">/reference_count</span></code> を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">back_trace</span></code> はバックトレースの出力が有効になっているかどうかを真偽値で返却します。</p>
<p><code class="docutils literal notranslate"><span class="pre">/reference_count</span></code> は参照カウントモードが有効になっているかどうかを真偽値で返却します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">status</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1654237168.304533</span><span class="p">,</span>
    <span class="mf">0.0001480579376220703</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="p">(</span><span class="n">omitted</span><span class="p">)</span>
    <span class="s2">&quot;back_trace&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;reference_count&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id3">
<h3>修正<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>][<a class="reference internal" href="../reference/columns/vector.html"><span class="doc">ベクターカラム</span></a>] 重み付きベクターカラムで <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> を指定したとき、結果が整数で表示されていた問題を修正しました。</p>
<p>参照型の重み付きベクターカラムにはこの問題はなく、参照型ではない重み付きベクターカラムにだけこの問題がありました。</p>
<p>内部的な処理は浮動小数点数で行われていましたが、最終的な結果の表示が整数になっていました。</p>
<p>以下は、この問題の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> <span class="n">ShortText</span>
<span class="c1"># [[0,0.0,0.0],true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast&quot;</span><span class="p">,</span>
  <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;groonga&quot;</span><span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span>
    <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mf">1.2</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">]</span>
<span class="c1"># [[0,0.0,0.0],1]</span>
<span class="n">select</span> <span class="n">Memos</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     0.0,</span>
<span class="c1">#     0.0</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;tags&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;Groonga is fast&quot;,</span>
<span class="c1">#         {</span>
<span class="c1">#           &quot;groonga&quot;: 2,</span>
<span class="c1">#           &quot;full text search&quot;: 1</span>
<span class="c1">#         }</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tags</span></code> カラムが <code class="docutils literal notranslate"><span class="pre">ShortText</span></code> 型の重み付きベクターカラム、つまり参照型でない重み付きベクターカラムです。</p>
<p>この例の <code class="docutils literal notranslate"><span class="pre">select</span></code> の結果の以下の部分は、それぞれ2.8、1.2であるべきですが、2、1と誤った結果が返却されていました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;groonga&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>この修正により、以下のように正しい結果が返却されるようになりました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Memos</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     0.0,</span>
<span class="c1">#     0.0</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;tags&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;Groonga is fast&quot;,</span>
<span class="c1">#         {</span>
<span class="c1">#           &quot;groonga&quot;: 2.8,</span>
<span class="c1">#           &quot;full text search&quot;: 1.2</span>
<span class="c1">#         }</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="release-12-0-9-2022-10-28">
<span id="release-12-0-9"></span><h2>12.0.9リリース - 2022-10-28<a class="headerlink" href="#release-12-0-9-2022-10-28" title="この見出しへのパーマリンク">#</a></h2>
<section id="id4">
<h3>改良<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../install/almalinux.html"><span class="doc">AlmaLinux</span></a>] AlmaLinux 9 向けのパッケージをサポートしました。</p>
<p><a class="reference internal" href="#release-12-0-8"><span class="std std-ref">12.0.8リリース - 2022-10-03</span></a> でサポートしていましたが、アナウンスしていませんでした。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/escalate.html"><span class="doc">escalate</span></a>] <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数のドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> を追加しました。（実験的）</p>
<p><code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> はHTML用のノーマライザーです。</p>
<p>現在 <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> は <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> や <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> といったタグの削除と、<code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> や <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> といった文字参照の展開を行います。</p>
<p>以下は <code class="docutils literal notranslate"><span class="pre">NormalizerHTML</span></code> の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="n">NormalizerHTML</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666923364.883798</span><span class="p">,</span><span class="mf">0.0005481243133544922</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot; Groonga &amp; Mroonga &amp; Rroonga &quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> と <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> は削除され、 <code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> と <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> に展開されています。</p>
<p>タグを削除するかどうかは <code class="docutils literal notranslate"><span class="pre">remove_tag</span></code> オプションで指定できます。(<code class="docutils literal notranslate"><span class="pre">remove_tag</span></code> オプションのデフォルト値は <code class="docutils literal notranslate"><span class="pre">true</span></code> です。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="s1">&#39;NormalizerHTML(&quot;remove_tag&quot;, false)&#39;</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666924069.278549</span><span class="p">,</span><span class="mf">0.0001978874206542969</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;span&gt; Groonga &amp; Mroonga &amp; Rroonga &lt;/span&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> と <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code> は削除されていません。</p>
<p>文字参照を展開するかどうかは <code class="docutils literal notranslate"><span class="pre">expand_character_reference</span></code> オプションで指定できます。(<code class="docutils literal notranslate"><span class="pre">expand_character_reference</span></code> オプションのデフォルト値は <code class="docutils literal notranslate"><span class="pre">true</span></code> です。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> <span class="s1">&#39;NormalizerHTML(&quot;expand_character_reference&quot;, false)&#39;</span> <span class="s2">&quot;&lt;span&gt; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &lt;/span&gt;&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1666924357.099782</span><span class="p">,</span><span class="mf">0.0002346038818359375</span><span class="p">],{</span><span class="s2">&quot;normalized&quot;</span><span class="p">:</span><span class="s2">&quot; Groonga &amp;amp; Mroonga &amp;#38; Rroonga &quot;</span><span class="p">,</span><span class="s2">&quot;types&quot;</span><span class="p">:[],</span><span class="s2">&quot;checks&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal notranslate"><span class="pre">&amp;amp;</span></code> と <code class="docutils literal notranslate"><span class="pre">&amp;#38;</span></code> は展開されていません。</p>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.2に更新しました。</p>
<p>CVE-2022-41741とCVE-2022-41742のセキュリティの修正が含まれています。これらのセキュリティーの修正の詳細については、<a class="reference external" href="https://nginx.org/en/CHANGES">https://nginx.org/en/CHANGES</a> を参照してください。</p>
</li>
<li><p>メモリーが不足した際に、同じログが大量に出力されないように変更しました。</p>
<p>メモリーが不足した際に、 <code class="docutils literal notranslate"><span class="pre">mmap</span> <span class="pre">failed!!!!</span></code> というメッセージが大量にログが記載されることがありました。このメッセージを可能な限り重複してログ出力されないように改良しました。</p>
</li>
</ul>
</section>
<section id="id5">
<h3>修正<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <a class="reference internal" href="../reference/commands/select.html#select-n-workers"><span class="std std-ref">n_workers</span></a> を指定したとき、Groongaがクラッシュしたり、誤った結果を返すことがある問題を修正しました。</p>
<p>この問題は、 <a class="reference internal" href="../reference/commands/select.html#select-n-workers"><span class="std std-ref">n_workers</span></a> に <code class="docutils literal notranslate"><span class="pre">1</span></code> より大きい値を指定し、かつ同時に <code class="docutils literal notranslate"><span class="pre">drilldowns[{LABEL}].filter</span></code> を使用している場合に発生していました。</p>
<p>この問題は内部的な並列処理の際に、誤った値（オブジェクト）を参照していたことが原因で発生していました。そのため、上記の条件が満たされたとき、内部的に並列処理のタイミングによって、Groongaがクラッシュしたり誤った値を返すことがありました。</p>
</li>
</ul>
</section>
</section>
<section id="release-12-0-8-2022-10-03">
<span id="release-12-0-8"></span><h2>12.0.8リリース - 2022-10-03<a class="headerlink" href="#release-12-0-8-2022-10-03" title="この見出しへのパーマリンク">#</a></h2>
<section id="id6">
<h3>改良<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数（実験的）の仕様を使いやすいように変更しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> の外部の結果セットを使用しないように変更しました。</p>
<p>前回の仕様では、ユーザーはどのくらいの結果が <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> に渡されるのか推測して最初のしきい値を決める必要があり、不便でした。</p>
<p>以下は前回の <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number_column</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="n">escalate</span><span class="p">(</span><span class="n">THRESHOLD_1</span><span class="p">,</span> <span class="n">CONDITION_1</span><span class="p">,</span>
                               <span class="o">...</span><span class="p">,</span>
                               <span class="n">THRESHOLD_N</span><span class="p">,</span> <span class="n">CONDITION_N</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CONDITION1</span></code> は <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span></code> の結果が <code class="docutils literal notranslate"><span class="pre">THRESHOLD_1</span></code> 以下の時に実行されます。ユーザーは <code class="docutils literal notranslate"><span class="pre">THRESHOLD_1</span></code> を決めるのに <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span></code> がどのくらいの結果を返すのか推測する必要がありました。</p>
<p>今回のリリースから、ユーザーが <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span></code> がどのくらいの結果を返すのか推測する必要がなくなり、使いやすくなりました。</p>
<p>この変更により、 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> の構文が以下の通り変更されています。</p>
<p>前回の構文</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">escalate</span><span class="p">(</span><span class="n">THRESHOLD_1</span><span class="p">,</span> <span class="n">CONDITION_1</span><span class="p">,</span><span class="n">THRESHOLD_2</span><span class="p">,</span> <span class="n">CONDITION_2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">THRESHOLD_N</span><span class="p">,</span> <span class="n">CONDITION_N</span><span class="p">)</span>
</pre></div>
</div>
<p>新しい構文</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">escalate</span><span class="p">(</span><span class="n">CONDITION_1</span><span class="p">,</span> <span class="n">THRESHOLD_2</span><span class="p">,</span> <span class="n">CONDITION_2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">THRESHOLD_N</span><span class="p">,</span> <span class="n">CONDITION_N</span><span class="p">)</span>
</pre></div>
</div>
<p>以下は構文の変更の詳細です。</p>
<ul class="simple">
<li><p>最初の条件のためのしきい値は不要となりました。</p></li>
<li><p>引数の指定を必須としました。最初の条件が必須となります。</p></li>
<li><p>最初の引数を常に実行します。</p></li>
</ul>
<p>この関数は実験的な関数です。将来的にこれらの動作は変更になる可能性があります。</p>
</li>
<li><p>[<a class="reference internal" href="../install/cmake.html"><span class="doc">CMakeを使ってGroongaをビルドする方法</span></a>] CMakeを使ってビルドする方法を追加しました。</p></li>
<li><p>[<a class="reference internal" href="../install/others.html"><span class="doc">その他</span></a>] GNU Autotoolsを使ってビルドする場合に、Apache Arrowの機能を有効化/無効化する方法について追加しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <a class="reference internal" href="../reference/commands/select.html#select-drilldowns-label-table"><span class="std std-ref">drilldowns[${LABEL}].table</span></a> のドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="../contribution/documentation/i18n.html"><span class="doc">国際化</span></a>] 翻訳方法を更新しました。</p></li>
</ul>
</section>
<section id="id7">
<h3>修正<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><a class="reference internal" href="../reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> で冪等でない（繰り返し実行すると結果が変わることがある）定義をした時に、Groongaが誤った結果を返すことがある問題を修正しました。</p>
<p>これは、検索する値について、値を受け取った後と、トークナイズした後の二回ノーマライズしていたことが原因です。</p>
<p>Groongaはレコードを追加する時に、インデックス用のテーブルに設定したトークナイザーとノーマライザーを使って、登録するデータをトークナイズしてからノーマライズしています。検索する値についても、インデックス用のテーブルに設定したトークナイザーとノーマライザーを使って、トークナイズしてからノーマライズして、その後インデックスと照合します。両者は同じトークナイザーとノーマライザーを使うので、検索する値がインデックスに登録したデータと同じであれば、インデックスに格納されている状態と同じ状態になります。</p>
<p>しかし、いままでGroongaは検索する値だけを余分にノーマライズしていました。</p>
<p><a class="reference internal" href="../reference/normalizers/normalizer_auto.html"><span class="doc">NormalizerAuto</span></a> といった組み込みのノーマライザーは冪等である（繰り返し実行しても結果が変わらない）ため、この問題は発生しません。一方で、 <a class="reference internal" href="../reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> はユーザー自身がノーマライザーの定義をすることができます。そのため、冪等でない（繰り返し実行すると結果が変わることがある）定義をすることができました。</p>
<p><a class="reference internal" href="../reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a> に冪等でない定義が存在する場合、検索する値のみが余分にノーマライズされることで、インデックスに登録したデータと検索する値が一致しない場合がありました。</p>
<p>そのような場合、ヒットするはずのデータがヒットしなかったり、ヒットしないはずのデータがヒットしたりしていました。</p>
<p>以下はこの問題の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">ColumnNormalizations</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">ColumnNormalizations</span> <span class="n">target_column</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">ColumnNormalizations</span> <span class="n">normalized</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">ColumnNormalizations</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;target_column&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;target_column&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">table_create</span> <span class="n">Targets</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Targets</span> <span class="n">column_normalizations_target_column</span> <span class="n">COLUMN_INDEX</span> \
  <span class="n">ColumnNormalizations</span> <span class="n">target_column</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;c&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">table_create</span> \
  <span class="n">Terms</span> \
  <span class="n">TABLE_PAT_KEY</span> \
  <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram&#39;</span> \
  <span class="o">--</span><span class="n">normalizers</span> <span class="s1">&#39;NormalizerTable(&quot;normalized&quot;, </span><span class="se">\</span>
<span class="s1">                                &quot;ColumnNormalizations.normalized&quot;, </span><span class="se">\</span>
<span class="s1">                                &quot;target&quot;, </span><span class="se">\</span>
<span class="s1">                                &quot;target_column&quot;)&#39;</span>

<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">select</span> <span class="n">Memos</span> <span class="o">--</span><span class="n">query</span> <span class="n">content</span><span class="p">:</span><span class="nd">@a</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1664781132.892326</span><span class="p">,</span><span class="mf">0.03527212142944336</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span><span class="p">]],[</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">]]]]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">Memos</span> <span class="pre">--query</span> <span class="pre">content:&#64;a</span></code> の結果の期待値は <code class="docutils literal notranslate"><span class="pre">a</span></code> ですが、Groongaは <code class="docutils literal notranslate"><span class="pre">c</span></code> を返していました。これは、入力された <code class="docutils literal notranslate"><span class="pre">a</span></code> が <code class="docutils literal notranslate"><span class="pre">ColumnNormalizations</span></code> の定義にしたがって <code class="docutils literal notranslate"><span class="pre">b</span></code> にノーマライズされ、その後、 ノーマライズされた <code class="docutils literal notranslate"><span class="pre">b</span></code> を更に <code class="docutils literal notranslate"><span class="pre">c</span></code> にノーマライズしていたためです。結果的に、入力された <code class="docutils literal notranslate"><span class="pre">a</span></code> は <code class="docutils literal notranslate"><span class="pre">c</span></code> に変換され、 <code class="docutils literal notranslate"><span class="pre">Memos</span></code> テーブルの <code class="docutils literal notranslate"><span class="pre">{&quot;content&quot;:&quot;c&quot;}</span></code> にマッチしていました。</p>
</li>
</ul>
</section>
</section>
<section id="release-12-0-7-2022-08-29">
<span id="release-12-0-7"></span><h2>12.0.7リリース - 2022-08-29<a class="headerlink" href="#release-12-0-7-2022-08-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id8">
<h3>改良<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>新しい関数 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> を追加しました。(実験的)</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は既存のマッチエスカレーション( <a class="reference internal" href="../spec/search.html"><span class="doc">検索</span></a> )と似ています。この関数は、全ての条件で使えます。（既存のマッチエスカレーションは、一つの転置インデックスによる全文検索で使えます。）</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は検索結果の数を制限したい時に便利です。検索結果の数の制限は、 <code class="docutils literal notranslate"><span class="pre">--limit</span></code> でもできますが、 <code class="docutils literal notranslate"><span class="pre">--limit</span></code> は全ての条件を評価した後に評価されます。<code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は結果セットが <code class="docutils literal notranslate"><span class="pre">THRESHOLD</span></code> より多くのレコードを持っていたら、その時点で評価を終了します。つまり、 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は条件の評価の数を減らせる可能性があります。</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> の構文は以下の通りです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">escalate</span><span class="p">(</span><span class="n">THRESHOLD_1</span><span class="p">,</span> <span class="n">CONDITION_1</span><span class="p">,</span>
         <span class="n">THRESHOLD_2</span><span class="p">,</span> <span class="n">CONDITION_2</span><span class="p">,</span>
         <span class="o">...</span><span class="p">,</span>
         <span class="n">THRESHOLD_N</span><span class="p">,</span> <span class="n">CONDITION_N</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">THRESHOLD_N</span></code> は、0や29のような正の数です。 <code class="docutils literal notranslate"><span class="pre">CONDITION_N</span></code> は <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">29</span></code> のような <a class="reference internal" href="../reference/grn_expr/script_syntax.html"><span class="doc">スクリプト構文</span></a> を使った文字列です。</p>
<p>現在の結果セットのレコード数が <code class="docutils literal notranslate"><span class="pre">THRESHOLD_1</span></code> 以下の場合、 <code class="docutils literal notranslate"><span class="pre">CONDITION_1</span></code> が実行されます。同様に、 <code class="docutils literal notranslate"><span class="pre">CONDITION_1</span></code> 評価後の結果セットのレコード数が <code class="docutils literal notranslate"><span class="pre">THRESHOLD_2</span></code> 以下の場合、 <code class="docutils literal notranslate"><span class="pre">CONDITION_2</span></code> が実行されます。 <code class="docutils literal notranslate"><span class="pre">CONDITION_2</span></code> 評価後の結果セットのレコード数が <code class="docutils literal notranslate"><span class="pre">THRESHOLD_3</span></code> より大きい場合、 <code class="docutils literal notranslate"><span class="pre">escalate()</span></code> は終了します。</p>
<p>全ての <code class="docutils literal notranslate"><span class="pre">CONDITION</span></code> が実行された場合、 <code class="docutils literal notranslate"><span class="pre">escalate(THRESHOLD_1,</span> <span class="pre">CONDITION_1,</span> <span class="pre">...,</span> <span class="pre">THRESHOLD_N,</span> <span class="pre">CONDITION_N)</span></code> は <code class="docutils literal notranslate"><span class="pre">CONDITION_1</span> <span class="pre">||</span> <span class="pre">...</span> <span class="pre">||</span> <span class="pre">CONDITION_N</span></code> と同じです。</p>
<p><code class="docutils literal notranslate"><span class="pre">escalate()</span></code> 関数は、 <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">&amp;!</span></code> のような論理演算子と一緒に使えます。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>number_column &gt; 10 &amp;&amp; escalate(THRESHOLD_1, CONDITION_1,
                               ...,
                               THRESHOLD_N, CONDITION_N)
number_column &gt; 10 &amp;! escalate(THRESHOLD_1, CONDITION_1,
                               ...,
                               THRESHOLD_N, CONDITION_N)
</pre></div>
</div>
<p>これらは、 <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span> <span class="pre">&amp;&amp;</span> <span class="pre">(CONDITION_1</span> <span class="pre">||</span> <span class="pre">...</span> <span class="pre">||</span> <span class="pre">CONDITION_N)</span></code> と <code class="docutils literal notranslate"><span class="pre">number_column</span> <span class="pre">&gt;</span> <span class="pre">10</span> <span class="pre">&amp;!</span> <span class="pre">(CONDITION_1</span> <span class="pre">||</span> <span class="pre">...</span> <span class="pre">||</span> <span class="pre">CONDITION_N)</span></code> と同じです。</p>
<p>しかし、これらの挙動は使いにくいため変更される可能性があります。</p>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.23.1に更新しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--n_workers</span></code> オプションのドキュメントを追加しました。</p></li>
</ul>
</section>
<section id="id9">
<h3>修正<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>OR検索実行中に <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を実行した場合、Groongaの応答が遅くなることがある問題を修正しました。</p>
<p>OR検索の結果が多い場合や多くのOR条件をもつクエリー場合に、 &quot;request_cancel&quot; コマンドが原因でGroongaのレスポンスが遅くなることがあります。</p>
</li>
</ul>
</section>
</section>
<section id="release-12-0-6-2022-08-04">
<span id="release-12-0-6"></span><h2>12.0.6リリース - 2022-08-04<a class="headerlink" href="#release-12-0-6-2022-08-04" title="この見出しへのパーマリンク">#</a></h2>
<section id="id10">
<h3>改良<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>groonga-delta用の新しいMuninプラグインを追加しました。</p>
<p>このプラグインによって、以下の項目を監視できます。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-delta-import</span></code> がローカルのストレージ上の <code class="docutils literal notranslate"><span class="pre">.grn</span></code> ファイルをインポートできているかどうか。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-delta-import</span></code> がMySQLの差分データをインポートできているかどうか。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-delta-apply</span></code> がインポートしたデータを適用できているかどうか。</p></li>
<li><p>適用したデータの総サイズ。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/column_copy.html"><span class="doc">column_copy</span></a>] 重み付きベクターをサポートしました。</p>
<p>以下のように、重み付きベクターの値を <code class="docutils literal notranslate"><span class="pre">column_copy</span></code> でコピーできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">table_create</span> <span class="n">CopyFloat32Value</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">CopyFloat32Value</span> <span class="n">source_tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> <span class="n">Tags</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">CopyFloat32Value</span> <span class="n">destination_tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> <span class="n">Tags</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">CopyFloat32Value</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!!!&quot;</span><span class="p">,</span>
  <span class="s2">&quot;source_tags&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;Groonga&quot;</span><span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span>
    <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mf">1.5</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">]</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span>
<span class="n">column_copy</span> <span class="n">CopyFloat32Value</span> <span class="n">source_tags</span> <span class="n">CopyFloat32Value</span> <span class="n">destination_tags</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">select</span> <span class="n">CopyFloat32Value</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;destination_tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;source_tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is fast!!!&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;Groonga&quot;</span><span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span>
          <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mf">1.5</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;Groonga&quot;</span><span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span>
          <span class="s2">&quot;full text search&quot;</span><span class="p">:</span> <span class="mf">1.5</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.10 (Impish Indri) のサポートをやめました。</p>
<p>Ubuntu 21.10 は、2022年7月でEOLとなったためです。</p>
</li>
<li><p>[<a class="reference internal" href="../install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Debian 10 (buster) のサポートをやめました。</p>
<p>Debian 10 は、2022年8月でEOLとなるためです。</p>
</li>
</ul>
</section>
<section id="id11">
<h3>修正<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">n_workers</span></code> オプションを使ってドリルダウンを並行して実行したときにGroongaがクラッシュすることがある問題を修正しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--filter</span></code> に非常に長い式を指定するとシンタックスエラーになる問題を修正しました。</p>
<p>今まで <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 用のスタックサイズを100にしていたため発生していました。</p>
</li>
</ul>
</section>
</section>
<section id="release-12-0-5-2022-06-29">
<span id="release-12-0-5"></span><h2>12.0.5リリース - 2022-06-29<a class="headerlink" href="#release-12-0-5-2022-06-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id12">
<h3>改良<a class="headerlink" href="#id12" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 検索エスカレーションによる前方一致検索のパフォーマンスを少し改善しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">drilldowns[LABEL]._key</span></code> に重み付き参照ベクターカラムを指定できるようになりました。 [GitHub#1366][naoaさんがパッチ提供]</p>
<p>今までは、ドリルダウンのキーに重み付き参照ベクターカラムを指定すると、Groongaが誤った結果を返していました。</p>
<p>例えば、以下のタグ検索は、今まで誤った結果を返していました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span> <span class="n">Tags</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">date</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;sticker&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-17 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-17 00:00:00&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1656480220.591901</span><span class="p">,</span>
    <span class="mf">0.0005342960357666016</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;date&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;mysql&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">80</span><span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s2">&quot;sticker&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s2">&quot;ruby&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">8</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span>
          <span class="mi">5</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;f&quot;</span><span class="p">,</span>
          <span class="mi">5</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;f&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;f&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;f&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>今回のリリースから上記のクエリーは、以下のように正しい結果を返します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Memos</span>   <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span>   <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;date&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">80</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="mi">20</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">4</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span>
          <span class="mi">5</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">query</span></code> や <code class="docutils literal notranslate"><span class="pre">filter</span></code> や <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使っていても、ドリルダウンのキーに重み付き参照ベクターカラムを指定できるようになりました。 [GitHub#1367][naoaさんがパッチ提供]</p>
<p>今までは、 <code class="docutils literal notranslate"><span class="pre">query</span></code> や <code class="docutils literal notranslate"><span class="pre">filter</span></code> や <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使っているときに、ドリルダウンのキーに重み付き参照ベクターカラムを指定するとGroongaは誤った結果、またはエラーを返していました。</p>
<p>例えば、今まで以下のクエリーはエラーを返していました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span> <span class="n">Tags</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">date</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;sticker&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-16 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-17 00:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-17 00:00:00&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">post_filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="o">-</span><span class="mi">22</span><span class="p">,</span>
    <span class="mf">1656473820.734894</span><span class="p">,</span>
    <span class="mf">0.03771400451660156</span><span class="p">,</span>
    <span class="s2">&quot;[hash][add][           ] key size unmatch&quot;</span><span class="p">,</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;grn_hash_add&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hash.c&quot;</span><span class="p">,</span>
        <span class="mi">3405</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>今回のリリースから上記のクエリーは、以下のように正しい結果を返します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">post_filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tags</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;date&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">80</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span>
        <span class="mf">1416063600.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">:</span> <span class="mi">20</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span>
        <span class="mf">1416150000.0</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">:</span> <span class="mi">100</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">4</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span>
          <span class="mi">5</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;mysql&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;sticker&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;ruby&quot;</span><span class="p">,</span>
          <span class="mi">1</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="known-issues">
<h3>既知の問題<a class="headerlink" href="#known-issues" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id13">
<h3>感謝<a class="headerlink" href="#id13" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-12-0-4-2022-06-06">
<span id="release-12-0-4"></span><h2>12.0.4リリース - 2022-06-06<a class="headerlink" href="#release-12-0-4-2022-06-06" title="この見出しへのパーマリンク">#</a></h2>
<section id="id14">
<h3>改良<a class="headerlink" href="#id14" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 22.04 (Jammy Jellyfish)をサポートしました。</p></li>
<li><p><cite>groonga-benchmark</cite> の提供をやめました。</p>
<p>誰も使用しておらず、メンテナンスもできないためです。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">memory_map_size</span></code> を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">status</span></code> コマンドを使うことで、Groongaのメモリーマップサイズの合計を取得できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">status</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1654237168.304533</span><span class="p">,</span>
    <span class="mf">0.0001480579376220703</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="p">(</span><span class="n">omitted</span><span class="p">)</span>
    <span class="s2">&quot;memory_map_size&quot;</span><span class="p">:</span> <span class="mi">70098944</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>例えば、Windowsでは、Mroogaが物理メモリーとスワップ領域を使い果たした場合、それ以上メモリーをマップすることができません。そのため、この値を監視することで、メモリーが十分でない環境でもメモリーマップサイズを適切にコントロールできます。</p>
</li>
</ul>
</section>
<section id="id15">
<h3>修正<a class="headerlink" href="#id15" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>検索実行中に <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を実行した時Groongaの応答が遅くなることがある問題を修正しました。</p>
<p>特に、検索対象のレコード数が多い時に、Groongaの応答がとても遅くなることがあります。</p>
</li>
<li><p>文字列リストをint32のベクターにキャストできない問題を修正しました。</p>
<p>例えば、以下のキャストは失敗していました。</p>
<ul class="simple">
<li><p>[&quot;10&quot;, &quot;100&quot;] -&gt; [10, 100]</p></li>
</ul>
<p>この問題は、 <code class="docutils literal notranslate"><span class="pre">load</span></code> の引数として、 <code class="docutils literal notranslate"><span class="pre">input_type</span></code> に <code class="docutils literal notranslate"><span class="pre">apache-arrow</span></code> を指定したときのみ発生します。 この問題は、Groonga 12.0.2以降で発生します。</p>
</li>
<li><p>GroongaのMuninプラグインがAlmaLinux 8 とCentOS 7上で動作しない問題を修正しました。</p></li>
</ul>
</section>
</section>
<section id="release-12-0-3-2022-04-29">
<span id="release-12-0-3"></span><h2>12.0.3リリース - 2022-04-29<a class="headerlink" href="#release-12-0-3-2022-04-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id16">
<h3>改良<a class="headerlink" href="#id16" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> 実行中のメモリー使用量を改善しました。</p>
<p>いままで、Groongaは <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> 実行中に確保したオブジェクト(オブジェクトとは、テーブルやカラム、インデックスなどです。)と一時テーブルを <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> の実行完了まで保持し続けていました。</p>
<p>この機能によって、Groongaは、1つのシャードを処理した後すぐに参照を減らします。そのため、Groongaは、 <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> の実行中にメモリーを解放できるようになり、Groongaのメモリー使用量を削減できることがあります。</p>
<p>この機能は参照カウントモードのときのみ有効です。<code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> と設定することで、参照カウントモードを有効にできます。</p>
<p>加えて、Groongaは、この機能によって <code class="docutils literal notranslate"><span class="pre">logical_count</span></code> 実行中に一時テーブルを動的に解放します。そのため、Groongaのメモリー使用量を削減できます。この改善は、参照カウントモードが有効でなくても効果があります。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/dump.html"><span class="doc">dump</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE/MISSING_NIL</span></code> をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE/MISSING_NIL</span></code> を持つカラムがある場合、これらのカラムのダンプに失敗していました。このリリースから、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンドはこれらのカラムをサポートしました。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a>],[<a class="reference internal" href="../reference/functions/snippet_html.html"><span class="doc">snippet_html</span></a>] 入力としてベクターをサポートしました。[groonga-dev,04956][Reported by shinonon]</p>
<p>例えば、以下のようにJSONデータ内のベクターに対して検索キーワードの周辺テキストを抽出できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">contents</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Tokens</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_title</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">title</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_contents</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span><span class="o">|</span><span class="n">WITH_POSITION</span>   <span class="n">Entries</span> <span class="n">contents</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga and MySQL&quot;</span><span class="p">,</span>
  <span class="s2">&quot;contents&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span>\
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet_html(contents), contents&#39;</span>\
  <span class="o">--</span><span class="n">match_columns</span> <span class="s1">&#39;title&#39;</span>\
  <span class="o">--</span><span class="n">query</span> <span class="n">Groonga</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;contents&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt; is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on &lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt;&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>今までも、 <code class="docutils literal notranslate"><span class="pre">--output_columns</span> <span class="pre">'snippet_html(contents[1])'</span></code> のように <code class="docutils literal notranslate"><span class="pre">snippet*</span></code> を指定することで以下のようにベクターに対して検索キーワードの周辺テキストを抽出できますが、この方法ではどの要素を出力すればよいかわかりません。どの要素が検索にヒットしたかわからないためです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Entries</span>\
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet_html(contents[0]), contents&#39;</span>\
  <span class="o">--</span><span class="n">match_columns</span> <span class="s1">&#39;title&#39;</span>\
  <span class="o">--</span><span class="n">query</span> <span class="n">Groonga</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;contents&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt; is a full text search engine&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
          <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">vector_join</span></code>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">vector_join()</span></code> を追加しました。 [groonga-dev,04956][shinononさんの報告]</p>
<p>この関数は各要素を結合します。この関数の第二引数で区切り文字を指定できます。</p>
<p>例えば、以下のようにベクターに対して <code class="docutils literal notranslate"><span class="pre">snippet()</span></code> や <code class="docutils literal notranslate"><span class="pre">snippet_html()</span></code> を実行できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">vector</span>

<span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">contents</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Tokens</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_title</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">title</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">entries_contents</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span><span class="o">|</span><span class="n">WITH_POSITION</span>   <span class="n">Entries</span> <span class="n">contents</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga and MySQL&quot;</span><span class="p">,</span>
  <span class="s2">&quot;contents&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span>\
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet_html(vector_join(contents, &quot;</span><span class="se">\n</span><span class="s1">&quot;)), contents&#39;</span>\
  <span class="o">--</span><span class="n">match_columns</span> <span class="s1">&#39;title&#39;</span>\
  <span class="o">--</span><span class="n">query</span> <span class="n">Groonga</span> <span class="o">--</span><span class="n">output_pretty</span> <span class="n">yes</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1650849001.524027</span><span class="p">,</span>
    <span class="mf">0.0003361701965332031</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;contents&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt; is a full text search engine</span><span class="se">\n</span><span class="s2">MySQL is a RDBMS</span><span class="se">\n</span><span class="s2">Mroonga is a MySQL storage engine based on &lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;Groonga&lt;/span&gt;&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a full text search engine&quot;</span><span class="p">,</span><span class="s2">&quot;MySQL is a RDBMS&quot;</span><span class="p">,</span><span class="s2">&quot;Mroonga is a MySQL storage engine based on Groonga&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/indexing.html"><span class="doc">インデックス構築</span></a>] 動的インデックス構築のようにとても大きなトークンを無視するようにしました。 [GitHub:pgroonga/pgroonga#209][Zhanzhao (Deo) Liangさんの報告]</p>
<p>Groongaはエラーを発生しなくなり、静的インデックス構築を実行する時に大きなトークンを無視し警告を出力します。</p>
</li>
</ul>
</section>
<section id="id17">
<h3>修正<a class="headerlink" href="#id17" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>パトリシアトライのテーブルにキーを追加できなくなることがある問題を修正しました。</p>
<p>この問題は、以下の条件で発生します。</p>
<ul class="simple">
<li><p>パトリシアトライのテーブルにすでにキーがある場合。</p></li>
<li><p>4096バイトのキーを追加する場合。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id18">
<h3>既知の問題<a class="headerlink" href="#id18" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id19">
<h3>感謝<a class="headerlink" href="#id19" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>shinononさん</p></li>
<li><p>Zhanzhao (Deo) Liangさん</p></li>
</ul>
</section>
</section>
<section id="release-12-0-2-2022-03-29">
<span id="release-12-0-2"></span><h2>12.0.2リリース - 2022-03-29<a class="headerlink" href="#release-12-0-2-2022-03-29" title="この見出しへのパーマリンク">#</a></h2>
<section id="id20">
<h3>改良<a class="headerlink" href="#id20" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] シャードを処理した直後に参照を減らすようにしました。</p>
<p>今までGroongaは、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> 終了時にすべてのシャードの参照を減らしていました。この機能によって、Groongaは、シャードを処理した後すぐに参照を減らします。この機能によって、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> 実行中のメモリー使用量を削減できることがあります。</p>
<p>この機能は参照カウントモードのときのみ有効です。<code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> と設定することで、参照カウントモードを有効にできます。</p>
<p>通常、Groongaは一度でも開いたオブジェクト(テーブル、カラム、インデックスなど)をメモリ上に保持し続けますが、たくさんのオブジェクトを開いた場合、Groongaはたくさんのメモリーを使用します。参照カウントモードでは、どこからも参照されてないオブジェクトをメモリーから開放します。これにより、Groongaのメモリー使用量が減ることがあります。</p>
</li>
<li><p>クラッシュリカバリー機能の安定性が向上しました。</p>
<p>この機能は実験的で、デフォルトで無効です。したがって、以下の改良は。一般的なユーザーには影響ありません。</p>
<ul class="simple">
<li><p>Groongaがクラッシュしたときにインデックスが破損する問題を修正しました。</p></li>
<li><p>ロックが残留する問題を修正しました。</p></li>
<li><p>クラッシュリカバリー中にGroongaがクラッシュする問題を修正しました。</p></li>
</ul>
</li>
<li><p>無名マッピングが利用可能な時のmmapのパフォーマンスを向上しました。[GitHub:MariaDB/server#1999][David CARLIERさんの提案]</p>
<p>この改善によって、Groongaのパフォーマンスが少し向上します。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/indexing.html"><span class="doc">インデックス構築</span></a>] 以下のタイプのカラムで静的インデックス構築をサポートしました。</p>
<ul class="simple">
<li><p>非参照重み付きベクターカラム</p></li>
<li><p>参照重み付きベクターカラム</p></li>
<li><p>参照スカラーカラム</p></li>
</ul>
<p>これらのカラムは、いままで、静的インデックス構築をサポートしていませんでした。そのため、これらのカラムにデータをロードしたあとに、インデックスを構築しても、インデックスの構築時間が長くなっていました。この改良によって、このケースでインデックス構築時間が短くなります。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/column_create.html"><span class="doc">column_create</span></a>] 新しいフラグ <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">column_create</span></code> に以下の新しいフラグを追加しました。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_ADD</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_NIL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_ERROR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_WARN</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_IGNORE</span></code></p></li>
</ul>
</div></blockquote>
<p>通常、データカラムが参照データカラムで存在しないキーを指定された場合、自動的に存在しないキーを作成し、新しいレコードを作ります。</p>
<p>このGroongaが参照先のカラムにキーを自動的に追加する挙動は、タグ検索のような検索で便利です。Groongaがロード時に自動的にデータを追加してくれるためです。</p>
<p>しかしながら、この挙動は、キー以外の値が必要な場合に不便です。キーしか存在しないレコードがあるためです。</p>
<p>このリリースで追加したフラグを使ってこの挙動を変更できます。</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_ADD</span></code>: デフォルト値です。現在と同じ挙動になります。</p>
<p>データカラムが参照データカラムで、存在しないキーを指定された場合、自動的にキーを作成し、新しいレコードを追加します。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE</span></code>:</p>
<p>データカラムが参照データカラムで、存在しないキーを指定された場合、存在しないキーを無視します。参照データカラムがスカラーカラムの場合、値は <code class="docutils literal notranslate"><span class="pre">GRN_ID_NIL</span></code> になります。参照データカラムがベクターカラムの場合、以下のようにその要素のみを無視します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;existent1&quot;</span><span class="p">,</span> <span class="s2">&quot;nonexistent&quot;</span><span class="p">,</span> <span class="s2">&quot;existent2&quot;</span><span class="p">]</span> <span class="o">-&gt;</span>
<span class="p">[</span><span class="s2">&quot;existent1&quot;</span> <span class="s2">&quot;existent2&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MISSING_NIL</span></code>:</p>
<p>データカラムが参照データカラムで、存在しないキーを指定された場合、スカラーカラムとベクターカラムは存在しないキーを``GRN_ID_NIL`` として扱います。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;existent1&quot;</span><span class="p">,</span> <span class="s2">&quot;nonexistent&quot;</span><span class="p">,</span> <span class="s2">&quot;existent2&quot;</span><span class="p">]</span> <span class="o">-&gt;</span>
<span class="p">[</span><span class="s2">&quot;existent1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">(</span><span class="n">GRN_ID_NIL</span><span class="p">),</span> <span class="s2">&quot;existent2&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_ERROR</span></code>: デフォルト値です。 ベクターカラムのエラー応答を除いて、現在と同じ挙動になります。</p>
<p>無効な値を設定した場合(e.g.: <code class="docutils literal notranslate"><span class="pre">XXX</span></code> for <code class="docutils literal notranslate"><span class="pre">UInt8</span></code> scalar column)、設定操作をエラーとして扱います。データカラムがスカラーカラムの場合、 <code class="docutils literal notranslate"><span class="pre">load</span></code> は応答とログにエラーを報告します。データカラムがベクターカラムの場合、 <code class="docutils literal notranslate"><span class="pre">load</span></code> はログにエラーを報告しますが、応答にエラーを報告しません。これは非互換の変更です。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_WARN</span></code>:</p>
<p>無効な値を設定した場合(e.g.: <code class="docutils literal notranslate"><span class="pre">XXX</span></code> for <code class="docutils literal notranslate"><span class="pre">UInt8</span></code> scalar column)、警告メッセージをログに記録し、設定操作を無視します。対象のデータカラムが参照ベクターカラムの場合、<code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE</span></code> と <code class="docutils literal notranslate"><span class="pre">MISSING_NIL</span></code> を使って挙動を決定します。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID_IGNORE</span></code>:</p>
<p>無効な値を設定した場合(e.g.: <code class="docutils literal notranslate"><span class="pre">XXX</span></code> for <code class="docutils literal notranslate"><span class="pre">UInt8</span></code> scalar column)、設定操作を無視します。対象のデータカラムが参照ベクターカラムの場合、<code class="docutils literal notranslate"><span class="pre">MISSING_IGNORE</span></code> と <code class="docutils literal notranslate"><span class="pre">MISSING_NIL</span></code> を使って挙動を決定します。</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/dump.html"><span class="doc">dump</span></a>][<a class="reference internal" href="../reference/commands/column_list.html"><span class="doc">column_list</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> フラグをサポートしました。</p>
<p>これらのコマンドは、後方互換性を維持するため、 <code class="docutils literal notranslate"><span class="pre">MISSING_ADD</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_ERROR</span></code> フラグを表示しません。これらのフラグはデフォルトの挙動を表すためです。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/schema.html"><span class="doc">schema</span></a>] <code class="docutils literal notranslate"><span class="pre">MISSING_*</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_*</span></code> フラグをサポートしました。</p>
<p>後方互換性を維持するため、 <code class="docutils literal notranslate"><span class="pre">MISSING_AND</span></code> と <code class="docutils literal notranslate"><span class="pre">INVALID_ERROR</span></code> フラグを <code class="docutils literal notranslate"><span class="pre">flag</span></code> に表示しませんがそれぞれのカラムに、新しく <code class="docutils literal notranslate"><span class="pre">missing</span></code> と <code class="docutils literal notranslate"><span class="pre">invalid</span></code> キーが追加されます。</p>
</li>
<li><p>Amazon Linux 2向けのパッケージを提供するようにしました。</p></li>
<li><p>[Windows] Visual Studio 2017 でのビルドをやめました。</p>
<p>GitHub Actionsで windows-2016 のイメージが使えなくなったためです。</p>
</li>
</ul>
</section>
<section id="id21">
<h3>既知の問題<a class="headerlink" href="#id21" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id22">
<h3>感謝<a class="headerlink" href="#id22" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>David CARLIERさん</p></li>
</ul>
</section>
</section>
<section id="release-12-0-1-2022-02-28">
<span id="release-12-0-1"></span><h2>12.0.1リリース - 2022-02-28<a class="headerlink" href="#release-12-0-1-2022-02-28" title="この見出しへのパーマリンク">#</a></h2>
<section id="id23">
<h3>改良<a class="headerlink" href="#id23" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 同義語グループをサポートしました。</p>
<p>同義語検索をする場合、今までは、以下のようにキーワードとその同義語をそれぞれ定義していました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Thesaurus</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="n">Thesaurus</span> <span class="n">synonym</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Thesaurus</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;senna&quot;</span><span class="p">]}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>上記のケースでは、<code class="docutils literal notranslate"><span class="pre">mroonga</span></code> を検索した場合、 Groongaは、意図通り、 <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span> <span class="pre">を検索しますが、``tritonn</span></code> を検索した場合は、 Groongaは、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> のみを検索します。<code class="docutils literal notranslate"><span class="pre">tritonn</span></code> を検索した場合でも、<code class="docutils literal notranslate"><span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と検索した場合、以下のように定義を追加する必要がありました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Thesaurus</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;synonym&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tritonn&quot;</span><span class="p">,</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">]},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>多くのケースでは、 <code class="docutils literal notranslate"><span class="pre">mroonga</span></code> を <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開した場合、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> や <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> も <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開して欲しくなりますが、今までは、そのようなケースでは定義を追加する必要がありました。したがって、対象のキーワードに同義語がたくさんあると、同じような定義をたくさん定義する必要があるため、同義語の定義が煩雑でした。</p>
<p>加えて、同義語を削除する際も、多くのレコードを削除する必要があるので面倒でした。</p>
<p>今回のリリースから同義語の代表値を決めることで一つのグループを作れるようになりました。例えば、以下のすべてのキーワードは、 &quot;mroonga&quot; グループです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Synonyms</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Synonyms</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;tritonn&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;groonga mysql&quot;</span><span class="p">:</span> <span class="s2">&quot;representative&quot;</span><span class="p">:</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>このケースでは、 <code class="docutils literal notranslate"><span class="pre">mroonga</span></code> は <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開されます。また、 <code class="docutils literal notranslate"><span class="pre">tritonn</span></code> や <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> も <code class="docutils literal notranslate"><span class="pre">mroonga</span> <span class="pre">OR</span> <span class="pre">tritonn</span> <span class="pre">OR</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> と展開されます。</p>
<p>同義語を削除する際も、対象のレコードを削除するだけです。例えば、同義語から <code class="docutils literal notranslate"><span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;</span></code> を削除する場合は、 <code class="docutils literal notranslate"><span class="pre">{&quot;_key&quot;:</span> <span class="pre">&quot;groonga</span> <span class="pre">mysql&quot;:</span> <span class="pre">&quot;representative&quot;:</span> <span class="pre">&quot;mroonga&quot;}</span></code> を削除するだけです。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 同義語グループにベクターを使えるようにしました。</p>
<p>以下のように、同義語グループにベクターを使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">SynonymGroups</span> <span class="n">TABLE_NO_KEY</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">SynonymGroups</span> <span class="n">synonyms</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">table_create</span> <span class="n">Synonyms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">Synonyms</span> <span class="n">group</span> <span class="n">COLUMN_INDEX</span> <span class="n">SynonymGroups</span> <span class="n">synonyms</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">SynonymGroups</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;synonyms&quot;</span><span class="p">],</span>
<span class="p">[[</span><span class="s2">&quot;rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Ruby groonga&quot;</span><span class="p">]],</span>
<span class="p">[[</span><span class="s2">&quot;groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;mroonga&quot;</span><span class="p">]]</span>
<span class="p">]</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="mi">2</span><span class="p">]</span>
<span class="n">query_expand</span> <span class="n">Synonyms</span><span class="o">.</span><span class="n">group</span> <span class="s2">&quot;rroonga&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="s2">&quot;((rroonga) OR (Ruby groonga) OR (groonga) OR (rroonga) OR (mroonga))&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>環境変数によって、バックトレースを無効にできるようにしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_BACK_TRACE_ENABLE</span></code> を使うことで、バックトレースの出力を無効にできます。<code class="docutils literal notranslate"><span class="pre">GRN_BACK_TRACE_ENABLE=no</span></code> と設定すると、Groongaはバックトレースを出力しません。</p>
<p>Groongaはバックトレースをスタック領域に保持します。したがって、OSによっては、Groongaがスタック領域を使い切ってしまいクラッシュする可能性があります。<code class="docutils literal notranslate"><span class="pre">GRN_BACK_TRACE_ENABLE=no</span></code> を使うことで、このようなケースを避けることができます。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--slices</span></code> のパフォーマンスを改善しました。</p></li>
<li><p>[Windows] VisualStudio 2022 をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 近傍検索でそれぞれの要素ごとの距離を指定できるようになりました。</p>
<p>例えば、近傍フレーズ検索なら、フレーズごとに最大距離を指定できます。この機能は今後ドキュメント化されます。そのため、機能の詳細は後日、共有します。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] RPMパッケージのGroongaであっても、 <code class="docutils literal notranslate"><span class="pre">groonga-server-http</span></code> を使えるようにしました。</p></li>
</ul>
</section>
<section id="id24">
<h3>修正<a class="headerlink" href="#id24" title="この見出しへのパーマリンク">#</a></h3>
<ul class="simple">
<li><p>[Windows] Groongaがバックトレースを出力時にクラッシュする問題を修正しました。</p></li>
</ul>
</section>
<section id="id25">
<h3>既知の問題<a class="headerlink" href="#id25" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
</section>
<section id="release-12-0-0-2022-02-09">
<span id="release-12-0-0"></span><h2>12.0.0リリース - 2022-02-09<a class="headerlink" href="#release-12-0-0-2022-02-09" title="この見出しへのパーマリンク">#</a></h2>
<p>メジャーバージョンアップです! メジャーバージョンアップですが、互換性は壊れていないので、データベースを再構築することなく12.0.0へアップグレードできます。</p>
<p>まずはじめに Groonga 11.0.0 から 11.1.3 までの変更点を紹介します。次に、12.0.0の主な変更点を紹介します。</p>
<section id="summary-of-changes-from-groonga-11-0-0-to-11-1-3">
<h3>Groonga 11.0.0 から 11.1.3 までの主な変更点<a class="headerlink" href="#summary-of-changes-from-groonga-11-0-0-to-11-1-3" title="この見出しへのパーマリンク">#</a></h3>
<section id="new-features-and-improvements">
<h4>新規機能と改良<a class="headerlink" href="#new-features-and-improvements" title="この見出しへのパーマリンク">#</a></h4>
<ul>
<li><p>[<a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a>] 32個以上のキーワードを使えるようにしました。</p>
<p>いままで、 <code class="docutils literal notranslate"><span class="pre">snippet</span></code> は32個以上のキーワードを指定できませんでしたが、この改良によって、32個以上のキーワードを指定できます。</p>
<p>通常の使用では、 <code class="docutils literal notranslate"><span class="pre">snippet</span></code> に32以上のキーワードは指定しませんが、 <code class="docutils literal notranslate"><span class="pre">query_expand</span></code> などを使うことによって自動的にキーワードが増加したときに対象のキーワードが32以上になることがあります。</p>
<p>今までは、このようなケースでは、Groongaはエラーになっていましたが、この改良によって、エラーが発生しなくなります。</p>
<p>詳細は、 <a class="reference internal" href="11.html#release-11-1-3"><span class="std std-ref">release 11.1.3</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">remove_symbol</span></code> を追加しました。</p>
<p>このオプションは、正規化対象の文字列から記号(例えば #, !, &quot;, &amp;, % 等)を削除します。例えば、歌のタイトルやアーティスト名、お店の名前等の表記ゆれの防止に使えます。</p>
<p>詳細は、 <a class="reference internal" href="11.html#release-11-1-3"><span class="std std-ref">release 11.1.3</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] ISO 8601 形式をサポートしました。</p>
<p>ISO 8601形式は一般的なフォーマットです。より一般的な形式をサポートしたことによって <code class="docutils literal notranslate"><span class="pre">load</span></code> の使い勝手が良くなりました。</p>
<p>詳細は、 <a class="reference internal" href="11.html#release-11-1-0"><span class="std std-ref">release 11.1.0</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a>] 正規表現を使ってスニペットの区切り文字を見つける新しいオプション <code class="docutils literal notranslate"><span class="pre">delimiter_regexp</span></code> を追加しました。</p>
<p>この機能は検索結果を文で表示したい時に便利です。</p>
<p><a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a> は、検索キーワードの周辺のテキストを抽出します。 <a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a> で抽出したテキストをスニペットと呼びます。</p>
<p>通常、 <a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a> は、検索キーワードの周辺の200byteのテキストを返しますが、 <a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a> は、センテンスの区切りを考慮しません。スニペットは、複数のセンテンスで構成されることがあります。</p>
<p><code class="docutils literal notranslate"><span class="pre">delimiter_regexp</span></code> オプションは、検索キーワードと同じセンテンスのテキストのみを抽出したいときに便利です。例えば、 <code class="docutils literal notranslate"><span class="pre">\.\s*</span></code> を使って対象のセンテンス内のテキストのみを抽出できます。文字列は、 <code class="docutils literal notranslate"><span class="pre">\</span></code> でエスケープする必要があることに注意してください。</p>
<p>詳細は、 <a class="reference internal" href="11.html#release-11-0-9"><span class="std std-ref">release 11.0.9</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/cache_limit.html"><span class="doc">cache_limit</span></a>] <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行したときにクエリーキャッシュを削除するようにしました。</p>
<p>Groongaは内部的なテーブルにクエリーキャッシュを保存しています。このテーブルは、ハッシュテーブルなので、トータルのキーサイズは最大で4GiBです。そのため、もし多くの巨大なクエリーを実行した場合、トータルのキーサイズの最大値4GiBを超え、Groongaがクエリーをキャッシュできない可能性があります。このようなケースで、 <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行することで、クエリーキャッシュ用のテーブルをクリアーし、Groongaがクエリーキャッシュを保存できるようにします。</p>
<p>今まではこの問題を解消するには、Groongaを再起動する必要がありましたが、この改良によって、 <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行するだけで問題を解消できます。</p>
<p>詳細は、 <a class="reference internal" href="11.html#release-11-0-6"><span class="std std-ref">release 11.0.6</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/between.html"><span class="doc">between</span></a>] <code class="docutils literal notranslate"><span class="pre">between()</span></code> で、条件式の評価順序の最適化をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_EXPR_OPTIMIZE=yes</span></code> を設定することで、 <code class="docutils literal notranslate"><span class="pre">between()</span></code> で条件式の評価順序の最適化を使えます。この最適化は、 <code class="docutils literal notranslate"><span class="pre">between()</span></code> で十分にレコードを絞り込めるか、 <code class="docutils literal notranslate"><span class="pre">between()</span></code> でほとんどレコードを絞り込めない時に効果があります。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/log.html"><span class="doc">ログ</span></a>] 標準出力、標準エラー出力への出力をサポートしました。</p>
<p>この機能はDocker上でGroongaを実行する際に有用です。Dockerは標準で標準出力と標準エラー出力を記録する機能を持っています。したがって、Groongaのログを取得するために、Dockerの環境にログインする必要がなくなります。</p>
<p>詳細は、 <a class="reference internal" href="11.html#release-11-0-4"><span class="std std-ref">release 11.0.4</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] クエリー毎に <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> と <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> を無効にできるようになりました。</p>
<p>特定のクエリーでのみ <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> と <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> を無効にして検索できるようになりました。</p>
<p>この機能は、検索キーワードと正確に同じ語を検索したい時に便利です。通常、ステミングやストップワードの除去を有効にしたほうが良い結果を得られますが、検索キーワードと正確に同じ語を検索したい場合は、これらの機能は不要です。</p>
<p>今までは、検索キーワードと正確に同じ語を検索したい場合は、専用のインデックスを作る必要がありましたが、この改良によって、専用のインデックスを作らずに検索キーワードと正確に同じ語を検索できます。</p>
<p>詳細は、 <a class="reference internal" href="11.html#release-11-0-3"><span class="std std-ref">release 11.0.3</span></a> を参照してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/string_slice.html"><span class="doc">string_slice</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">string_slice</span></code> を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">string_slice()</span></code> は、検索結果の文字列から文字の位置や正規表現を使って、部分文字列を抽出します。この機能は、検索結果を編集したい時に便利です。</p>
<p>例えば、この機能は、検索結果からタグを除去するのに使えます。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>] クエリーを並行して実行できる新しい関数を追加しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> は query と似ていますが、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> は複数の OR 条件を並列に処理します。この機能を使うことで、大量のOR条件の実行速度を向上できます。</p>
<p>ただ、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> だけで複数のCPUを使います。したがって、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> と同時に実行しているクエリーは速度が低下する可能性があります。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/token_filters.html"><span class="doc">トークンフィルター</span></a>] オプションをつけた複数のトークンフィルターを使えるようにしました。</p>
<p>以下の例のように、オプション付きのトークンフィルターを複数使うことができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">token_filters</span> <span class="s1">&#39;TokenFilterStopWord(&quot;column&quot;, &quot;ignore&quot;), TokenFilterNFKC130(&quot;unify_kana&quot;, true)&#39;</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> と <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> と <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> を使うことで、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 実行後に再度フィルタリングすることができます。<code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> と <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> の違いは応答フォーマットです。</p>
<p><code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> の応答フォーマットは、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> と同じです。<code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> の応答フォーマットは <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> の実行前後の結果を出力します。</p>
<p><code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> の応答フォーマットは、通常の <code class="docutils literal notranslate"><span class="pre">select</span></code> の応答と異なることに注意してください。</p>
</li>
</ul>
</section>
<section id="id26">
<h4>修正<a class="headerlink" href="#id26" title="この見出しへのパーマリンク">#</a></h4>
<ul>
<li><p>Groongaが依存している arrow-libs がバージョンアップしたことによって、Groongaのバージョンアップが失敗する問題を修正しました。</p>
<p>ただし、 arrow-libs がメジャーバージョンアップした場合は、この問題は再発します。その場合は、Groongaパッケージを再構築して対応する予定です。</p>
<p>This bug only occurs AlmaLinux 8 and CentOS 7.</p>
</li>
<li><p>[Windows] メモリー不足によって、新しくファイルのオープンに失敗した時にリソースリークする問題を修正しました。</p></li>
<li><p>オプションをサポートしているトークナイザーやノーマライザー、トークンフィルターが使われている際、多くの検索クエリーを送信するとGroongaが応答を返さなくなることがある問題を修正しました。</p></li>
<li><p>インデックス内のデータを大量に追加、削除、更新した際にインデックスが破損することがある問題を修正しました。</p>
<p>この問題は、インデックス内のデータを大量に削除しただけでも発生します。ただ、インデックスにデータを追加しただけでは発生しません。</p>
<p>詳細は、 <a class="reference internal" href="11.html#release-11-0-0"><span class="std std-ref">release 11.0.0</span></a> を参照してください。</p>
</li>
</ul>
</section>
<section id="newly-supported-oses">
<h4>新しくサポートしたOS<a class="headerlink" href="#newly-supported-oses" title="この見出しへのパーマリンク">#</a></h4>
<ul class="simple">
<li><p>[<a class="reference internal" href="../install/almalinux.html"><span class="doc">AlmaLinux</span></a>] AlmaLinux 8 向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../install/almalinux.html"><span class="doc">AlmaLinux</span></a>] ARM64版 AlmaLinux 8 向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Debian 11 (Bullseye) をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] ARM64版 Debian 11 (Bullseye) と ARM64版 Debian 10 (buster) をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.10 (Impish Indri)をサポートしました。</p></li>
</ul>
</section>
<section id="dropped-support-oses">
<h4>サポートをやめたOS<a class="headerlink" href="#dropped-support-oses" title="この見出しへのパーマリンク">#</a></h4>
<ul class="simple">
<li><p>[<a class="reference internal" href="../install/centos.html"><span class="doc">CentOS</span></a>] CentOS 8のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.04 (Hirsute Hippo)のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 20.10 (Groovy Gorilla)のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 16.04 LTS (Xenial Xerus)のサポートをやめました。</p></li>
<li><p>[<a class="reference internal" href="../install/windows.html"><span class="doc">Windows</span></a>] Linux上のMinGWを使ってクロスコンパイルしていた以下のWindows向けパッケージの提供をやめました。</p>
<ul>
<li><p>groonga-x.x.x-x86.exe</p></li>
<li><p>groonga-x.x.x-x86.zip</p></li>
<li><p>groonga-x.x.x-x64.exe</p></li>
<li><p>groonga-x.x.x-x86.zip</p></li>
</ul>
</li>
</ul>
</section>
<section id="id27">
<h4>感謝<a class="headerlink" href="#id27" title="この見出しへのパーマリンク">#</a></h4>
<ul class="simple">
<li><p>naoaさん</p></li>
<li><p>Anthony M. Cookさん</p></li>
<li><p>MASUDA Kazuhiroさん</p></li>
<li><p>potiさん</p></li>
<li><p>Takashi Hashidaさん</p></li>
<li><p>higchiさん</p></li>
<li><p>wi24rdさん</p></li>
<li><p>Josep Sanzさん</p></li>
<li><p>Keitaro YOSHIMURAさん</p></li>
<li><p>shibanao4870さん</p></li>
</ul>
<p>12.0.0 の主な変更点は以下の通りです。</p>
</section>
</section>
<section id="id28">
<h3>改良<a class="headerlink" href="#id28" title="この見出しへのパーマリンク">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/functions/sub_filter.html"><span class="doc">sub_filter</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">pre_filter_threshold</span></code> を追加しました。</p>
<p>このオプションで、 <code class="docutils literal notranslate"><span class="pre">GRN_SUB_FILTER_PRE_FILTER_THRESHOLD</span></code> の値を変更できます。Groongaが <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> 実行時に レコード数が <code class="docutils literal notranslate"><span class="pre">GRN_SUB_FILTER_PRE_FILTER_THRESHOLD</span></code> 以下だった場合、Groongaは既に絞り込んだレコードに対して <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> を実行します。</p>
<p>-1にすると、常にこの最適化を有効にできます。</p>
</li>
<li><p>[index_column_have_source_record] 新しい関数 <code class="docutils literal notranslate"><span class="pre">index_column_have_source_record()</span></code> を追加しました。</p>
<p>インデックスに存在するトークンがGroongaに登録されているいずれかのレコードに含まれているかどうかを確認できます。</p>
<p>Groongaは、レコードの更新によってどのレコードからも使われていないトークンがあっても、それを削除しません。したがって、例えば、オートコンプリート機能を使っていると、検索候補としてどのレコードにも含まれていないトークンを返す可能性がありますが、この関数をつかうことで、不要なトークンを返さないようにできます。</p>
<p>この関数は、トークンがどのレコードにも含まれていないことを検出できるからです。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">strip</span></code> を追加しました。</p>
<p>このオプションは、先頭と末尾から空白を削除します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span> \
<span class="s1">&#39;NormalizerNFKC121(&quot;strip&quot;, true, </span><span class="se">\</span>
<span class="s1">                   &quot;report_source_offset&quot;, true)&#39;</span> \
<span class="s2">&quot;  hello world</span><span class="se">\t</span><span class="s2">! </span><span class="se">\t</span><span class="s2"> &quot;</span> \
<span class="n">WITH_CHECKS</span><span class="o">|</span><span class="n">WITH_TYPES</span>
 <span class="p">[</span>
   <span class="p">[</span>
     <span class="mi">0</span><span class="p">,</span>
     <span class="mf">0.0</span><span class="p">,</span>
     <span class="mf">0.0</span>
   <span class="p">],</span>
   <span class="p">{</span>
     <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;hello world!&quot;</span><span class="p">,</span>
     <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;others&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
       <span class="s2">&quot;alpha|blank&quot;</span><span class="p">,</span>
       <span class="s2">&quot;symbol|blank&quot;</span>
     <span class="p">],</span>
     <span class="s2">&quot;checks&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="mi">3</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="mi">2</span>
     <span class="p">],</span>
     <span class="s2">&quot;offsets&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="mi">0</span><span class="p">,</span>
       <span class="mi">3</span><span class="p">,</span>
       <span class="mi">4</span><span class="p">,</span>
       <span class="mi">5</span><span class="p">,</span>
       <span class="mi">6</span><span class="p">,</span>
       <span class="mi">7</span><span class="p">,</span>
       <span class="mi">8</span><span class="p">,</span>
       <span class="mi">9</span><span class="p">,</span>
       <span class="mi">10</span><span class="p">,</span>
       <span class="mi">11</span><span class="p">,</span>
       <span class="mi">12</span><span class="p">,</span>
       <span class="mi">14</span>
     <span class="p">]</span>
   <span class="p">}</span>
 <span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 新しい引数 <code class="docutils literal notranslate"><span class="pre">drilldown_max_n_target_records</span></code> と <code class="docutils literal notranslate"><span class="pre">drilldown[${LABEL}].max_n_target_records</span></code> を追加しました。</p>
<p>ドリルダウン対象のテーブル（フィルター結果）の中のうち最大で何レコードをドリルダウンに使うかを指定します。もし、フィルター結果のレコード数が指定した値より大きかったらフィルターした結果内のいくつかのレコードはドリルダウンには使われません。これらの引数のデフォルト値は、 <code class="docutils literal notranslate"><span class="pre">-1</span></code> です。これらの引数に <code class="docutils literal notranslate"><span class="pre">-1</span></code> がセットされた場合、Groongaは全てのレコードをドリルダウンに使います。</p>
<p>この機能はフィルター結果が非常に大きくなるかもしれない場合に有用です。大きなフィルター結果に対するドリルダウンは遅くなることがあるためです。この機能を使うことでドリルダウンに使うレコード数を制限できます。</p>
<p>以下はドリルダウンに使う最大レコード数を制限する例です。最後の2レコード（ <code class="docutils literal notranslate"><span class="pre">{&quot;_id&quot;:</span> <span class="pre">4,</span> <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;Senna&quot;}</span></code> と <code class="docutils literal notranslate"><span class="pre">{&quot;_id&quot;:</span> <span class="pre">5,</span> <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;Senna&quot;}</span></code> ）は使われていません。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">n_likes</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_key_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">_key</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;The first post!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Welcome! This is my first post!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I started to use Groonga. It&#39;s very fast!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I also started to use Mroonga. It&#39;s also very fast! Really fast!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Good-bye Senna&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I migrated all Senna system!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Senna&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span>    <span class="s2">&quot;Good-bye Tritonn&quot;</span><span class="p">,</span>
 <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I also migrated all Tritonn system!&quot;</span><span class="p">,</span>
 <span class="s2">&quot;n_likes&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Senna&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldown</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldown_max_n_target_records</span> <span class="mi">3</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Hello&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Groonga&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Groonga&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Senna&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Senna&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Hello&quot;</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="mi">2</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.6に更新しました。</p></li>
</ul>
</section>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-1-2-2023-01-29">12.1.2リリース - 2023-01-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improvements">改良</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-1-1-2023-01-06">12.1.1リリース - 2023-01-06</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fixes">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thanks">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-1-0-2022-11-29">12.1.0リリース - 2022-11-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-9-2022-10-28">12.0.9リリース - 2022-10-28</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-8-2022-10-03">12.0.8リリース - 2022-10-03</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-7-2022-08-29">12.0.7リリース - 2022-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-6-2022-08-04">12.0.6リリース - 2022-08-04</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-5-2022-06-29">12.0.5リリース - 2022-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#known-issues">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-4-2022-06-06">12.0.4リリース - 2022-06-06</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-3-2022-04-29">12.0.3リリース - 2022-04-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-2-2022-03-29">12.0.2リリース - 2022-03-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-1-2022-02-28">12.0.1リリース - 2022-02-28</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">既知の問題</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-12-0-0-2022-02-09">12.0.0リリース - 2022-02-09</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-changes-from-groonga-11-0-0-to-11-1-3">Groonga 11.0.0 から 11.1.3 までの主な変更点</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#new-features-and-improvements">新規機能と改良</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">修正</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#newly-supported-oses">新しくサポートしたOS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dropped-support-oses">サポートをやめたOS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">感謝</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">改良</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2009-2023 Groonga Project.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>