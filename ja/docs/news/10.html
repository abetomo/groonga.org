
<!DOCTYPE html>


<html lang="ja" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>お知らせ - 10系 &#8212; Groonga v14.0.3ドキュメント</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=a2cb1844"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4dbe4bdc"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-7532323-1"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-7532323-1');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-7532323-1');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'news/10';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://groonga.org/docs/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'japanese';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ja"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

   

<a class="navbar-brand logo" href="https://groonga.org/ja/">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/groonga.png" class="logo__image only-light" alt="Groonga v14.0.3ドキュメント - Home"/>
    <script>document.write(`<img src="../_static/groonga.png" class="logo__image only-dark" alt="Groonga v14.0.3ドキュメント - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">検索</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="/ja/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-blog fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Blog</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">検索</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="/ja/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-blog fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Blog</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">お知らせ - 10系</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="news-10-series">
<h1>お知らせ - 10系<a class="headerlink" href="#news-10-series" title="Link to this heading">#</a></h1>
<section id="release-10-1-1-2021-01-25">
<span id="release-10-1-1"></span><h2>10.1.1リリース - 2021-01-25<a class="headerlink" href="#release-10-1-1-2021-01-25" title="Link to this heading">#</a></h2>
<section id="improvements">
<h3>改良<a class="headerlink" href="#improvements" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] Apache Arrow形式でUInt64の値の出力をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] Apache Arrow形式で以下のようにヒット数の出力をサポートしました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">metadata</span> <span class="o">--</span>
<span class="n">GROONGA</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="n">hits</span><span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] &quot;order by estimated size&quot; の最適化をサポートしました。</p>
<ul class="simple">
<li><p>通常、ヒット数の少ない条件から最初に実行すると、高速に検索できます。</p>
<ul>
<li><p>&quot;A (ヒット数が多い) &amp;&amp; B (ヒット数が少ない)&quot; より &quot;B (ヒット数が少ない) &amp;&amp; A (ヒット数が多い)&quot; 方が高速です。</p></li>
</ul>
</li>
<li><p>これは、よく知られた最適化ですが、自分で条件を並び替える必要があります。</p></li>
<li><p>Groongaは、 &quot;order by estimated size&quot; の最適化を使うことで、自動的にこの並び替えを実行します。</p></li>
<li><p>この最適化は、 <code class="docutils literal notranslate"><span class="pre">GRN_ORDER_BY_ESTIMATED_SIZE_ENABLE=yes</span></code> で有効になります。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/between.html"><span class="doc">between</span></a>] 以下の改良で、パフォーマンスを改善しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">between()</span></code> でシーケンシャルサーチを使うかどうかの判断の精度を改善しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">between()</span></code> の結果を結果セットに一度にセットするよう改善しました。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 前方一致検索のパフォーマンスを改善しました。</p>
<ul>
<li><p>例えば、以下のような &quot;*&quot; を使った前方一致検索のパフォーマンスが向上します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">table_create</span> <span class="n">Contents</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Contents</span> <span class="n">entries_key_index</span> <span class="n">COLUMN_INDEX</span> <span class="n">Memos</span> <span class="n">_key</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;(groonga) Start to try!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;(mroonga) Installed&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;(groonga) Upgraded!&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">_key</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">(groonga</span><span class="se">\\</span><span class="s1">)*&#39;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/tokenizers.html"><span class="doc">トークナイザー</span></a>][TokenMecab] トークンカラムを並列で構築する際のパフォーマンスを改善しました。 [GitHub#1158][naoaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="fixes">
<h3>修正<a class="headerlink" href="#fixes" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/functions/sub_filter.html"><span class="doc">sub_filter</span></a>] <code class="docutils literal notranslate"><span class="pre">slices[].filter</span></code> 内で <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> が動作しない問題を修正しました。</p>
<ul>
<li><p>例えば、以下のクエリーでは、この問題によって、 <code class="docutils literal notranslate"><span class="pre">sub_filter</span></code> の結果は0件になります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">age</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt8</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">user</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Users</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>   <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">29</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>   <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;bye&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>   <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;yay&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">slices</span><span class="p">[</span><span class="n">adult</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span> <span class="s1">&#39;_id &gt; 1 &amp;&amp; sub_filter(user, &quot;age &gt;= 18&quot;)&#39;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>ハッシュテーブルに対して、繰り返し大量のデータを追加、削除すると、Groongaがクラッシュしたり、データの追加ができなくなる可能性がある問題を修正しました。</p></li>
</ul>
</section>
<section id="thanks">
<h3>感謝<a class="headerlink" href="#thanks" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-1-0-2020-12-29">
<span id="release-10-1-0"></span><h2>10.1.0リリース - 2020-12-29<a class="headerlink" href="#release-10-1-0-2020-12-29" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>改良<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/functions/highlight_html.html"><span class="doc">highlight_html</span></a>] 全角スペースをハイライト対処から除外しました。[PGroonga#GitHub#155][Hung Nguyen Vさんが報告]</p>
<ul>
<li><p>今までは、以下のように先頭の全角スペースも含めてハイライト対象としていました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">body</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">document_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">body</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga　高速！&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="n">output_columns</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">body</span> <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;高速&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;highlight_html(body)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;highlight_html&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&lt;span class=</span><span class="se">\&quot;</span><span class="s2">keyword</span><span class="se">\&quot;</span><span class="s2">&gt;　高速&lt;/span&gt;！&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>しかし、この全角スペースはハイライト対象としては不要です。そのため、このリリースから <code class="docutils literal notranslate"><span class="pre">highlight_html()</span></code> は先頭の全角スペースを削除します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">features</span></code> を追加しました。</p>
<ul>
<li><p>以下のように、Groongaのどの機能が有効なのかを表示できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">status</span> <span class="o">--</span><span class="n">output_pretty</span> <span class="n">yes</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="s2">&quot;alloc_count&quot;</span><span class="p">:</span> <span class="mi">361</span><span class="p">,</span>
    <span class="s2">&quot;starttime&quot;</span><span class="p">:</span> <span class="mi">1608087311</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mi">1608087311</span><span class="p">,</span>
    <span class="s2">&quot;uptime&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;10.1.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;n_queries&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;cache_hit_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;command_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;default_command_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;max_command_version&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;n_jobs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;nfkc&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;mecab&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;message_pack&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;mruby&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;onigmo&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;zlib&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;lz4&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;zstandard&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;kqueue&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;epoll&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;poll&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;rapidjson&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;apache_arrow&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;xxhash&quot;</span><span class="p">:</span> <span class="n">false</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/status.html"><span class="doc">status</span></a>] 新しい項目 <code class="docutils literal notranslate"><span class="pre">apache_arrow</span></code> を追加しました。</p>
<ul class="simple">
<li><p>以下のようにGroongaが使うApache Arrowのバージョンを表示できます。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1608088628.440753</span><span class="p">,</span>
    <span class="mf">0.0006628036499023438</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="s2">&quot;alloc_count&quot;</span><span class="p">:</span> <span class="mi">360</span><span class="p">,</span>
    <span class="s2">&quot;starttime&quot;</span><span class="p">:</span> <span class="mi">1608088617</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mi">1608088617</span><span class="p">,</span>
    <span class="s2">&quot;uptime&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.9-39-g5a4c6f3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;n_queries&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;cache_hit_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;command_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;default_command_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;max_command_version&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;n_jobs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;nfkc&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;mecab&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;message_pack&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;mruby&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;onigmo&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;zlib&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;lz4&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;zstandard&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;kqueue&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;epoll&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;poll&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;rapidjson&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;apache_arrow&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;xxhash&quot;</span><span class="p">:</span> <span class="n">false</span>
    <span class="p">},</span>
    <span class="s2">&quot;apache_arrow&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;version_major&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;version_minor&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;version_patch&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.0&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>この項目は、Apache Arrowが有効な場合にのみ表示されます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/window_function.html"><span class="doc">ウィンドウ関数</span></a>] 対象のテーブルがシャードをまたいでいる場合でも、全てのテーブルを一度に処理するようにしました。(実験的)</p>
<ul>
<li><p>今まで、対象のテーブルがシャードをまたいでいた場合、ウインドウ関数はシャード毎に処理をしていました。</p>
<ul>
<li><p>そのため、複数のグループキーを使う場合、2番目以降のグループキーの値は1種類でなければなりませんでした。</p></li>
<li><p>この改良によって、以下のように複数の種類の値を2番目以降のグループキーで使用できるようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">sharding</span>
<span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">time</span>

<span class="n">table_create</span> <span class="n">Logs_20170315</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Logs_20170315</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Logs_20170315</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Logs_20170315</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Logs_20170316</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Logs_20170316</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Logs_20170316</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Logs_20170316</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Logs_20170317</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Logs_20170317</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Logs_20170317</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Logs_20170317</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs_20170315</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/15 10:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/15 11:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/15 12:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/15 13:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs_20170316</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 10:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">530</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 11:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">520</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 12:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">110</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 13:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">410</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/16 14:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">710</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs_20170317</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/17 10:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">800</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/17 11:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/17 12:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017/03/17 13:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>  <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">table_create</span> <span class="n">Times</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">logs_20170315</span> <span class="n">COLUMN_INDEX</span> <span class="n">Logs_20170315</span> <span class="n">timestamp</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">logs_20170316</span> <span class="n">COLUMN_INDEX</span> <span class="n">Logs_20170316</span> <span class="n">timestamp</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">logs_20170317</span> <span class="n">COLUMN_INDEX</span> <span class="n">Logs_20170317</span> <span class="n">timestamp</span>

<span class="n">logical_range_filter</span> <span class="n">Logs</span> \
  <span class="o">--</span><span class="n">shard_key</span> <span class="n">timestamp</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;price &gt;= 300&#39;</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Time</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;timestamp - 39600000000&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_day</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_day</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Time</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_day</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">offsetted_day</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;time_classify_day(offsetted_timestamp)&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;window_count()&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">n_records_per_day_and_item</span><span class="p">]</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">group_keys</span> <span class="s1">&#39;offsetted_day,item&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;_id,time_format_iso8601(offsetted_day),item,n_records_per_day_and_item&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;UInt32&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;time_format_iso8601&quot;</span><span class="p">,</span>
        <span class="n">null</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;item&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;n_records_per_day_and_item&quot;</span><span class="p">,</span>
        <span class="s2">&quot;UInt32&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-14T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">1</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-15T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">3</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-15T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">1</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-15T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-16T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-16T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-16T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-16T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-17T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">3</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-17T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;B&quot;</span><span class="p">,</span>
      <span class="mi">2</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;2017-03-17T00:00:00.000000+09:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;A&quot;</span><span class="p">,</span>
      <span class="mi">1</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>この機能には、まだリリースされていない、Apache Arrow 3.0.0が必要です。</p></li>
</ul>
</li>
<li><p>参照カラムに対する検索でシーケンシャルサーチをサポートしました。</p>
<ul>
<li><p>この機能は、インデックス検索でたくさんのレコードがマッチした場合、かつ結果セットが十分小さい場合にのみ使われます。</p>
<ul class="simple">
<li><p>上記のケースでは、インデックス検索よりもシーケンシャルサーチの方が速いためです。</p></li>
</ul>
</li>
<li><p>この機能はデフォルトでは無効です。</p></li>
<li><p>この機能は、環境変数 <code class="docutils literal notranslate"><span class="pre">GRN_II_SELECT_TOO_MANY_INDEX_MATCH_RATIO_REFERENCE</span></code> を設定することで有効になります。</p></li>
<li><p>環境変数 <code class="docutils literal notranslate"><span class="pre">GRN_II_SELECT_TOO_MANY_INDEX_MATCH_RATIO_REFERENCE</span></code> はインデックス検索からシーケンシャルサーチに切り替えるためのしきい値です。</p>
<ul>
<li><p>例えば、以下のように <code class="docutils literal notranslate"><span class="pre">GRN_II_SELECT_TOO_MANY_INDEX_MATCH_RATIO_REFERENCE=0.7</span></code> とセットした場合、結果セットのレコード数が、総レコード数の70%以下の場合にシーケンシャルサーチで検索します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export GRN_II_SELECT_TOO_MANY_INDEX_MATCH_RATIO_REFERENCE=0.7

table_create Tags TABLE_HASH_KEY ShortText
table_create Memos TABLE_HASH_KEY ShortText
column_create Memos tag COLUMN_SCALAR Tags

load --table Memos
[
{&quot;_key&quot;: &quot;Rroonga is fast!&quot;, &quot;tag&quot;: &quot;Rroonga&quot;},
{&quot;_key&quot;: &quot;Groonga is fast!&quot;, &quot;tag&quot;: &quot;Groonga&quot;},
{&quot;_key&quot;: &quot;Mroonga is fast!&quot;, &quot;tag&quot;: &quot;Mroonga&quot;},
{&quot;_key&quot;: &quot;Groonga sticker!&quot;, &quot;tag&quot;: &quot;Groonga&quot;},
{&quot;_key&quot;: &quot;Groonga is good!&quot;, &quot;tag&quot;: &quot;Groonga&quot;}
]

column_create Tags memos_tag COLUMN_INDEX Memos tag

select Memos --query &#39;_id:&gt;=3 tag:@Groonga&#39; --output_columns _id,_score,_key,tag
[
  [
    0,
    0.0,
    0.0
  ],
  [
    [
      [
        2
      ],
      [
        [
          &quot;_id&quot;,
          &quot;UInt32&quot;
        ],
        [
          &quot;_score&quot;,
          &quot;Int32&quot;
        ],
        [
          &quot;_key&quot;,
          &quot;ShortText&quot;
        ],
        [
          &quot;tag&quot;,
          &quot;Tags&quot;
        ]
      ],
      [
        4,
        2,
        &quot;Groonga sticker!&quot;,
        &quot;Groonga&quot;
      ],
      [
        5,
        2,
        &quot;Groonga is good!&quot;,
        &quot;Groonga&quot;
      ]
    ]
  ]
]
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[tokenizers] <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorTFIDF</span></code> と <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorBM25</span></code> でトークンカラムをサポートしました。</p>
<ul>
<li><p>インデックスカラムと同じソースを持つトークンカラムがある場合、これらのトークナイザーは、トークンカラムのトークンIDを使います。</p>
<ul class="simple">
<li><p>トークンカラムは、既にトークナイズ済みのデータを持っています。</p></li>
<li><p>そのため、トークンカラムを使うことによって、これらのトークナイザーのパフォーマンスが改善されます。</p></li>
</ul>
</li>
<li><p>例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">content_tokens</span></code> というトークンカラムを作ることで、この機能を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a b c a&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;c b c&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;b b a&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a c c&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">table_create</span> <span class="n">Tokens</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>
<span class="n">column_create</span> <span class="n">Tokens</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content_tokens</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Tokens</span> <span class="n">content</span>

<span class="n">table_create</span> <span class="n">DocumentVectorBM25</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">Tokens</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> \
    <span class="s1">&#39;TokenDocumentVectorBM25(&quot;index_column&quot;, &quot;memos_content&quot;, </span><span class="se">\</span>
<span class="s1">                             &quot;df_column&quot;, &quot;df&quot;)&#39;</span>
<span class="n">column_create</span> <span class="n">DocumentVectorBM25</span> <span class="n">df</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content_feature</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> \
  <span class="n">DocumentVectorBM25</span> <span class="n">content</span>

<span class="n">select</span> <span class="n">Memos</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Text&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content_feature&quot;</span><span class="p">,</span>
          <span class="s2">&quot;DocumentVectorBM25&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content_tokens&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tokens&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;a b c a&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">0.5095787</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">0.6084117</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">0.6084117</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;a&quot;</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span><span class="p">,</span>
          <span class="s2">&quot;a&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;c b c&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">0.8342565</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">0.5513765</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;c&quot;</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;b b a&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">0.9430448</span><span class="p">,</span>
          <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">0.3326656</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;b&quot;</span><span class="p">,</span>
          <span class="s2">&quot;b&quot;</span><span class="p">,</span>
          <span class="s2">&quot;a&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;a c c&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">0.3326656</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">0.9430448</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;a&quot;</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span><span class="p">,</span>
          <span class="s2">&quot;c&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span>
        <span class="p">[</span>
          <span class="s2">&quot;a&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorTFIDF</span></code> と <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorBM25</span></code> は、各トークンに対して重みをつけます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorTFIDF</span></code> は、TF-IDFを使ってトークンの重みを計算します。</p>
<blockquote>
<div><ul class="simple">
<li><p>TF-IDFについては、 <a class="reference external" href="https://radimrehurek.com/gensim/models/tfidfmodel.html">https://radimrehurek.com/gensim/models/tfidfmodel.html</a> を参照してください。</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorBM25</span></code> は、Okapi BM25を使ってトークンの重みを計算します。</p>
<blockquote>
<div><ul class="simple">
<li><p>Okapi BM25については、 <a class="reference external" href="https://en.wikipedia.org/wiki/Okapi_BM25">https://en.wikipedia.org/wiki/Okapi_BM25</a> を参照してください。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li><p>以下のケースのパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;value&quot;)</span> <span class="pre">&amp;&amp;</span> <span class="pre">(column</span> <span class="pre">&#64;</span> <span class="pre">&quot;value&quot;)</span></code></p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 20.10 (Groovy Gorilla)をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] stretchのサポートをやめました。</p>
<ul class="simple">
<li><p>EOLになったためです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../install/centos.html"><span class="doc">CentOS</span></a>] CentOS 6のサポートをやめました。</p>
<ul class="simple">
<li><p>EOLになったためです。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.6に更新しました。</p></li>
</ul>
</section>
<section id="id2">
<h3>修正<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ul>
<li><p>以下のように、複数のドリルダウンのキーと複数のアクセサーを使用した時にGroongaがクラッシュする問題を修正しました。[GitHub#1153][naoaさんがパッチ提供]</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Tags</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">year</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Int32</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2019</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">,</span> <span class="s2">&quot;full-text-search&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2019</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span> <span class="s2">&quot;sticker&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2020</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2020</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;full-text-search&quot;</span><span class="p">],</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2020</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_id &gt; 0&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="s1">&#39;tags,year &gt;= 2020&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">_key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">_nsubrecs</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_id &gt; 0&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="s1">&#39;tags,year &gt;= 2020&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">_nsubrecs</span>
</pre></div>
</div>
</li>
<li><p>以下のように、同じフレーズが複数回出現すると、近傍フレーズ検索がマッチしない問題を修正しました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a x a x b x x&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;a x x b x&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;*NP2&quot;a b&quot;&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id3">
<h3>感謝<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Hung Nguyen Vさん</p></li>
<li><p>naoaさん</p></li>
<li><p>timgates42さん [GitHub#1155にてパッチ提供]</p></li>
</ul>
</section>
</section>
<section id="release-10-0-9-2020-12-01">
<span id="release-10-0-9"></span><h2>10.0.9リリース - 2020-12-01<a class="headerlink" href="#release-10-0-9-2020-12-01" title="Link to this heading">#</a></h2>
<section id="id4">
<h3>改良<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">limit</span></code> に <code class="docutils literal notranslate"><span class="pre">-1</span></code> を指定した時のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--auto_release_count</span></code> を追加しました。</p>
<ul>
<li><p>Groongaは、リクエストが <code class="docutils literal notranslate"><span class="pre">--auto_release_count</span></code> で指定された値に到達した時に自動的に参照カウントを減らします。</p></li>
<li><p>例えば、以下のように、取得した <code class="docutils literal notranslate"><span class="pre">User</span></code> の参照は、2番目の <code class="docutils literal notranslate"><span class="pre">status</span></code> が処理された後に自動的に解放されます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reference_acquire</span> <span class="o">--</span><span class="n">target_name</span> <span class="n">Users</span> <span class="o">--</span><span class="n">auto_release_count</span> <span class="mi">2</span>
<span class="n">status</span> <span class="c1"># Users is still referred.</span>
<span class="n">status</span> <span class="c1"># Users&#39; reference is released after this command is processed.</span>
</pre></div>
</div>
</li>
<li><p>このオプションで、取得した参照の解放漏れを防げます。</p></li>
</ul>
</li>
<li><p>Groongaが空の <code class="docutils literal notranslate"><span class="pre">vector</span></code> や <code class="docutils literal notranslate"><span class="pre">uvector</span></code> を評価した時の動作を変更しました。</p>
<ul class="simple">
<li><p>空の <code class="docutils literal notranslate"><span class="pre">vector</span></code> と <code class="docutils literal notranslate"><span class="pre">uvector</span></code> はcommand version 3では、 <code class="docutils literal notranslate"><span class="pre">false</span></code> と評価されます。</p>
<ul>
<li><p>この挙動はcommand version 3でのみ有効です。</p></li>
<li><p>今までとは挙動が異なることに注意してください。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] Unicode 13.0 の NFKC（Normalization Form Compatibility Composition）をベースにしたノーマライザー <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/token_filters.html"><span class="doc">トークンフィルター</span></a>] Unicode 13.0 の NFKC（Normalization Form Compatibility Composition）をベースにしたトークンフィルター <code class="docutils literal notranslate"><span class="pre">TokenFilterNFKC130</span></code> を追加しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">&quot;_score</span> <span class="pre">=</span> <span class="pre">column</span> <span class="pre">-</span> <span class="pre">X&quot;</span></code> のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>] <code class="docutils literal notranslate"><span class="pre">--recursive</span> <span class="pre">dependent</span></code> オプションを指定した時に必要のないインデックスカラムへの参照を取得しないように改善しました。</p>
<ul class="simple">
<li><p>今回のリリースから、 <code class="docutils literal notranslate"><span class="pre">--recursive</span> <span class="pre">dependent</span></code> の対象は、対象のテーブルのキーあるいはデータカラムに設定してあるインデックスカラムです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 順序限定の近傍フレーズ検索をサポートしました。</p>
<ul>
<li><p>今までの近傍フレーズ検索は、指定したフレーズ間の距離が近いレコードのみを探していました。</p></li>
<li><p>この機能は、以下の条件を満たすレコードを探します。</p>
<ul class="simple">
<li><p>指定したフレーズ間の距離が近い場合。</p></li>
<li><p>指定したフレーズが指定した順序で並んでいる場合。</p></li>
</ul>
</li>
<li><p>この機能は、 <code class="docutils literal notranslate"><span class="pre">*ONP</span></code> を演算子として使います。(<code class="docutils literal notranslate"><span class="pre">*NP</span></code> 演算子ではないことに注意してください。)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span></code> はクエリー構文では、 <code class="docutils literal notranslate"><span class="pre">$</span></code> そのものとして扱います。クエリー構文では、 <code class="docutils literal notranslate"><span class="pre">$</span></code> は特殊文字ではないことに注意してください。</p></li>
<li><p>スクリプト構文の場合、この機能は以下のように使用します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;unify_alphabet&quot;, false, </span><span class="se">\</span>
<span class="s1">                                  &quot;unify_digit&quot;, false)&#39;</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abcXYZdef&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abebcdXYZdef&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abcdef&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;defXYZabc&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;XYZabc&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc123456789def&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc12345678def&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;abc1de2def&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content *ONP &quot;abc def&quot;&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Text&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abcXYZdef&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abcdef&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abc12345678def&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abc1de2def&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>クエリー構文の場合、この機能は以下のように使用します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;content:*ONP &quot;abc def&quot;&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_score, content&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Text&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abcXYZdef&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abcdef&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abc12345678def&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;abc1de2def&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.5に更新しました。</p></li>
</ul>
</section>
<section id="id5">
<h3>修正<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="../reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] Groonga HTTP server が全てのワーカースレッドの完全な終了を待たずに終了していた問題を修正しました。</p>
<ul>
<li><p>今まで、Groonga HTTP server は、ワーカースレッドの処理が終了した後から、自身の終了処理を開始していました。しかし、このタイミングでは、ワーカースレッドは完全に終了していないことがあります。そのため、タイミングによってはGroonga HTTP serverがクラッシュすることがあります。Groonga HTTP server がワーカースレッドがまだ使用している領域を解放することがあるためです。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-10-0-8-2020-10-29">
<span id="release-10-0-8"></span><h2>10.0.8リリース - 2020-10-29<a class="headerlink" href="#release-10-0-8-2020-10-29" title="Link to this heading">#</a></h2>
<section id="id6">
<h3>改良<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 大きいサイズのドリルダウンのキーを使えるようになりました。</p>
<ul>
<li><p>Groongaのテーブルのキーサイズの最大は4KiBですが、複数のドリルダウンのキーを指定している場合、ドリルダウンのキーのサイズが4KiBを超える場合があります。</p>
<ul class="simple">
<li><p>例えば、以下のケースで、 <code class="docutils literal notranslate"><span class="pre">tag</span></code> キーと <code class="docutils literal notranslate"><span class="pre">n_like</span></code> キーのトータルサイズが4KiB以上だった場合、ドリルダウンは失敗します。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">tag</span><span class="p">,</span><span class="n">n_likes</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">n_likes</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tag</span><span class="p">,</span><span class="n">n_likes</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">n_likes</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_value</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span><span class="n">_value</span><span class="o">.</span><span class="n">n_likes</span><span class="p">,</span><span class="n">_nsubrecs</span>
</pre></div>
</div>
<ul class="simple">
<li><p>ドリルダウンは指定されている全てのキーを連結しているためです。そのため、ドリルダウンのキーそれぞれが大きい場合は、ドリルダウンのキーを連結したサイズが4KiB以上になります。</p></li>
</ul>
</li>
<li><p>この機能には、 <a class="reference external" href="https://github.com/Cyan4973/xxHash">xxHash</a> が必要です。</p>
<ul class="simple">
<li><p>ただ、Groongaをパッケージからインストールしている場合は、特に何もしなくてもこの機能を使えます。Groongaのパッケージには、すでに <a class="reference external" href="https://github.com/Cyan4973/xxHash">xxHash</a> が含まれているためです。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 異なるテーブルを参照しているカラムを同じ動的カラムで扱えるようにしました。</p>
<ul>
<li><p>従来、異なるテーブルを参照しているカラムは、同一の動的カラムでは扱えませんでした。カラムの型が異なるためです。</p></li>
<li><p>今回のバージョンから、以下のように異なるテーブルを参照しているカラムであってもビルトインの型にキャストすることで同じ動的カラムで扱うことができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Store_A</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">table_create</span> <span class="n">Store_B</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Customers</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">Int32</span>
<span class="n">column_create</span> <span class="n">Customers</span> <span class="n">customers_A</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Store_A</span>
<span class="n">column_create</span> <span class="n">Customers</span> <span class="n">customers_B</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Store_B</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Customers</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">1604020694</span><span class="p">,</span> <span class="s2">&quot;customers_A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]},</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">1602724694</span><span class="p">,</span> <span class="s2">&quot;customers_B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]},</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Customers</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_key == 1604020694&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">customers</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">output</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">customers</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">customers</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">customers</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;customers_A&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_key, customers&#39;</span>
</pre></div>
</div>
</li>
<li><p>今までは、 <code class="docutils literal notranslate"><span class="pre">Store_A</span></code> または <code class="docutils literal notranslate"><span class="pre">Store_B</span></code> を <code class="docutils literal notranslate"><span class="pre">customers</span></code> カラムの　<code class="docutils literal notranslate"><span class="pre">type</span></code>　に設定する必要がありました。</p></li>
<li><p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">customers_A</span></code> カラムの型は、 <code class="docutils literal notranslate"><span class="pre">ShortText</span></code> にキャストします。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">customers_A</span></code> のキーも <code class="docutils literal notranslate"><span class="pre">customers_B</span></code> のキーも <code class="docutils literal notranslate"><span class="pre">ShortText</span></code> 型であるため、これで <code class="docutils literal notranslate"><span class="pre">customers</span></code> カラムの値に <code class="docutils literal notranslate"><span class="pre">customers_B</span></code> の値も設定できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 検索結果のレコード数が非常に多い場合のパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>この最適化は、以下のケースで効果があります。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'column</span> <span class="pre">&lt;=</span> <span class="pre">&quot;value&quot;'</span></code> or <code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'column</span> <span class="pre">&gt;=</span> <span class="pre">&quot;value&quot;'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'column</span> <span class="pre">==</span> <span class="pre">&quot;value&quot;'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'between(...)'</span></code> または <code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'between(_key,</span> <span class="pre">...)'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'sub_filter(reference_column,</span> <span class="pre">...)'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'_key</span> <span class="pre">&gt;</span> <span class="pre">&quot;value&quot;'</span></code> のような <code class="docutils literal notranslate"><span class="pre">_key</span></code> に対する比較</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'geo_in_circle(...)'</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>バンドルしているLZ4を1.8.2から1.9.2に更新しました。</p></li>
<li><p>xxHash 0.8 をサポートしました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.4に更新しました。</p></li>
</ul>
</section>
<section id="id8">
<h3>修正<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>ブラウザーベースの管理ツール関連の問題を修正しました。　[GitHub#1139][sutaminさんの報告]</p>
<ul>
<li><p>Groongaのロゴが表示されない問題。</p></li>
<li><p>日本語のインデックスページにスループットグラフが表示されない問題。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/between.html"><span class="doc">between</span></a>] <code class="docutils literal notranslate"><span class="pre">between(_key,</span> <span class="pre">...)</span></code> が常にシーケンシャルサーチで評価される問題を修正しました。</p></li>
</ul>
</section>
<section id="id9">
<h3>感謝<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>sutaminさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-7-2020-09-29">
<span id="release-10-0-7"></span><h2>10.0.7リリース - 2020-09-29<a class="headerlink" href="#release-10-0-7-2020-09-29" title="Link to this heading">#</a></h2>
<section id="id10">
<h3>改良<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>[highlight], [<a class="reference internal" href="../reference/functions/highlight_full.html"><span class="doc">highlight_full</span></a>] ノーマライザーにオプションを指定できるようになりました。</p></li>
<li><p>[<a class="reference internal" href="../reference/command/return_code.html"><span class="doc">リターンコード</span></a>] 新しいリターンコード <code class="docutils literal notranslate"><span class="pre">GRN_CONNECTION_RESET</span></code> を追加しました。</p>
<ul>
<li><p>このリターンコードは、リモートホストから強制的に接続を切断されたときに返されます。</p></li>
</ul>
</li>
<li><p>Ubuntu 19.10(Eoan Ermine)のサポートをやめました。</p>
<ul>
<li><p>このバージョンはEOLになっているためです。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.2に更新しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/executables/grndb.html"><span class="doc">grndb</span></a>] キーの重複を検出できるようになりました。</p>
<ul>
<li><p>今回のリリースから、　<code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">check</span></code> でキーの重複も検出できるようになりました。</p></li>
<li><p>このチェックは、 <code class="docutils literal notranslate"><span class="pre">TABLE_NO_KEY</span></code> のテーブル以外で有効です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">check</span></code> で重複が検出されたテーブルにインデックスカラムしかない場合は、 <code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">recover</span></code> で復旧できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/table_create.html"><span class="doc">table_create</span></a>], [<a class="reference internal" href="../reference/commands/column_create.html"><span class="doc">column_create</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--path</span></code> を追加しました。</p>
<ul>
<li><p>このオプションによって指定したテーブルまたは、カラムを任意のパスに格納できます。</p></li>
<li><p>このオプションは、高速なストレージ(SSDなど)によく使うテーブルやカラムを格納し、低速なストレージ(HDDなど)にあまり使わないテーブルやカラムを格納したいときに有用です。</p></li>
<li><p>このオプションは、相対パス、絶対パスの両方が指定できます。</p>
<ul>
<li><p>相対パスを指定した場合は、 <code class="docutils literal notranslate"><span class="pre">groonga</span></code> プロセスのパスを起点に指定したパスが解決されます。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--path</span></code> を指定した場合、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンドの結果に <code class="docutils literal notranslate"><span class="pre">--path</span></code> の情報が含まれます。</p>
<ul>
<li><p>したがって、 <code class="docutils literal notranslate"><span class="pre">--path</span></code> を指定した場合、 異なる環境のホストではリストアできなくなります。</p>
<ul>
<li><p>これは、ディレクトリ構成や <code class="docutils literal notranslate"><span class="pre">groonga</span></code> プロセスの場所が環境ごとに異なるためです。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--path</span></code> の情報を <code class="docutils literal notranslate"><span class="pre">dump</span></code> に含みたくない場合は、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンド実行時に <code class="docutils literal notranslate"><span class="pre">--dump_paths</span> <span class="pre">no</span></code> を指定する必要があります。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/dump.html"><span class="doc">dump</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">--dump_paths</span></code> を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--dump_paths</span></code> オプションは、 <code class="docutils literal notranslate"><span class="pre">--path</span></code> をダンプするかどうかを制御します。</p></li>
<li><p>デフォルト値は <code class="docutils literal notranslate"><span class="pre">yes</span></code> です。</p></li>
<li><p>もし、テーブルやカラム作成時に <code class="docutils literal notranslate"><span class="pre">--path</span></code> を指定していて、 <code class="docutils literal notranslate"><span class="pre">--path</span></code> の情報を <code class="docutils literal notranslate"><span class="pre">dump</span></code> に含みたくない場合は、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンド実行時に <code class="docutils literal notranslate"><span class="pre">--dump_paths</span></code> に <code class="docutils literal notranslate"><span class="pre">no</span></code> を指定してください。</p></li>
</ul>
</li>
<li><p>新しい関数 <code class="docutils literal notranslate"><span class="pre">string_toknize()</span></code> を追加しました。</p>
<ul>
<li><p>この関数は、第二引数に指定されたカラムの値を、第一引数に指定されたトークナイザーでトークナイズします。</p></li>
</ul>
</li>
<li><p>[tokenizers] 新しいトークナイザー <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorTFIDF</span></code> を追加しました。(実験的)</p>
<ul>
<li><p>このトークナイザーは、TF-IDFで文書ベクトルを自動で生成します。</p></li>
</ul>
</li>
<li><p>[tokenizers] 新しいトークナイザー <code class="docutils literal notranslate"><span class="pre">TokenDocumentVectorBM25</span></code> を追加しました。(実験的)</p>
<ul>
<li><p>このトークナイザーは、BM25で文書ベクトルを自動で生成します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 同一センテンス内での、フレーズ近傍検索をサポートしました。</p></li>
</ul>
</section>
<section id="id11">
<h3>修正<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] 257個のカラムに対して <code class="docutils literal notranslate"><span class="pre">load</span></code> を実行すると <code class="docutils literal notranslate"><span class="pre">load</span></code> の応答が返らなくなる問題を修正しました。</p>
<ul>
<li><p>この問題は、10.0.4以降で発生する可能性があります。</p></li>
<li><p>この問題は、 <code class="docutils literal notranslate"><span class="pre">[a,</span> <span class="pre">b,</span> <span class="pre">c,</span> <span class="pre">...]</span></code> の形式でデータをロードした時にのみ発生します。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[{...}]</span></code> を使ってデータをロードした場合は発生しません。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[MessagePack] float32の値を正しくアンパックできない問題を修正しました。</p></li>
<li><p>マルチカラムインデックス関連の問題を修正しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">_score</span></code> の値が壊れることがあります。</p></li>
<li><p>ヒットしないはずのレコードがヒットすることがあります。</p></li>
<li><p>この問題の発生条件については、以下のURLを参照してください。</p>
<ul>
<li><p><a class="reference external" href="https://groonga.org/ja/blog/2020/09/29/groonga-10.0.7.html#multi-column-index">https://groonga.org/ja/blog/2020/09/29/groonga-10.0.7.html#multi-column-index</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
</section>
<section id="release-10-0-6-2020-08-29">
<span id="release-10-0-6"></span><h2>10.0.6リリース - 2020-08-29<a class="headerlink" href="#release-10-0-6-2020-08-29" title="Link to this heading">#</a></h2>
<section id="id12">
<h3>改良<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="../reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] 大きなデータの検索プランを改善しました。</p>
<ul>
<li><p>通常、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> より高速ですが、以下のケースでは、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> より遅くなっていました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> には要求されたレコード数をなかなか見つけられない場合にシーケンシャル検索からインデックス検索に切り替える機能があります。( <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は通常、検索対象のレコード数が多い場合は、シーケンシャル検索を使います。)</p></li>
<li><p>上記の切り替えが発生した場合は、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> と検索処理がほぼ同じになります。そのため、大きなデータを対象とした検索では、上記のケースで、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> の数倍遅くなります。なぜなら、 <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は検索後にソートを実行するためです。</p></li>
</ul>
</li>
<li><p>今回のリリースから、大きなデータを検索する場合に、今までよりシーケンシャル検索が採用されやすくしました。</p></li>
<li><p>これによって、 <code class="docutils literal notranslate"><span class="pre">logical_select</span></code> と同等の処理になるケースが減少し <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> のパフォーマンスが改善します。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.1に更新しました。</p></li>
<li><p>Debian GNU/Linux へのインストール方法を変更しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-archive-keyring</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">groonga-apt-source</span></code> を使うように変更しました。 <code class="docutils literal notranslate"><span class="pre">lintian</span></code> コマンドが <code class="docutils literal notranslate"><span class="pre">/etc/apt/sources.lists.d/</span></code> 配下にファイルを置くパッケージは <code class="docutils literal notranslate"><span class="pre">apt-source</span></code> を使うよう推奨しているためです。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lintian</span></code> コマンドはパッケージングに共通のエラーをチェックするためのコマンドです。</p></li>
<li><p>インストール方法についての詳細は、以下のURLも参照してください。</p>
<ul>
<li><p><a class="reference external" href="https://groonga.org/ja/docs/install/debian.html">https://groonga.org/ja/docs/install/debian.html</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/logical_select.html"><span class="doc">logical_select</span></a>] <code class="docutils literal notranslate"><span class="pre">highlight_html</span></code> と <code class="docutils literal notranslate"><span class="pre">highlight_full</span></code> をサポートしました。</p></li>
<li><p>値を持たない配列を削除した時、そのレコードのIDを再利用するようにしました。[GitHub#mroonga/mroonga#327][gaeeyoさんの報告]</p>
<ul>
<li><p>値を持たない配列を削除した場合、削除されたIDは再利用されません。</p></li>
<li><p>Groongaは大きなIDがあることによって、多くのストレージを使用します。大きなIDはそれだけで、多くのストレージを使うためです。</p>
<ul>
<li><p>大きなIDは、例えば、Mroongaの <code class="docutils literal notranslate"><span class="pre">mroonga_operations</span></code> のように多くの追加と削除によって発生します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] インデックスを設定していない全文検索のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/function.html"><span class="doc">関数</span></a>] 全ての引数が他のテーブルへの参照か、リテラルである関数のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/indexing.html"><span class="doc">インデックス構築</span></a>] トークンカラムを使った静的インデックス構築のパフォーマンスを改善しました。 [GitHub#1126][naoaさんがパッチ提供]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;_score</span> <span class="pre">=</span> <span class="pre">func(...)&quot;</span></code> のパフォーマンスを改善しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">_score</span></code> の値が <code class="docutils literal notranslate"><span class="pre">&quot;_score</span> <span class="pre">=</span> <span class="pre">func(...)&quot;</span></code> のように関数によってのみ算出される場合のパフォーマンスを改善しました。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id13">
<h3>修正<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>応答送信のエラーが発生した後の応答にゴミが含まれることがある問題を修正しました。</p>
<ul>
<li><p>これは、クライアントが全ての応答を読み込まずにコネクションがクローズされた場合に発生することがあります。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id14">
<h3>感謝<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>gaeeyoさん</p></li>
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-5-2020-07-30">
<span id="release-10-0-5"></span><h2>10.0.5リリース - 2020-07-30<a class="headerlink" href="#release-10-0-5-2020-07-30" title="Link to this heading">#</a></h2>
<section id="id15">
<h3>改良<a class="headerlink" href="#id15" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">-load_table</span></code> で指定したテーブルに参照を格納できるようにしました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--load-table</span></code> は予め用意したテーブルに検索結果を格納する機能です。</p>
<ul class="simple">
<li><p>複数回検索が実行される場合、このテーブルに結果を格納することで、検索結果をキャッシュできます。</p></li>
<li><p>このテーブルを使うことで、初回以降の検索時間を短縮できます。</p></li>
</ul>
</li>
<li><p>今回のリリース以降で、以下のようにこのテーブルに別のテーブルへの参照を格納できます。</p>
<ul class="simple">
<li><p>カラムの値を格納せず、参照のみを格納するため、このテーブルのサイズを小さくすることができます。</p></li>
<li><p>このテーブルに対して検索する場合、参照先のテーブルのインデックスを使って検索できます。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Logs</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>

<span class="n">table_create</span> <span class="n">Times</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">logs_timestamp</span> <span class="n">COLUMN_INDEX</span> <span class="n">Logs</span> <span class="n">timestamp</span>

<span class="n">table_create</span> <span class="n">LoadedLogs</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">Logs</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-03:1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-03 10:49:00&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-03:2&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-03 12:49:00&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-04:1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-02-04 00:00:00&quot;</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="n">Logs</span> \
  <span class="o">--</span><span class="n">load_table</span> <span class="n">LoadedLogs</span> \
  <span class="o">--</span><span class="n">load_columns</span> <span class="s2">&quot;_key&quot;</span> \
  <span class="o">--</span><span class="n">load_values</span> <span class="s2">&quot;_key&quot;</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="mi">0</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">LoadedLogs</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;timestamp &gt;= &quot;2015-02-03 12:49:00&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;2015-02-03:2&quot;</span><span class="p">,</span>
        <span class="mf">1422935340.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;2015-02-04:1&quot;</span><span class="p">,</span>
        <span class="mf">1422975600.0</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 以下のケースのソートのパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>多くのソートキーがID解決をする場合。</p>
<ul>
<li><p>例えば、以下の式はIDを解決する必要があります。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">true</span> <span class="pre">--sort_keys</span> <span class="pre">column</span></code></p></li>
</ul>
</li>
<li><p>例えば、以下の式はIDを解決する必要がありません。 擬似カラム <code class="docutils literal notranslate"><span class="pre">_score</span></code> は、結果テーブルに存在しており、ソーステーブルには存在しないためIDを解決する必要がありません。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">true</span> <span class="pre">--sort_keys</span> <span class="pre">_score</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>ソート対象のテーブルがキーを持っている場合。</p>
<ul>
<li><p>したがって、 <code class="docutils literal notranslate"><span class="pre">TABLE_NO_KEY</span></code> はこの改善をサポートしていません。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 以下のケースのパフォーマンスを少し改善しました。</p>
<ul class="simple">
<li><p>沢山のレコードがマッチする検索をしているケース。</p></li>
<li><p>沢山のレコードに対してドリルダウンするケース。</p></li>
</ul>
</li>
<li><p>[aggregator] score アクセサーをサポートしました。[GitHub#1120][naoaさんのパッチ提供]</p>
<ul>
<li><p>例えば、 以下のように <code class="docutils literal notranslate"><span class="pre">_score</span></code> を <code class="docutils literal notranslate"><span class="pre">aggregator_*</span></code> の対象にできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Book&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Note&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Box&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Food&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Drink&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="n">true</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span><span class="p">,</span><span class="n">score_mean</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">score_mean</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">group</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">score_mean</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">score_mean</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">score_mean</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;aggregator_mean(_score)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Book&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Note&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Box&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Food&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;C&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;Drink&quot;</span><span class="p">,</span>
        <span class="mi">300</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">3</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;score_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Float&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;A&quot;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mf">1.0</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;B&quot;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">,</span>
          <span class="mf">1.0</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;C&quot;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mf">1.0</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/indexing.html"><span class="doc">インデックス構築</span></a>] VC++版の静的インデックス構築のパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] JSON形式で出力する際に <code class="docutils literal notranslate"><span class="pre">NaN</span></code> や <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> 、 <code class="docutils literal notranslate"><span class="pre">-Infinity</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">null</span></code> を出力するようにしました。</p>
<ul class="simple">
<li><p>これらの値はJSONではサポートされていないためです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 標準偏差の集計をサポートしました。</p>
<ul>
<li><p>例えば、以下のようにグループごとの標準偏差を計算できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Book&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Note&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Box&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Food&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Drink&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span><span class="p">,</span><span class="n">price_sd</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sd</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">group</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sd</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sd</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sd</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;aggregator_sd(price)&#39;</span> \
  <span class="o">--</span><span class="n">output_pretty</span> <span class="n">yes</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1594339851.924836</span><span class="p">,</span>
    <span class="mf">0.002813816070556641</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Book&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Note&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Box&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Food&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="s2">&quot;C&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;Drink&quot;</span><span class="p">,</span>
        <span class="mi">300</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">3</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;price_sd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Float&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;A&quot;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mf">250.0</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;B&quot;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">,</span>
          <span class="mf">294.3920288775949</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;C&quot;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mf">0.0</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aggregate_sd(target,</span> <span class="pre">{&quot;unbiased&quot;:</span> <span class="pre">true})</span></code> と指定することで、不偏標準偏差も計算できます。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[Windows] Visual Studio 2013のサポートをやめました。</p></li>
</ul>
</section>
<section id="id16">
<h3>修正<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="../reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] 応答がエラーで中断された時に、 <code class="docutils literal notranslate"><span class="pre">shutdown?immediate</span></code> を実行しても、リクエストが中断しない問題を修正しました。</p></li>
<li><p>リクエスト中にエラーが発生した時にクラッシュする問題を修正しました。</p>
<ul>
<li><p>これは、Apache Arrow形式を使っている時にのみ発生します。</p></li>
<li><p>前のリクエストがエラーによって中断された後に再度Groongaへリクエストを送信した時にGroongaがクラッシュします。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/between.html"><span class="doc">between</span></a>] 一時テーブルを使用した時にクラッシュする問題を修正しました。</p>
<ul>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">between</span></code> の第一引数に動的カラムを指定すると、Groongaがクラッシュしていました。</p></li>
</ul>
</li>
<li><p>プラグインで作成したプロシージャーが予期せず解放される問題を修正しました。</p>
<ul>
<li><p>参照カウントモードでのみ発生します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plugin_register</span></code> を使っていない場合は、発生しません。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plugin_register</span></code> を実行したプロセスでは発生しません。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plugin_register</span></code> を実行していないプロセスで発生します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">token_column</span></code> を使った静的インデックス構築中に正規化エラーが発生する問題を修正しました。[GitHub#1122][naoaさんの報告]</p></li>
</ul>
</section>
<section id="id17">
<h3>感謝<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-4-2020-06-29">
<span id="release-10-0-4"></span><h2>10.0.4リリース - 2020-06-29<a class="headerlink" href="#release-10-0-4-2020-06-29" title="Link to this heading">#</a></h2>
<section id="id18">
<h3>改良<a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/tables.html"><span class="doc">テーブル</span></a>] ハッシュテーブルで4億件のレコードの登録をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">_score</span></code> が再帰的に値を取得しない時のパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>Groongaは、検索結果が検索対象の時に、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> の値を再帰的に取得します。</p></li>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">slices</span></code> は検索結果が検索対象です。したがって、 <code class="docutils literal notranslate"><span class="pre">slices</span></code> を使っているクエリーでは、この改善は効果がありません。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/log.html"><span class="doc">ログ</span></a>] ドリルダウンのキーをクエリーログに出力するようにしました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>], [<a class="reference internal" href="../reference/commands/reference_release.html"><span class="doc">reference_release</span></a>] 参照カウントモード用に新しいコマンドを追加しました。</p>
<ul class="simple">
<li><p>短い間隔で複数の <code class="docutils literal notranslate"><span class="pre">load</span></code> を呼び出す必要がある場合、参照カウントモードによる自動クローズによってパフォーマンスが低下します。</p></li>
<li><p>複数の <code class="docutils literal notranslate"><span class="pre">load</span></code> の前に <code class="docutils literal notranslate"><span class="pre">/reference_acquire</span></code> を呼び、 複数の <code class="docutils literal notranslate"><span class="pre">load</span></code> の後に <code class="docutils literal notranslate"><span class="pre">/reference_release</span></code> を呼ぶことで、このパフォーマンスの低下を避けることができます。<code class="docutils literal notranslate"><span class="pre">/reference_acquire</span></code> と <code class="docutils literal notranslate"><span class="pre">/reference_release</span></code> の間は自動クローズは無効になります。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/reference_acquire</span></code> が、対象のオブジェクトの参照を取得するためです。</p></li>
</ul>
</li>
<li><p>パフォーマンスに影響のある操作が完了したら、 <code class="docutils literal notranslate"><span class="pre">/reference_release</span></code> を呼ぶ必要があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/reference_release</span></code> を呼ばない場合、参照カウントモードは機能しません。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 一度の <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> で複数グループの集計をサポートしました。</p>
<ul>
<li><p>以下のように、一回の <code class="docutils literal notranslate"><span class="pre">drilldown</span></code> で異なるグループ毎に和と算術平均を計算できるようになりました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">quantity</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Book&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Note&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Box&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Food&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Drink&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span> <span class="n">tag</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_nsubrecs</span><span class="p">,</span><span class="n">price_sum</span><span class="p">,</span><span class="n">quantity_sum</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sum</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">group</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sum</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sum</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">price_sum</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;aggregator_sum(price)&#39;</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">quantity_sum</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">group</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">quantity_sum</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">quantity_sum</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">drilldowns</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">quantity_sum</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;aggregator_sum(quantity)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;quantity&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;Book&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Note&quot;</span><span class="p">,</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;Box&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="mi">15</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Pen&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="mi">12</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;Food&quot;</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="mi">111</span><span class="p">,</span>
        <span class="s2">&quot;C&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;Drink&quot;</span><span class="p">,</span>
        <span class="mi">300</span><span class="p">,</span>
        <span class="mi">22</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">3</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ShortText&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;_nsubrecs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Int32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;price_sum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UInt32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;quantity_sum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UInt32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;A&quot;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mi">1500</span><span class="p">,</span>
          <span class="mi">112</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;B&quot;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">,</span>
          <span class="mi">1800</span><span class="p">,</span>
          <span class="mi">47</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;C&quot;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mi">500</span><span class="p">,</span>
          <span class="mi">111</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/executables/groonga-httpd.html"><span class="doc">groonga-httpd</span></a>] スタンドアローンモードで、 <code class="docutils literal notranslate"><span class="pre">--pid-path</span></code> をサポートしました。</p>
<ul class="simple">
<li><p>以前のバージョンのスタンドアローンモードでは、 <code class="docutils literal notranslate"><span class="pre">--pid-path</span></code> は無視されていました。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/io_flush.html"><span class="doc">io_flush</span></a>] 参照カウントモードに対応しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>],[<a class="reference internal" href="../reference/commands/logical_count.html"><span class="doc">logical_count</span></a>] 参照カウントモードに対応しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/executables/groonga-server-http.html"><span class="doc">Groonga HTTPサーバー</span></a>] 最後のチャンクの後にヘッダーをつけないようにしました。</p>
<ul class="simple">
<li><p>最後のチャンクの後のヘッダーを無視するHTTPクライアントが存在する可能性があるためです。</p></li>
</ul>
</li>
<li><p>[vector_slice] <code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型のベクターをサポートしました。 [GitHub#1106 naoaさんがパッチ提供]</p></li>
<li><p>トークンカラムを使った、並列静的インデックス構築をサポートしました。</p>
<ul class="simple">
<li><p>予めトークナイズされたデータから複数スレッドで静的インデックスの構築ができるようになりました。</p></li>
<li><p>以下の環境変数で、並列静的インデックス構築のパラメータを調整できます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_TOKEN_COLUMN_PARALLEL_CHUNK_SIZE</span></code> : スレッド毎にどのくらいのレコードを処理するかを指定します。</p>
<ul>
<li><p>デフォルト値は <code class="docutils literal notranslate"><span class="pre">1024</span></code> レコードです。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_TOKEN_COLUMN_PARALLEL_TABLE_SIZE_THRESHOLD</span></code> : どのくらいのソースレコードで並列化するかを指定します。</p>
<ul>
<li><p>デフォルト値は <code class="docutils literal notranslate"><span class="pre">102400</span></code> レコードです。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 参照カウントモード時の <code class="docutils literal notranslate"><span class="pre">load_table</span></code> のパフォーマンスを改善しました。</p></li>
</ul>
</section>
<section id="id19">
<h3>修正<a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>シャードをまたいでいて、かつ <code class="docutils literal notranslate"><span class="pre">--filter</span></code> を指定していない動的カラムを使って検索すると、Gronngaのデータベースが破損する問題を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema</span></code> コマンドの結果に <code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型が表示されなかった問題を修正しました。</p></li>
<li><p>参照 <code class="docutils literal notranslate"><span class="pre">uvector</span></code> が要素を持っていないとき、 <code class="docutils literal notranslate"><span class="pre">_nsubrecs</span></code> を余分にカウントする問題を修正しました。</p></li>
</ul>
</section>
<section id="id20">
<h3>感謝<a class="headerlink" href="#id20" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-3-2020-05-29">
<span id="release-10-0-3"></span><h2>10.0.3リリース - 2020-05-29<a class="headerlink" href="#release-10-0-3-2020-05-29" title="Link to this heading">#</a></h2>
<section id="id21">
<h3>改良<a class="headerlink" href="#id21" title="Link to this heading">#</a></h3>
<ul>
<li><p>予めトークナイズされたデータから転置インデックスを構築できるようになりました。</p>
<ul>
<li><p>これにより、インデックスの構築が高速化します。</p></li>
<li><p>この改善を使うには、トークンカラムを準備する必要があります。</p></li>
<li><p>トークンカラムは、インデックスカラムのように自動で値が生成されます。</p></li>
<li><p>トークンカラムの値はソースカラムの値をトークナイズすることで生成されます。</p></li>
<li><p>トークンカラムは以下のようにソースカラムを設定することで作成できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>

<span class="n">table_create</span> <span class="n">Notes</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Notes</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="c1"># The last &quot;title&quot; is the source column.</span>
<span class="n">column_create</span> <span class="n">Notes</span> <span class="n">title_terms</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Terms</span> <span class="n">title</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 関数の引数に <code class="docutils literal notranslate"><span class="pre">vector</span></code> を指定できるようになりました。</p>
<ul>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">query</span></code> の <code class="docutils literal notranslate"><span class="pre">flags</span></code> オプションを <code class="docutils literal notranslate"><span class="pre">vector</span></code> を使って以下のように記述できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query(&quot;content&quot;, &quot;-content:@mroonga&quot;, </span><span class="se">\</span>
<span class="s1">                  { </span><span class="se">\</span>
<span class="s1">                    &quot;expander&quot;: &quot;QueryExpanderTSV&quot;, </span><span class="se">\</span>
<span class="s1">                    &quot;flags&quot;: [&quot;ALLOW_LEADING_NOT&quot;, &quot;ALLOW_COLUMN&quot;] </span><span class="se">\</span>
<span class="s1">                  })&#39;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 動的カラムに新しいステージ <code class="docutils literal notranslate"><span class="pre">result_set</span></code> を追加しました。</p>
<ul class="simple">
<li><p>このステージは、結果セットのテーブルにカラムを作ります。したがって、 <code class="docutils literal notranslate"><span class="pre">query</span></code> か <code class="docutils literal notranslate"><span class="pre">filter</span></code> が存在しない場合は作られません。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">query</span></code> や <code class="docutils literal notranslate"><span class="pre">filter</span></code> が存在しない場合は、結果セットのテーブルが作られないためです。</p></li>
</ul>
</li>
<li><p>このステージでは <code class="docutils literal notranslate"><span class="pre">_value</span></code> は使用できません。 <code class="docutils literal notranslate"><span class="pre">result_set</span></code> ステージの値は <code class="docutils literal notranslate"><span class="pre">score_column</span></code> に格納されます。</p></li>
</ul>
</li>
<li><p>[vector_slice] 重み付きベクターの重みに <code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型が使えるようになりました。  [GitHub#1106 naoaさんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] drilldownsの動的カラムのステージに <code class="docutils literal notranslate"><span class="pre">filtered</span></code> と <code class="docutils literal notranslate"><span class="pre">output</span></code> を追加しました。 [GitHub#1101 naoaさんがパッチ提供][GitHub#1100 naoaさんがパッチ提供]</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">drilldowns[Label].stage</span> <span class="pre">filtered</span></code> や <code class="docutils literal notranslate"><span class="pre">drilldowns[Label].stage</span> <span class="pre">output</span></code> のように drilldowns の動的カラムのステージに <code class="docutils literal notranslate"><span class="pre">filtered</span></code> と <code class="docutils literal notranslate"><span class="pre">output</span></code> を使えます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] ドリルダウンでの集計に <code class="docutils literal notranslate"><span class="pre">Float</span></code> 型の値をサポートしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MAX</span></code>、<code class="docutils literal notranslate"><span class="pre">MIN</span></code>、<code class="docutils literal notranslate"><span class="pre">SUM</span></code> を使って <code class="docutils literal notranslate"><span class="pre">Float</span></code> 型の値の最大値、最小値、合計値を集計できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] [<a class="reference internal" href="../reference/functions/geo_in_rectangle.html"><span class="doc">geo_in_rectangle</span></a>] [<a class="reference internal" href="../reference/functions/geo_in_circle.html"><span class="doc">geo_in_circle</span></a>] <code class="docutils literal notranslate"><span class="pre">query()</span></code> と <code class="docutils literal notranslate"><span class="pre">geo_in_rectangle()</span></code> と <code class="docutils literal notranslate"><span class="pre">geo_in_circle()</span></code> に新しいオプション <code class="docutils literal notranslate"><span class="pre">score_column</span></code> を追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">score_column</span></code> を使うことで条件毎にスコアの値を格納できます。</p></li>
<li><p>通常、Groongaは、全ての条件のスコアーを加算してスコアーを計算しますが、条件毎にスコアーの値を取得したいこともあります。</p></li>
<li><p>例えば以下のように、中心座標にどれだけ近いかをスコアーとして使いたい場合に <code class="docutils literal notranslate"><span class="pre">score_column</span></code> が使えます。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">LandMarks</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">LandMarks</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">LandMarks</span> <span class="n">category</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">LandMarks</span> <span class="n">point</span> <span class="n">COLUMN_SCALAR</span> <span class="n">WGS84GeoPoint</span>

<span class="n">table_create</span> <span class="n">Points</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">WGS84GeoPoint</span>
<span class="n">column_create</span> <span class="n">Points</span> <span class="n">land_mark_index</span> <span class="n">COLUMN_INDEX</span> <span class="n">LandMarks</span> <span class="n">point</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">LandMarks</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Aries&quot;</span>      <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;11x11&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Taurus&quot;</span>     <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Lighthouse&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;9x10&quot;</span> <span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Gemini&quot;</span>     <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Lighthouse&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;8x8&quot;</span>  <span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cancer&quot;</span>     <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;12x12&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Leo&quot;</span>        <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;11x13&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Virgo&quot;</span>      <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Temple&quot;</span>    <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;22x10&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Libra&quot;</span>      <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;14x14&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Scorpio&quot;</span>    <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Temple&quot;</span>    <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;21x9&quot;</span> <span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sagittarius&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Temple&quot;</span>    <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;43x12&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Capricorn&quot;</span>  <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;33x12&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Aquarius&quot;</span>   <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;mountain&quot;</span>  <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;55x11&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Pisces&quot;</span>     <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Tower&quot;</span>     <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;9x9&quot;</span>  <span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Ophiuchus&quot;</span>  <span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;mountain&quot;</span>  <span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="s2">&quot;21x21&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">LandMarks</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="s1">&#39;distance&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">distance</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">initial</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">distance</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">distance</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">distance</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="mf">0.0</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;name, category, point, distance, _score&#39;</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;geo_in_circle(point, &quot;11x11&quot;, &quot;11x1&quot;, {&quot;score_column&quot;: distance}) &amp;&amp; category == &quot;Tower&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1590647445.406149</span><span class="p">,</span>
    <span class="mf">0.0002503395080566406</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;category&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;point&quot;</span><span class="p">,</span>
          <span class="s2">&quot;WGS84GeoPoint&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;distance&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Float&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Aries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;11x11&quot;</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Cancer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;12x12&quot;</span><span class="p">,</span>
        <span class="mf">0.0435875803232193</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Leo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;11x13&quot;</span><span class="p">,</span>
        <span class="mf">0.06164214760065079</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Pisces&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;9x9&quot;</span><span class="p">,</span>
        <span class="mf">0.0871751606464386</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Libra&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tower&quot;</span><span class="p">,</span>
        <span class="s2">&quot;14x14&quot;</span><span class="p">,</span>
        <span class="mf">0.1307627409696579</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> によるソートは意味をなしません。 <code class="docutils literal notranslate"><span class="pre">category</span> <span class="pre">==</span> <span class="pre">&quot;Tower&quot;</span></code> によって、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> の値は全て <code class="docutils literal notranslate"><span class="pre">1</span></code> になるためです。しかし、 <code class="docutils literal notranslate"><span class="pre">socre_column</span></code> を使うことで、中心座標からの距離でソートできます。</p></li>
</ul>
</li>
<li><p>[Windows] クラッシュしていないくてもエラー時にはバックトレースが出力されるようになりました。</p></li>
<li><p>[Windows] 古いWindowsのサポートをやめました。</p>
<ul class="simple">
<li><p>10.0.3から、Windows 8 (Windows Server 2012) 以降を要求します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 参照可能なソートキーとそうでないソートキーが混在しているときのソートパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>参照可能なソートキーとそうでないソートキーが混在していて、参照可能なキーが2つ以上あるときのソートパフォーマンスを改善しました。</p>
<ul>
<li><p>参照可能なソートキーとは以下のソートキー以外のことです。</p>
<ul>
<li><p>圧縮されたカラム</p></li>
<li><p>ドリルダウンのキーに複数の値が指定されているドリルダウンの値を格納する <code class="docutils literal notranslate"><span class="pre">_value</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ShortText</span></code> 型のキーを持たないパトリシアトライテーブルの <code class="docutils literal notranslate"><span class="pre">_key</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_score</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>文字列以外のソートキーが多いほど、ソートに使用するメモリ使用量が少なくなります。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 全てのソートキーが参照可能なキーの時のソートのパフォーマンスを改善しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">_socre</span> <span class="pre">=</span> <span class="pre">column1*X</span> <span class="pre">+</span> <span class="pre">column2*Y</span> <span class="pre">+</span> <span class="pre">...</span></code> の場合のスコアラーのパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>この最適化は、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> 内に多くの <code class="docutils literal notranslate"><span class="pre">+</span></code> または <code class="docutils literal notranslate"><span class="pre">*</span></code> がある場合に効きます。</p></li>
<li><p>現状、 <code class="docutils literal notranslate"><span class="pre">+</span></code> と <code class="docutils literal notranslate"><span class="pre">*</span></code> に対してのみ効果があります。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] フレーズ近傍検索をサポートしました。</p>
<ul>
<li><p>フレーズ単位で近傍検索できます。</p>
<ul>
<li><p>フレーズ近傍検索のクエリー構文は、 <code class="docutils literal notranslate"><span class="pre">*NP&quot;Phrase1</span> <span class="pre">phrase2</span> <span class="pre">...&quot;</span></code> です。</p></li>
<li><p>フレーズ近傍検索のスクリプト構文は、 <code class="docutils literal notranslate"><span class="pre">column</span> <span class="pre">*NP</span> <span class="pre">&quot;phrase1</span> <span class="pre">phrase2</span> <span class="pre">...&quot;</span></code> です。</p></li>
<li><p>検索対象のフレーズにスペースを含む場合、 以下のようにフレーズを <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> で囲うことで検索できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;unify_alphabet&quot;, false, </span><span class="se">\</span>
<span class="s1">                                  &quot;unify_digit&quot;, false)&#39;</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC121</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">entries_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Entries</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I started to use Groonga. It&#39;s very fast!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I also started to use Groonga. It&#39;s also very fast! Really fast!&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content *NP &quot;</span><span class="se">\\</span><span class="s1">&quot;I started</span><span class="se">\\</span><span class="s1">&quot; </span><span class="se">\\</span><span class="s1">&quot;use Groonga</span><span class="se">\\</span><span class="s1">&quot;&quot;&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;content&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1590469700.715882</span><span class="p">,</span>
    <span class="mf">0.03997230529785156</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Text&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;I started to use Groonga. It&#39;s very fast!&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/columns/vector.html"><span class="doc">ベクターカラム</span></a>] 重み付きベクターの重みに <code class="docutils literal notranslate"><span class="pre">float32</span></code> 型を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">uint32</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">float32</span></code> として重みを格納できます。</p></li>
<li><p>この機能を使うには、 <code class="docutils literal notranslate"><span class="pre">column_create</span></code> 実行時に <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> フラグを追加する必要があります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">column_create</span> <span class="n">Records</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span><span class="o">|</span><span class="n">WEIGHT_FLOAT32</span> <span class="n">Tags</span>
</pre></div>
</div>
</li>
<li><p>今の所、 <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> フラグは、 <code class="docutils literal notranslate"><span class="pre">COLUMN_INDEX</span></code> フラグと併用できません。</p></li>
</ul>
</li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_xxx</span></code> 関数を追加しました。詳細は以下の通りです。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_weight_vector(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code></p>
<ul>
<li><p>重み付きベクターかどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_uvector(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">uvector</span></code> かどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">uvector</span></code> とは、要素のサイズが固定の <code class="docutils literal notranslate"><span class="pre">vector</span></code> です。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_weight_uvector(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code></p>
<ul>
<li><p>重み付きuvectorかどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_type_id_size(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_id</span> <span class="pre">id)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>Groongaのデータ型のサイズを <code class="docutils literal notranslate"><span class="pre">size_t</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_xxx</span></code> を追加しました。詳細は以下の通りです。</p>
<ul class="simple">
<li><p>これらの関数はセレクター関連のデータを返します。</p>
<ul>
<li><p>これらの関数はセレクターの中で呼び出すことを想定しています。セレクター以外の場所で呼び出された場合は、 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返します。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get(grn_ctx</span> <span class="pre">*ctx)</span></code></p>
<ul>
<li><p>セレクター呼び出しに関する全ての情報を <code class="docutils literal notranslate"><span class="pre">grn_selector_data</span> <span class="pre">*</span></code> 構造体として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_selector(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>セレクター自身を <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_expr(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>セレクターに使用されている、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 条件や <code class="docutils literal notranslate"><span class="pre">--query</span></code> 条件を <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_table(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>検索対象のテーブルを <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_index(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>セレクターに使われているインデックスを <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_args(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data,</span> <span class="pre">size_t</span> <span class="pre">*n_args)</span></code></p>
<ul>
<li><p>セレクターが呼び出した関数の引数を <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_result_set(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>結果テーブルを <code class="docutils literal notranslate"><span class="pre">grn_obj</span> <span class="pre">*</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_selector_data_get_op(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_selector_data</span> <span class="pre">*data)</span></code></p>
<ul>
<li><p>既存の結果セットに対してどう集合演算したかを <code class="docutils literal notranslate"><span class="pre">grn_operator</span></code> として返します。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_plugin_proc_xxx</span></code> 関数を追加しました。詳細は以下の通りです。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_plugin_proc_get_value_operator(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*value,</span> <span class="pre">grn_operator</span> <span class="pre">default_operator,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*context)</span></code></p>
<ul class="simple">
<li><p>クエリーオペレーターを <code class="docutils literal notranslate"><span class="pre">grn_operator</span></code> として返します。</p>
<ul>
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> は <code class="docutils literal notranslate"><span class="pre">GRN_OP_ANDP</span></code> として返されます。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_plugin_proc_get_value_bool(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*value,</span> <span class="pre">bool</span> <span class="pre">default_value,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*tag)</span></code></p>
<ul>
<li><p>以下の関数の引数 <code class="docutils literal notranslate"><span class="pre">with_transposition</span></code> のように <code class="docutils literal notranslate"><span class="pre">true</span></code> または <code class="docutils literal notranslate"><span class="pre">false</span></code> が指定される値を <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。( <code class="docutils literal notranslate"><span class="pre">bool</span></code> はC言語のデータ型です。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fuzzy_search</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;max_distance&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;prefix_length&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max_expansion&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;with_transposition&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">})</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_options_xxx</span></code> 関数を追加しました。詳細は以下の通りです。</p>
<ul class="simple">
<li><p>これらは、 <code class="docutils literal notranslate"><span class="pre">query()</span></code> でのみ使えます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_options_parsev(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*options,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*tag,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name,</span> <span class="pre">va_list</span> <span class="pre">args)</span></code> を追加しました。</p>
<ul>
<li><p>オプションのパースを実行します。</p></li>
<li><p>今までは、オプションのパースを自分で実装しなければなりませんでしたが、この関数を呼び出すだけでオプションをパースできます。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_options_parse(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*options,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*tag,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name,</span> <span class="pre">...)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_option_parsev()</span></code> を呼び出します。したがって、この関数の機能は、 <code class="docutils literal notranslate"><span class="pre">grn_proc_options_parsev()</span></code> と同じです。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_proc_options_parsev()</span></code> とは、インターフェースだけが異なります。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_text_printfv(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*bulk,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*format,</span> <span class="pre">va_list</span> <span class="pre">args)</span></code> を追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_text_vprintf</span></code> は10.0.3から非推奨になりました。 代わりに <code class="docutils literal notranslate"><span class="pre">grn_text_printfv</span></code> を使ってください。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_type_id_is_float_family(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_id</span> <span class="pre">id)</span></code> を追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_type_id</span></code> が <code class="docutils literal notranslate"><span class="pre">GRN_DB_FLOAT32</span></code> または <code class="docutils literal notranslate"><span class="pre">GRN_DB_FLOAT</span></code> かどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_dat_cursor_get_max_n_records(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_dat_cursor</span> <span class="pre">*c)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>カーソルが保持できるレコード数の最大値を <code class="docutils literal notranslate"><span class="pre">size_t</span></code> として返します。(このAPIはDATテーブル用です。)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_table_cursor_get_max_n_records(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_table_cursor</span> <span class="pre">*cursor)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>カーソルが保持できるレコード数の最大値を返します。</p></li>
<li><p>全ての種類(<code class="docutils literal notranslate"><span class="pre">TABLE_NO_KEY</span></code>, <code class="docutils literal notranslate"><span class="pre">TABLE_HASH_KEY</span></code>, <code class="docutils literal notranslate"><span class="pre">TABLE_DAT_KEY</span></code>, <code class="docutils literal notranslate"><span class="pre">TABLE_PAT_KEY</span></code>)のテーブルで使えます。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_result_set_add_xxx</span></code> を追加しました。詳細は以下の通りです。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_result_set_add_record(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_hash</span> <span class="pre">*result_set,</span> <span class="pre">grn_posting</span> <span class="pre">*posting,</span> <span class="pre">grn_operator</span> <span class="pre">op)</span></code></p>
<ul>
<li><p>結果セットのテーブルにレコードを追加します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_ii_posting_add_float</span></code> は10.0.3から非推奨になりました。代わりに <code class="docutils literal notranslate"><span class="pre">grn_rset_add_records()</span></code> を使ってください。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_result_set_add_table(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_hash</span> <span class="pre">*result_set,</span> <span class="pre">grn_obj</span> <span class="pre">*table,</span> <span class="pre">double</span> <span class="pre">score,</span> <span class="pre">grn_operator</span> <span class="pre">op)</span></code></p>
<ul>
<li><p>結果セットにテーブルを追加します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_result_set_add_table_cursor(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_hash</span> <span class="pre">*result_set,</span> <span class="pre">grn_table_cursor</span> <span class="pre">*cursor,</span> <span class="pre">double</span> <span class="pre">score,</span> <span class="pre">grn_operator</span> <span class="pre">op)</span></code></p>
<ul>
<li><p>結果セットにカーソル内のレコードを追加します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_vector_copy(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*src,</span> <span class="pre">grn_obj</span> <span class="pre">*dest)</span></code> を追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vector</span></code> オブジェトをコピーします。 <code class="docutils literal notranslate"><span class="pre">vector</span></code> オブジェクトのコピーに成功したかどうかを返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_have_source(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>ソースカラムを持つカラムかどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_is_token_column(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>トークンカラムかどうかを <code class="docutils literal notranslate"><span class="pre">bool</span></code> として返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_hash_add_table_cursor(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_hash</span> <span class="pre">*hash,</span> <span class="pre">grn_table_cursor</span> <span class="pre">*cursor,</span> <span class="pre">double</span> <span class="pre">score)</span></code> を追加しました。</p>
<ul class="simple">
<li><p>結果セットを一括して挿入するための関数です。 <code class="docutils literal notranslate"><span class="pre">grn_ii_posting_add()</span></code> を使ってレコードを挿入するより高速です。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id22">
<h3>修正<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>複数のスレッドから、同時にモジュール(トークナイザー、ノーマライザー、トークンフィルター)が使われた場合にクラッシュする問題を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Float32</span></code> の値を表示する際の精度を修正しました。</p>
<ul>
<li><p>10.0.3から <code class="docutils literal notranslate"><span class="pre">Float32</span></code> の値の精度は、 8桁から7桁になります。</p></li>
</ul>
</li>
<li><p>動的カラムのパラメーターだけが違うクエリーが実行された時にGroongaが誤ったキャッシュを使用していた問題を修正しました。 [GitHub#1102 naoaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id23">
<h3>感謝<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-2-2020-04-29">
<span id="release-10-0-2"></span><h2>10.0.2リリース - 2020-04-29<a class="headerlink" href="#release-10-0-2-2020-04-29" title="Link to this heading">#</a></h2>
<section id="id24">
<h3>改良<a class="headerlink" href="#id24" title="Link to this heading">#</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">time_classify_*</span></code> 関数が <code class="docutils literal notranslate"><span class="pre">uvector</span></code> に対応しました。 [GitHub#1089][naoaさんがパッチ提供]</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">uvector</span></code> とは、要素のサイズが固定のベクターです。</p></li>
<li><p>例えば、Time型の要素を格納しているベクターは <code class="docutils literal notranslate"><span class="pre">uvector</span></code> です。</p></li>
</ul>
</li>
<li><p>ゼロコピーで値を参照できないソートキーが混在しているケースでソートのパフォーマンスを改善しました。</p>
<ul class="simple">
<li><p>いくつかのソートキー(例えば、 <code class="docutils literal notranslate"><span class="pre">_score</span></code> 等)の値はゼロコピーで値を参照できません。</p></li>
<li><p>これらの値が一つでも含まれる場合、以前は全てのソートキーの値をコピーしていました。</p></li>
<li><p>今回の変更から、参照できないソートキーの値だけコピーし、参照可能なソートキーの値はコピーせずに参照するようにしました。</p></li>
<li><p>ただ、この変更で全てのソートキーの値が参照可能なケースでパフォーマンスが落ちる可能性があります。</p></li>
</ul>
</li>
<li><p>重み付きベクターをJSON文字列としてロードできるようにしました。</p>
<ul>
<li><p>以下の例のように、重み付きベクターをJSON文字列としてロードできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">table_create</span> <span class="n">Data</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Data</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span><span class="o">|</span><span class="n">WITH_WEIGHT</span> <span class="n">Tags</span>
<span class="n">column_create</span> <span class="n">Tags</span> <span class="n">data_tags</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_WEIGHT</span> <span class="n">Data</span> <span class="n">tags</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">fruit</span><span class="se">\&quot;</span><span class="s2">: 10, </span><span class="se">\&quot;</span><span class="s2">apple</span><span class="se">\&quot;</span><span class="s2">: 100}&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">fruit</span><span class="se">\&quot;</span><span class="s2">: 200}&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型をサポートしました。</p>
<ul class="simple">
<li><p>Groongaは既に <code class="docutils literal notranslate"><span class="pre">Float</span></code> 型を持っていますが、これは、倍精度浮動小数点数です。したがって、単精度浮動小数点数のみを使う場合は、効率が悪いです。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Float32</span></code> 型を追加することで、より適切な型を選択できるようになりました。</p></li>
</ul>
</li>
<li><p>以下のAPIを公開しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_unref(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_obj</span> <span class="pre">*obj)</span></code></p>
<ul>
<li><p>このAPIは参照カウントモードのときのみ使用します。(参照カウントモードとは、 <code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> の状態のことです。)</p>
<ul>
<li><p>このAPIは、参照カウントモードの時のみ <code class="docutils literal notranslate"><span class="pre">grn_obj_unlink()</span></code> を呼び出します。参照カウントモード以外の時は、何もしません。</p></li>
<li><p>参照カウントモードの時のみ <code class="docutils literal notranslate"><span class="pre">grn_obj_unlink()</span></code> を呼び出す必要がある時に便利です。</p></li>
<li><p>以下の例のように、参照カウントモードかどうかの条件を書かなくて良くなるためです。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_unref()</span></code> を使用しない場合の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">grn_enable_reference_count</span><span class="p">)</span> <span class="p">{</span>
 <span class="n">grn_obj_unlink</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_obj_ubref()</span></code> を使用する場合の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grn_obj_ubref</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_get_version_major(void)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_get_version_minor(void)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_get_version_micro(void)</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> としてGroongaのメジャー、マイナー、マイクロバージョンを返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_record_id(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_section_id(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_position(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_tf(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight_float(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_rest(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p>
<ul class="simple">
<li><p>これらは、ポスティングリストの情報を返します。</p></li>
<li><p>これらのAPIは、 <code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight_float</span></code> 以外は、 <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> として値を返します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight_float</span></code> は <code class="docutils literal notranslate"><span class="pre">float</span></code> として値を返します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_section_id(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p>
<ul>
<li><p>セクションIDとはカラム名の内部表現です。</p></li>
<li><p>カラム名を文字列としてポスティングリストに格納すると、情報量が多くなり無駄な容量を使います。</p></li>
<li><p>したがって、カラム名をセクションIDという数値としてポスティングリストに格納することで、情報量を圧縮し使用する容量を少なくしています。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_tf(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_tf</span></code> の <code class="docutils literal notranslate"><span class="pre">tf</span></code> とは、単語の出現頻度です。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_posting_get_weight_float(grn_ctx</span> <span class="pre">*ctx,</span> <span class="pre">grn_posting</span> <span class="pre">*posting)</span></code></p>
<ul>
<li><p>トークンの重みを <code class="docutils literal notranslate"><span class="pre">float</span></code> として返します。</p></li>
<li><p>今後はトークンの重みを取得する際はこのAPIを使用することをおすすめします。</p>
<ul>
<li><p>近い将来、重みは内部的に <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> から <code class="docutils literal notranslate"><span class="pre">float</span></code> に変更するためです。</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id25">
<h3>修正<a class="headerlink" href="#id25" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>32bit GUN/Linux等でGroongaがクラッシュすることがある問題を修正しました。</p></li>
<li><p>関係のないカラムの値をクリアーしてしまう問題を修正しました。 [GitHub#1087][sutaminさんの報告]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump</span></code> コマンドでレコードをダンプした時にメモリリークする問題を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_columns</span></code> に無効な値を指定した時にメモリリークする問題を修正しました。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snippet</span></code> 関数を実行する時にメモリリークする問題を修正しました。</p></li>
<li><p>以下の条件を満たした時にメモリリークする問題を修正しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">initial</span></code> ステージで動的カラムを使用した場合。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code> コマンドの引数 <code class="docutils literal notranslate"><span class="pre">slices</span></code> を使用した場合。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_table_remove</span></code> でテーブルを削除した際にメモリリークする問題を修正しました。</p></li>
<li><p>参照カウントモードを使用した時にメモリリークする問題を修正しました。</p>
<ul>
<li><p>参照カウントモードとは、 <code class="docutils literal notranslate"><span class="pre">GRN_ENABLE_REFERENCE_COUNT=yes</span></code> の状態のことです。</p></li>
<li><p>この機能は実験的です。パフォーマンスが低下することがあります。</p></li>
</ul>
</li>
<li><p>Apache Arrow形式でデータをロードした際に <code class="docutils literal notranslate"><span class="pre">_key</span></code> アクセサーを解放しすぎる問題を修正しました。</p></li>
</ul>
</section>
<section id="id26">
<h3>感謝<a class="headerlink" href="#id26" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>sutaminさん</p></li>
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-10-0-1-2020-03-30">
<span id="release-10-0-1"></span><h2>10.0.1リリース - 2020-03-30<a class="headerlink" href="#release-10-0-1-2020-03-30" title="Link to this heading">#</a></h2>
<p>Groonga 10.0.0 のUbuntuとWindows(VC++版)のパッケージに誤りがあったため Groonga 10.0.1 をリリースしました。</p>
<p>既にCentOS、Debian、Windows(MinGW版)のGroonga 10.0.0を使用している方は、そのまま使っていただいて問題ありません。</p>
<section id="id27">
<h3>修正<a class="headerlink" href="#id27" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Windows(VC++版)のパッケージに不足していたランタイム(vcruntime140_1.dll)を追加しました。</p></li>
</ul>
</section>
</section>
<section id="release-10-0-0-2020-03-29">
<span id="release-10-0-0"></span><h2>10.0.0リリース - 2020-03-29<a class="headerlink" href="#release-10-0-0-2020-03-29" title="Link to this heading">#</a></h2>
<section id="id28">
<h3>改良<a class="headerlink" href="#id28" title="Link to this heading">#</a></h3>
<ul>
<li><p>[httpd] バンドルしているnginxのバージョンを1.17.9に更新しました。</p></li>
<li><p>[httpd] 出力形式を拡張子として指定できるようにしました。</p>
<ul class="simple">
<li><p>例えば、 <code class="docutils literal notranslate"><span class="pre">load?output_type=json</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">load.json</span></code> と書けます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/log.html"><span class="doc">ログ</span></a>] Linuxのdumpレベルのログにオープンしたファイルとクローズしたファイルのパスを出力するようにしました。</p></li>
<li><p>[<a class="reference internal" href="../reference/log.html"><span class="doc">ログ</span></a>] Windowsのdebugレベルのログにオープンしたファイルとクローズしたファイルのパスを出力するようにしました。</p></li>
<li><p>以下のAPIとマクロを追加しました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grn_timeval_from_double(grn_ctx,</span> <span class="pre">double)</span></code></p>
<ul>
<li><p>このAPIは、 <code class="docutils literal notranslate"><span class="pre">double</span></code> 型を <code class="docutils literal notranslate"><span class="pre">grn_timeval</span></code> 型に変換します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grn_timeval</span></code> 型の値を返します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_TIMEVAL_TO_NSEC(timeval)</span></code></p>
<ul>
<li><p>このマクロは、 <code class="docutils literal notranslate"><span class="pre">grn_timeval</span></code> 型の値を <code class="docutils literal notranslate"><span class="pre">uint64_t</span></code> 型の値としてナノ秒に変換します。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_TIME_USEC_TO_SEC(usec)</span></code></p>
<ul>
<li><p>このマクロは、ミリ秒を秒に変換します。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>以下のマクロを非推奨にしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_OBJ_FORMAT_FIN(grn_ctx,</span> <span class="pre">grn_obj_format)</span></code></p>
<ul>
<li><p>10.0.0から代わりに <code class="docutils literal notranslate"><span class="pre">grn_obj_format_fin(grn_ctx,</span> <span class="pre">grn_obj_format)</span></code> を使ってください。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>],[<a class="reference internal" href="../reference/commands/dump.html"><span class="doc">dump</span></a>]  ストリーム出力に対応しました。</p>
<ul>
<li><p>この機能は <code class="docutils literal notranslate"><span class="pre">command_version</span> <span class="pre">3</span></code> 以降で使えます。headerがbodyの後に出力されます。</p></li>
<li><p>現在、この機能をサポートしているのは、 <code class="docutils literal notranslate"><span class="pre">dump</span></code> と <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> のみです。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は、 <code class="docutils literal notranslate"><span class="pre">command_version</span> <span class="pre">3</span></code> 以降では、常に出力がstreamとして返ります。</p></li>
<li><p>この機能は以下の制限があります。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">limit</span></code> に指定できる負の値は -1 のみです。</p></li>
<li><p>MessagePack形式の出力はサポートしていません。</p></li>
</ul>
</li>
<li><p>この変更で、JSONの応答内容を少し変更しています。</p>
<ul>
<li><p>以下のように以前のバージョンとは、キーの順序が異なっています。</p>
<ul>
<li><p>以前のバージョンのキーの順序</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>本バージョン(10.0.0)のキーの順序</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump</span></code> と <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> を <code class="docutils literal notranslate"><span class="pre">command_version</span> <span class="pre">3</span></code> で実行した時はキャッシュが効きません。</p>
<ul class="simple">
<li><p>10.0.0から <code class="docutils literal notranslate"><span class="pre">dump</span></code> と <code class="docutils literal notranslate"><span class="pre">logical_range_filter</span></code> は <code class="docutils literal notranslate"><span class="pre">command_version</span> <span class="pre">3</span></code> の時にストリームで応答を返すので、応答全体をキャッシュできないためです。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/logical_range_filter.html"><span class="doc">logical_range_filter</span></a>] Apache Arrow形式での応答をサポートしました。</p>
<ul class="simple">
<li><p>以下のデータ型をサポートしています。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">UInt8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UInt16</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int16</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UInt32</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int32</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UInt64</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int64</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Time</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ShortText</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Text</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LongText</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Vector</span></code> of <code class="docutils literal notranslate"><span class="pre">Int32</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Reference</span> <span class="pre">vector</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>Ubuntu 20.04 (Focal Fossa)をサポートしました。</p></li>
<li><p>Ubuntu 19.04 (Disco Dingo)のサポートをやめました。</p>
<ul class="simple">
<li><p>このバージョンはEOLになっているためです。</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-1-1-2021-01-25">10.1.1リリース - 2021-01-25</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improvements">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fixes">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thanks">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-1-0-2020-12-29">10.1.0リリース - 2020-12-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-9-2020-12-01">10.0.9リリース - 2020-12-01</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-8-2020-10-29">10.0.8リリース - 2020-10-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-7-2020-09-29">10.0.7リリース - 2020-09-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-6-2020-08-29">10.0.6リリース - 2020-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-5-2020-07-30">10.0.5リリース - 2020-07-30</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-4-2020-06-29">10.0.4リリース - 2020-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-3-2020-05-29">10.0.3リリース - 2020-05-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-2-2020-04-29">10.0.2リリース - 2020-04-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-1-2020-03-30">10.0.1リリース - 2020-03-30</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">修正</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-10-0-0-2020-03-29">10.0.0リリース - 2020-03-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">改良</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2009-2024 Groonga Project.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>