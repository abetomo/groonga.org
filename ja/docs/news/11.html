
<!DOCTYPE html>


<html lang="ja" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>お知らせ - 11系 &#8212; Groonga v14.0.4ドキュメント</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=47d52fd9"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4dbe4bdc"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-7532323-1"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-7532323-1');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-7532323-1');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'news/11';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.3';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://groonga.org/docs/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'japanese';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ja"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

   

<a class="navbar-brand logo" href="https://groonga.org/ja/">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/groonga.png" class="logo__image only-light" alt="Groonga v14.0.4ドキュメント - Home"/>
    <script>document.write(`<img src="../_static/groonga.png" class="logo__image only-dark" alt="Groonga v14.0.4ドキュメント - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">検索</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="/ja/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-blog fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Blog</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">検索</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/groonga/groonga" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/groonga" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="/ja/blog" title="Blog" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-blog fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Blog</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">お知らせ - 11系</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="news-11-series">
<h1>お知らせ - 11系<a class="headerlink" href="#news-11-series" title="Link to this heading">#</a></h1>
<section id="release-11-1-3-2022-01-29">
<span id="release-11-1-3"></span><h2>11.1.3リリース - 2022-01-29<a class="headerlink" href="#release-11-1-3-2022-01-29" title="Link to this heading">#</a></h2>
<section id="improvements">
<h3>改良<a class="headerlink" href="#improvements" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a>] 32個以上のキーワードを使えるようにしました。 [GitHub#1313][Takashi Hashidaさんがパッチ提供]</p>
<p>いままで、 <code class="docutils literal notranslate"><span class="pre">snippet</span></code> は32個以上のキーワードを指定できませんでしたが、この改良によって、以下のように32個以上のキーワードを指定できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Entries</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Entries</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Entries</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is a fast and accurate full text search engine based on inverted index. One of the characteristics of Groonga is that a newly registered document instantly appears in search results. Also, Groonga allows updates without read locks. These characteristics result in superior performance on real-time applications.</span><span class="se">\n</span><span class="s2">Groonga is also a column-oriented database management system (DBMS). Compared with well-known row-oriented systems, such as MySQL and PostgreSQL, column-oriented systems are more suited for aggregate queries. Due to this advantage, Groonga can cover weakness of row-oriented systems.</span><span class="se">\n</span><span class="s2">The basic functions of Groonga are provided in a C library. Also, libraries for using Groonga in other languages, such as Ruby, are provided by related projects. In addition, groonga-based storage engines are provided for MySQL and PostgreSQL. These libraries and storage engines allow any application to use Groonga. See usage examples.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;In widely used DBMSs, updates are immediately processed, for example, a newly registered record appears in the result of the next query. In contrast, some full text search engines do not support instant updates, because it is difficult to dynamically update inverted indexes, the underlying data structure.</span><span class="se">\n</span><span class="s2">Groonga also uses inverted indexes but supports instant updates. In addition, Groonga allows you to search documents even when updating the document collection. Due to these superior characteristics, Groonga is very flexible as a full text search engine. Also, Groonga always shows good performance because it divides a large task, inverted index merging, into smaller tasks.&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Entries</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39; </span><span class="se">\</span>
<span class="s1">  snippet(content, </span><span class="se">\</span>
<span class="s1">  &quot;groonga&quot;, &quot;inverted&quot;, &quot;index&quot;, &quot;fast&quot;, &quot;full&quot;, &quot;text&quot;, &quot;search&quot;, &quot;engine&quot;, &quot;registered&quot;, &quot;document&quot;, </span><span class="se">\</span>
<span class="s1">  &quot;results&quot;, &quot;appears&quot;, &quot;also&quot;, &quot;system&quot;, &quot;libraries&quot;, &quot;for&quot;, &quot;mysql&quot;, &quot;postgresql&quot;, &quot;column-oriented&quot;, &quot;dbms&quot;, </span><span class="se">\</span>
<span class="s1">  &quot;basic&quot;, &quot;ruby&quot;, &quot;projects&quot;, &quot;storage&quot;, &quot;allow&quot;, &quot;application&quot;, &quot;usage&quot;, &quot;sql&quot;, &quot;well-known&quot;, &quot;real-time&quot;, </span><span class="se">\</span>
<span class="s1">  &quot;weakness&quot;, &quot;merging&quot;, &quot;performance&quot;, &quot;superior&quot;, &quot;large&quot;, &quot;dynamically&quot;, &quot;difficult&quot;, &quot;query&quot;, &quot;examples&quot;, &quot;divides&quot;, </span><span class="se">\</span>
<span class="s1">  { </span><span class="se">\</span>
<span class="s1">    &quot;default_open_tag&quot;: &quot;[&quot;, </span><span class="se">\</span>
<span class="s1">    &quot;default_close_tag&quot;: &quot;]&quot;, </span><span class="se">\</span>
<span class="s1">    &quot;width&quot; : 2048 </span><span class="se">\</span>
<span class="s1">  })&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1643165838.691991</span><span class="p">,</span>
    <span class="mf">0.0003311634063720703</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;[Groonga] is a [fast] and accurate [full] [text] [search] [engine] based on [inverted] [index]. One of the characteristics of [Groonga] is that a newly [registered] [document] instantly [appears] in [search] [results]. [Also], [Groonga] [allow]s updates without read locks. These characteristics result in [superior] [performance] on [real-time] [application]s.</span><span class="se">\n</span><span class="s2">[Groonga] is [also] a [column-oriented] database management [system] ([DBMS]). Compared with [well-known] row-oriented [system]s, such as [MySQL] and [PostgreSQL], [column-oriented] [system]s are more suited [for] aggregate queries. Due to this advantage, [Groonga] can cover [weakness] of row-oriented [system]s.</span><span class="se">\n</span><span class="s2">The [basic] functions of [Groonga] are provided in a C library. [Also], [libraries] [for] using [Groonga] in other languages, such as [Ruby], are provided by related [projects]. In addition, [groonga]-based [storage] [engine]s are provided [for] [MySQL] and [PostgreSQL]. These [libraries] and [storage] [engine]s [allow] any [application] to use [Groonga]. See [usage] [examples].&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;In widely used [DBMS]s, updates are immediately processed, [for] example, a newly [registered] record [appears] in the result of the next [query]. In contrast, some [full] [text] [search] [engine]s do not support instant updates, because it is [difficult] to [dynamically] update [inverted] [index]es, the underlying data structure.</span><span class="se">\n</span><span class="s2">[Groonga] [also] uses [inverted] [index]es but supports instant updates. In addition, [Groonga] [allow]s you to [search] [document]s even when updating the [document] collection. Due to these [superior] characteristics, [Groonga] is very flexible as a [full] [text] [search] [engine]. [Also], [Groonga] always shows good [performance] because it [divides] a [large] task, [inverted] [index] [merging], into smaller tasks.&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] 新しいオプション <code class="docutils literal notranslate"><span class="pre">remove_symbol</span></code> を追加しました。</p>
<p>このオプションは、以下のように正規化対象の文字列から記号(例えば #, !, &quot;, &amp;, % 等)を削除します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normalize</span>   <span class="s1">&#39;NormalizerNFKC130(&quot;remove_symbol&quot;, true)&#39;</span>   <span class="s2">&quot;#This &amp; is </span><span class="si">%%</span><span class="s2"> a pen.&quot;</span>   <span class="n">WITH_TYPES</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1643595008.729597</span><span class="p">,</span>
    <span class="mf">0.0005540847778320312</span>
  <span class="p">],</span>
  <span class="p">{</span>
    <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;this  is  a pen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;others&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alpha&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;checks&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../install/almalinux.html"><span class="doc">AlmaLinux</span></a>] ARM64版 AlmaLinux 8 向けのパッケージをサポートしました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.5に更新しました。</p></li>
<li><p>[Documentation] <a class="reference internal" href="../reference/commands/ruby_eval.html"><span class="doc">ruby_eval</span></a> の誤記を修正しました。[GitHub#1317][wi24rdさんがパッチ提供]</p></li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.04 (Hirsute Hippo)サポートをやめました。</p>
<ul class="simple">
<li><p>Ubuntu 21.04 は、2022年1月20日でEOLとなったためです。</p></li>
</ul>
</li>
</ul>
</section>
<section id="fixes">
<h3>修正<a class="headerlink" href="#fixes" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] 存在しないカラムを指定してロードした時にクラッシュする問題を修正しました。</p>
<p>この問題は、 <code class="docutils literal notranslate"><span class="pre">load</span></code> の引数として、 <code class="docutils literal notranslate"><span class="pre">input_type</span></code> に <code class="docutils literal notranslate"><span class="pre">apache-arrow</span></code> を指定したときのみ発生します。</p>
</li>
<li><p>Groongaが依存している arrow-libs がバージョンアップしたことによって、Groongaのバージョンアップが失敗する問題を修正しました。[groonga-talk,540][Josep Sanzさんの報告][Gitter,61eaaa306d9ba23328d23ce1][shibanao4870さんの報告][GitHub#1316][Keitaro YOSHIMURAさんの報告]</p>
<p>ただし、 arrow-libs がメジャーバージョンアップした場合は、この問題は再発します。その場合は、Groongaパッケージを再構築して対応する予定です。</p>
</li>
</ul>
</section>
<section id="known-issues">
<h3>既知の問題<a class="headerlink" href="#known-issues" title="Link to this heading">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="thanks">
<h3>感謝<a class="headerlink" href="#thanks" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
<li><p>wi24rdさん</p></li>
<li><p>Josep Sanzさん</p></li>
<li><p>Keitaro YOSHIMURAさん</p></li>
<li><p>shibanao4870さん</p></li>
</ul>
</section>
</section>
<section id="release-11-1-1-2021-12-29">
<span id="release-11-1-1"></span><h2>11.1.1リリース - 2021-12-29<a class="headerlink" href="#release-11-1-1-2021-12-29" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>改良<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 組み合わせフレーズ近傍検索をサポートしました。</p>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">'*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> の短縮形です。例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">query</span></code> を使って <code class="docutils literal notranslate"><span class="pre">*NP</span></code> を複数実行する式のかわりに <code class="docutils literal notranslate"><span class="pre">*NPP</span></code> を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">(</span><span class="s2">&quot;title * 10 || content&quot;</span><span class="p">,</span>
       <span class="s2">&quot;*NP&quot;</span><span class="n">a</span> <span class="mi">1</span> <span class="n">x</span><span class="s2">&quot; OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 1 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 1 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 2 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 2 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 2 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 3 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 3 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;a 3 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 1 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 1 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 1 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 2 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 2 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 2 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 3 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 3 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">NP</span><span class="s2">&quot;b 3 z&quot;&quot;)</span>
</pre></div>
</div>
<p>この機能によって、上記の式を <code class="docutils literal notranslate"><span class="pre">*NPP&quot;(a</span> <span class="pre">b)</span> <span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)&quot;</span></code> と書くことができます。加えて、 <code class="docutils literal notranslate"><span class="pre">*NPP&quot;(a</span> <span class="pre">b)</span> <span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)&quot;</span></code> は、 <code class="docutils literal notranslate"><span class="pre">'*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> より高速です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">(</span><span class="s2">&quot;title * 10 || content&quot;</span><span class="p">,</span>
       <span class="s2">&quot;*NPP&quot;</span><span class="p">(</span><span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="p">)</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">'*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*NP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> のような近傍フレーズ検索のパフォーマンスを改善するために実装されました。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 順序付き組み合わせフレーズ近傍検索をサポートしました。</p>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">'*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> の短縮形です。例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">query</span></code> を使って <code class="docutils literal notranslate"><span class="pre">*ONP</span></code> を複数実行する式のかわりに <code class="docutils literal notranslate"><span class="pre">*ONPP</span></code> を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">(</span><span class="s2">&quot;title * 10 || content&quot;</span><span class="p">,</span>
       <span class="s2">&quot;*ONP&quot;</span><span class="n">a</span> <span class="mi">1</span> <span class="n">x</span><span class="s2">&quot; OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 1 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 1 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 2 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 2 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 2 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 3 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 3 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;a 3 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 1 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 1 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 1 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 2 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 2 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 2 z&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 3 x&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 3 y&quot;</span> <span class="n">OR</span>
        <span class="o">*</span><span class="n">ONP</span><span class="s2">&quot;b 3 z&quot;&quot;)</span>
</pre></div>
</div>
<p>この機能によって、上記の式を <code class="docutils literal notranslate"><span class="pre">*ONPP&quot;(a</span> <span class="pre">b)</span> <span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)&quot;</span></code> と書くことができます。加えて、 <code class="docutils literal notranslate"><span class="pre">*ONPP&quot;(a</span> <span class="pre">b)</span> <span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)&quot;</span></code> は、 <code class="docutils literal notranslate"><span class="pre">'*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> より高速です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">(</span><span class="s2">&quot;title * 10 || content&quot;</span><span class="p">,</span>
       <span class="s2">&quot;*ONPP&quot;</span><span class="p">(</span><span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="p">)</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>この機能は <code class="docutils literal notranslate"><span class="pre">'*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">*ONP&quot;...&quot;</span> <span class="pre">OR</span> <span class="pre">...'</span></code> のような順序付き近傍フレーズ検索のパフォーマンスを改善するために実装されました。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/request_cancel.html"><span class="doc">request_cancel</span></a>] 検索実行中に <code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を検知しやすくしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">request_cancel</span></code> を検知するために、リターンコードのチェックを増やしたためです。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/thread_dump.html"><span class="doc">thread_dump</span></a>] 新しいコマンド <code class="docutils literal notranslate"><span class="pre">thread_dump</span></code> を追加しました。</p>
<p>現状、このコマンドはWindowsでしか動作しません。</p>
<p>このコマンド実行時の全てのスレッドのバックトレースをNOTICEレベルのログとして出力できます。</p>
<p>この機能は、Groongaが応答を返さない等の問題を解決するのに役立ちます。</p>
</li>
<li><p>[<a class="reference internal" href="../install/centos.html"><span class="doc">CentOS</span></a>] CentOS 8のサポートをやめました。</p>
<p>CentOS 8は、2021年12月31日でEOLとなるためです。</p>
</li>
</ul>
</section>
<section id="id2">
<h3>修正<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ul>
<li><p>無効なパラメータを持つインデックスカラムを削除できない問題を修正しました。 [GitHub#1301][Takashi Hashidaさんがパッチ提供]</p>
<ul>
<li><p>例えば、以下のように <code class="docutils literal notranslate"><span class="pre">column_create</span></code> を使って無効なインデックスカラムを作成した時、テーブルが削除できなくなります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Statuses</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Statuses</span> <span class="n">start_time</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt16</span>
<span class="n">column_create</span> <span class="n">Statuses</span> <span class="n">end_time</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt16</span>

<span class="n">table_create</span> <span class="n">Times</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">UInt16</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">statuses</span> <span class="n">COLUMN_INDEX</span> <span class="n">Statuses</span> <span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="o">-</span><span class="mi">22</span><span class="p">,</span>
    <span class="mf">1639037503.16114</span><span class="p">,</span>
    <span class="mf">0.003981828689575195</span><span class="p">,</span>
    <span class="s2">&quot;grn_obj_set_info(): GRN_INFO_SOURCE: multi column index must be created with WITH_SECTION flag: &lt;Times.statuses&gt;&quot;</span><span class="p">,</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;grn_obj_set_info_source_validate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;../../groonga/lib/db.c&quot;</span><span class="p">,</span>
        <span class="mi">9605</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;/tmp/d.grn&quot;</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;column_create Times statuses COLUMN_INDEX Statuses start_time,end_time&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="n">false</span>
<span class="p">]</span>
<span class="n">table_remove</span> <span class="n">Times</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="o">-</span><span class="mi">22</span><span class="p">,</span>
    <span class="mf">1639037503.16515</span><span class="p">,</span>
    <span class="mf">0.0005414485931396484</span><span class="p">,</span>
    <span class="s2">&quot;[object][remove] column is broken: &lt;Times.statuses&gt;&quot;</span><span class="p">,</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;remove_columns&quot;</span><span class="p">,</span>
        <span class="s2">&quot;../../groonga/lib/db.c&quot;</span><span class="p">,</span>
        <span class="mi">10649</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;/tmp/d.grn&quot;</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;table_remove Times&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="n">false</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="id3">
<h3>既知の問題<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id4">
<h3>感謝<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-1-0-2021-11-29">
<span id="release-11-1-0"></span><h2>11.1.0リリース - 2021-11-29<a class="headerlink" href="#release-11-1-0-2021-11-29" title="Link to this heading">#</a></h2>
<section id="id5">
<h3>改良<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] ISO 8601 形式をサポートしました。[GitHub#1228][Takashi Hashidaさんがパッチ提供]</p>
<p>この変更によって、<code class="docutils literal notranslate"><span class="pre">load</span></code> は、以下のフォーマットをサポートします。</p>
<blockquote>
<div><ul class="simple">
<li><p>YYYY-MM-ddThh:mm:ss.sZ</p></li>
<li><p>YYYY-MM-ddThh:mm:ss.s+10:00</p></li>
<li><p>YYYY-MM-ddThh:mm:ss.s-10:00</p></li>
</ul>
</div></blockquote>
<p>この構文の <code class="docutils literal notranslate"><span class="pre">T</span></code> と <code class="docutils literal notranslate"><span class="pre">Z</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">t</span></code> と <code class="docutils literal notranslate"><span class="pre">z</span></code> を使うこともできます。<code class="docutils literal notranslate"><span class="pre">-</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">/</span></code> を使うこともできます。ただし、 <code class="docutils literal notranslate"><span class="pre">/</span></code> は、ISO 8601 形式ではないことに注意してください。<code class="docutils literal notranslate"><span class="pre">/</span></code> は互換性のためにサポートしています。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">time</span>

<span class="n">table_create</span> <span class="n">Logs</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">case</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">created_at</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Logs</span> <span class="n">created_at_text</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Logs</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: Z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00Z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00Z&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01t10:00:00z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00z&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: 00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:00:00+00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: +01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:01:00+01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:01:00+01:01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: +11:11&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T21:11:00+11:11&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T21:11:00+11:11&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: -01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T08:59:00-01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T08:59:00-01:01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: -11:11&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;1999-12-31T22:49:00-11:11&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;1999-12-31T22:49:00-11:11&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone hour threshold: +23:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-02T09:00:00+23:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-02T09:00:00+23:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone minute threshold: +00:59&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:59:00+00:59&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T10:59:00+00:59&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone omitting minute: +01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:00:00+01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:00:00+01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone omitting minute: -01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T09:00:00-01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T09:00:00-01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;timezone: localtime&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T19:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T19:00:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;compatible: date delimiter: /&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000/01/01T10:00:00Z&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000/01/01T10:00:00Z&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:01:00.123+01:01&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at_text&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01T11:01:00.123+01:01&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Logs</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;case, time_format_iso8601(created_at), created_at_text&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">14</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;case&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;time_format_iso8601&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;created_at_text&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: Z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T10:00:00Z&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T10:00:00z&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: 00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T10:00:00+00:00&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: +01:01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T11:01:00+01:01&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: +11:11&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T21:11:00+11:11&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: -01:01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T08:59:00-01:01&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: -11:11&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1999-12-31T22:49:00-11:11&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone hour threshold: +23:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-02T09:00:00+23:00&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone minute threshold: +00:59&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T10:59:00+00:59&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone omitting minute: +01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T11:00:00+01&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone omitting minute: -01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T09:00:00-01&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;timezone: localtime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;compatible: date delimiter: /&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.000000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000/01/01T10:00:00Z&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;decimal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T19:00:00.123000+09:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2000-01-01T11:01:00.123+01:01&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 新しい <code class="docutils literal notranslate"><span class="pre">query_flags</span></code> <code class="docutils literal notranslate"><span class="pre">DISABLE_PREFIX_SEARCH</span></code> を追加しました。</p>
<p>以下のように、<code class="docutils literal notranslate"><span class="pre">DISABLE_PREFIX_SEARCH</span></code> によって、前方一致検索の演算子の <code class="docutils literal notranslate"><span class="pre">^</span></code> と <code class="docutils literal notranslate"><span class="pre">*</span></code> を検索キーワードとして使えます。</p>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">^</span></code> や <code class="docutils literal notranslate"><span class="pre">*</span></code> を含むドキュメントを検索したい時に便利です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alan&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;ba*&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="s2">&quot;_key&quot;</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;a*&quot;</span> \
  <span class="o">--</span><span class="n">query_flags</span> <span class="s2">&quot;DISABLE_PREFIX_SEARCH&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span><span class="p">]],[</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;ba*&quot;</span><span class="p">]]]]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alan&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;^a&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;_key:^a&quot;</span> \
  <span class="o">--</span><span class="n">query_flags</span> <span class="s2">&quot;ALLOW_COLUMN|DISABLE_PREFIX_SEARCH&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span><span class="p">]],[</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;^a&quot;</span><span class="p">]]]]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 新しい <code class="docutils literal notranslate"><span class="pre">query_flags</span></code> <code class="docutils literal notranslate"><span class="pre">DISABLE_AND_NOT</span></code> を追加しました。</p>
<p>以下のように、 <code class="docutils literal notranslate"><span class="pre">DISABLE_AND_NOT</span></code> によって、 <code class="docutils literal notranslate"><span class="pre">AND</span> <span class="pre">NOT</span></code> の演算子の <code class="docutils literal notranslate"><span class="pre">-</span></code> を検索キーワードとして使えます。</p>
<p>この機能は、 <code class="docutils literal notranslate"><span class="pre">-</span></code> を含むドキュメントを検索したい時に便利です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;cab-&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span>   <span class="o">--</span><span class="n">match_columns</span> <span class="s2">&quot;_key&quot;</span>   <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;b - a&quot;</span>   <span class="o">--</span><span class="n">query_flags</span> <span class="s2">&quot;DISABLE_AND_NOT&quot;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;ShortText&quot;</span><span class="p">]],[</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;cab-&quot;</span><span class="p">]]]]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id6">
<h3>修正<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>[ブラウザーベースの管理ツール] レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信される問題を修正しました。 [Github#1186][Takashi Hashidaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id7">
<h3>既知の問題<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id8">
<h3>感謝<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-9-2021-11-04">
<span id="release-11-0-9"></span><h2>11.0.9リリース - 2021-11-04<a class="headerlink" href="#release-11-0-9-2021-11-04" title="Link to this heading">#</a></h2>
<section id="id9">
<h3>改良<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a>] 正規表現を使ってスニペットの区切り文字を見つける新しいオプション <code class="docutils literal notranslate"><span class="pre">delimiter_regexp</span></code> を追加しました。</p>
<p><a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a> は、検索キーワードの周辺のテキストを抽出します。 <a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a> で抽出したテキストをスニペットと呼びます。</p>
<p>通常、 <a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a> は、検索キーワードの周辺の200byteのテキストを返しますが、 <a class="reference internal" href="../reference/functions/snippet.html"><span class="doc">snippet</span></a> は、センテンスの区切りを考慮しません。スニペットは、複数のセンテンスで構成されることがあります。</p>
<p><code class="docutils literal notranslate"><span class="pre">delimiter_regexp</span></code> オプションは、検索キーワードと同じセンテンスのテキストのみを抽出したいときに便利です。例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">\.\s*</span></code> を使って対象のセンテンス内のテキストのみを抽出できます。文字列は、 <code class="docutils literal notranslate"><span class="pre">\</span></code> でエスケープする必要があることに注意してください。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Documents</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Documents</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span>  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">documents_content_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Documents</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Documents</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Groonga is a fast and accurate full text search engine based on inverted index. One of the characteristics of groonga is that a newly registered document instantly appears in search results. Also, groonga allows updates without read locks. These characteristics result in superior performance on real-time applications.&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Groonga is also a column-oriented database management system (DBMS). Compared with well-known row-oriented systems, such as MySQL and PostgreSQL, column-oriented systems are more suited for aggregate queries. Due to this advantage, groonga can cover weakness of row-oriented systems.&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Documents</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;snippet(content, </span><span class="se">\</span>
<span class="s1">                            { </span><span class="se">\</span>
<span class="s1">                               &quot;default_open_tag&quot;: &quot;[&quot;, </span><span class="se">\</span>
<span class="s1">                               &quot;default_close_tag&quot;: &quot;]&quot;, </span><span class="se">\</span>
<span class="s1">                               &quot;delimiter_regexp&quot;: &quot;</span><span class="se">\\\\</span><span class="s1">.</span><span class="se">\\\\</span><span class="s1">s*&quot; </span><span class="se">\</span>
<span class="s1">                            })&#39;</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;fast performance&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;snippet&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga is a [fast] and accurate full text search engine based on inverted index&quot;</span><span class="p">,</span>
          <span class="s2">&quot;These characteristics result in superior [performance] on real-time applications&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="../reference/window_functions/window_rank.html"><span class="doc">window_rank</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">window_rank()</span></code> を追加しました。</p>
<ul>
<li><p>ギャップを含む各レコードの順位を計算できます。通常、順位は、複数のレコードが同じ順位の時は増加しません。例えば、ソートキーの値が 100、 100、 200の場合、これらの順位は 1、 1、 3です。1位のレコードが2つあるので、最後のレコードの順位は2ではなく3です。</p>
<p>これは、 <a class="reference internal" href="../reference/window_functions/window_record_number.html"><span class="doc">window_record_number</span></a> と似ていますが、 <a class="reference internal" href="../reference/window_functions/window_record_number.html"><span class="doc">window_record_number</span></a> はギャップを考慮しません。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Points</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Points</span> <span class="n">game</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Points</span> <span class="n">score</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Points</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;game&quot;</span><span class="p">,</span>  <span class="s2">&quot;score&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game1&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game1&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game1&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game1&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game2&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;game2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Points</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s1">&#39;window_rank()&#39;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">sort_keys</span> <span class="n">score</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;game, score, rank&#39;</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="n">score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">8</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;game&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;rank&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game1&quot;</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game1&quot;</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game2&quot;</span><span class="p">,</span>
        <span class="mi">150</span><span class="p">,</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game2&quot;</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game2&quot;</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game1&quot;</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game2&quot;</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;game1&quot;</span><span class="p">,</span>
        <span class="mi">400</span><span class="p">,</span>
        <span class="mi">8</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/in_values.html"><span class="doc">in_values</span></a>] テーブル検索時に自動的にキャストするようにしました。</p>
<p>例えば、 キーの型が <code class="docutils literal notranslate"><span class="pre">UInt64</span></code> のテーブルに <code class="docutils literal notranslate"><span class="pre">UInt32</span></code> の値をロードした場合、Groongaは、 <code class="docutils literal notranslate"><span class="pre">in_values()</span></code> でテーブルを検索するときに自動的に値を <code class="docutils literal notranslate"><span class="pre">UInt64</span></code> にキャストします。ただ、 <code class="docutils literal notranslate"><span class="pre">in_values(_key,</span> <span class="pre">10)</span></code> はこの機能の対象外です。10は、 <code class="docutils literal notranslate"><span class="pre">Int32</span></code> として解釈されるためです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Numbers</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">UInt64</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Numbers</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Numbers</span>   <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span>   <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;in_values(_key, 200, 100)&#39;</span>   <span class="o">--</span><span class="n">sortby</span> <span class="n">_id</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">2</span><span class="p">],[[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;UInt64&quot;</span><span class="p">]],[</span><span class="mi">100</span><span class="p">],[</span><span class="mi">200</span><span class="p">]]]]</span>
</pre></div>
</div>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.3に更新しました。</p></li>
<li><p>[<a class="reference internal" href="../install/almalinux.html"><span class="doc">AlmaLinux</span></a>] AlmaLinux 8 向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.10 (Impish Indri)をサポートしました。</p></li>
</ul>
</section>
<section id="id10">
<h3>修正<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Groongaがコマンドエラー(例えば、filterのシンタックスエラー)発生時に応答を返さない問題を修正しました。</p>
<ul>
<li><p>これは、 <code class="docutils literal notranslate"><span class="pre">--output_type</span> <span class="pre">apache-arrow</span></code> を使っているときのみ発生します。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id11">
<h3>既知の問題<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
</section>
<section id="release-11-0-7-2021-09-29">
<span id="release-11-0-7"></span><h2>11.0.7リリース - 2021-09-29<a class="headerlink" href="#release-11-0-7-2021-09-29" title="Link to this heading">#</a></h2>
<section id="id12">
<h3>改良<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] &quot;[int, int,...]&quot; のような文字列を [int, int,...] のような整数のベクターにキャストするようにしました。</p>
<p>例えば、以下のように、&quot;[1, -2]&quot; のようなベクターを文字列としてロードしたとしても、 [1, -2] のように整数のベクターとして扱います。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Data</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Data</span> <span class="n">numbers</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Int16</span>
<span class="n">table_create</span> <span class="n">Numbers</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Int16</span>
<span class="n">column_create</span> <span class="n">Numbers</span> <span class="n">data_numbers</span> <span class="n">COLUMN_INDEX</span> <span class="n">Data</span> <span class="n">numbers</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="s2">&quot;[1, -2]&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="s2">&quot;[-3, 4]&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">dump</span>   <span class="o">--</span><span class="n">dump_plugins</span> <span class="n">no</span>   <span class="o">--</span><span class="n">dump_schema</span> <span class="n">no</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;numbers&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]],</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Numbers</span> <span class="n">data_numbers</span> <span class="n">COLUMN_INDEX</span> <span class="n">Data</span> <span class="n">numbers</span>
<span class="n">select</span> <span class="n">Data</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;numbers @ -2&#39;</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[[[</span><span class="mi">1</span><span class="p">],[[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;UInt32&quot;</span><span class="p">],[</span><span class="s2">&quot;numbers&quot;</span><span class="p">,</span><span class="s2">&quot;Int16&quot;</span><span class="p">]],[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]]]]]</span>
</pre></div>
</div>
</div></blockquote>
<p>この機能は以下の型をサポートします。</p>
<blockquote>
<div><ul class="simple">
<li><p>Int8</p></li>
<li><p>UInt8</p></li>
<li><p>Int16</p></li>
<li><p>UInt16</p></li>
<li><p>Int32</p></li>
<li><p>UInt32</p></li>
<li><p>Int64</p></li>
<li><p>UInt64</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] 文字列として表現されたJSON配列を文字列のベクターとしてロードできるようにしました。</p>
<p>例えば、以下のように &quot;[&quot;hello&quot;, &quot;world&quot;]&quot; のような文字列として表現されたJSON配列をロードした場合、 [&quot;hello&quot;, &quot;world&quot;] のように2つの要素を持つベクターとして扱います。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Data</span> <span class="n">TABLE_NO_KEY</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">Data</span> <span class="n">strings</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>   <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>   <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">data_strings</span> <span class="n">COLUMN_INDEX</span> <span class="n">Data</span> <span class="n">strings</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">true</span><span class="p">]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;strings&quot;</span><span class="p">:</span> <span class="s2">&quot;[</span><span class="se">\&quot;</span><span class="s2">Hello</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">World</span><span class="se">\&quot;</span><span class="s2">]&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;strings&quot;</span><span class="p">:</span> <span class="s2">&quot;[</span><span class="se">\&quot;</span><span class="s2">Good-bye</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">World</span><span class="se">\&quot;</span><span class="s2">]&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="mi">2</span><span class="p">]</span>
<span class="n">dump</span>   <span class="o">--</span><span class="n">dump_plugins</span> <span class="n">no</span>   <span class="o">--</span><span class="n">dump_schema</span> <span class="n">no</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span><span class="s2">&quot;strings&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span><span class="s2">&quot;World&quot;</span><span class="p">]],</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="s2">&quot;Good-bye&quot;</span><span class="p">,</span><span class="s2">&quot;World&quot;</span><span class="p">]]</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">data_strings</span> <span class="n">COLUMN_INDEX</span> <span class="n">Data</span> <span class="n">strings</span>
<span class="n">select</span> <span class="n">Data</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;strings @ &quot;bye&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;strings&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;Good-bye&quot;</span><span class="p">,</span>
          <span class="s2">&quot;World&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>以前のバージョンでは、 &quot;[&quot;hello&quot;, &quot;world&quot;]&quot; のような文字列として表現されたJSON配列をロードした場合は、 [&quot;[&quot;hello&quot;, &quot;world&quot;]&quot;] のような一つの要素を持つベクターとして扱っていました。</p>
</li>
<li><p>[Documentation] 以下の項目についてのドキュメントを追加しました。</p>
<ul class="simple">
<li><p>[<a class="reference internal" href="../reference/commands/column_create.html"><span class="doc">column_create</span></a>] <code class="docutils literal notranslate"><span class="pre">WEIGHT_FLOAT32</span></code> フラグについてのドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/normalizers/normalizer_nfkc121.html"><span class="doc">NormalizerNFKC121</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC121</span></code> についてのドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/normalizers/normalizer_nfkc130.html"><span class="doc">NormalizerNFKC130</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerNFKC130</span></code> についてのドキュメントを追加しました。</p></li>
<li><p>[<a class="reference internal" href="../reference/normalizers/normalizer_table.html"><span class="doc">NormalizerTable</span></a>] <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> についてのドキュメントを追加しました。</p></li>
</ul>
</li>
<li><p>Groongaが要求する Apache Arrow のバージョンを 3.0.0 に更新しました。[GitHub#1265][Takashi Hashidaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id13">
<h3>修正<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<ul>
<li><p>テーブル作成時に無効なオプションを持つトークナイザーを指定するとメモリーリークする問題を修正しました。</p></li>
<li><p>Hashテーブルに新しいエントリーを追加できなくなることがある問題を修正しました。</p>
<p>このバグは、Groonga 11.0.6 でのみ発生し、頻繁にデータを追加、削除すると発生することがあります。もし、このバグが発生した場合は、以下の手順を実行することで、この問題を解決できます。</p>
<ol class="arabic simple">
<li><p>Groongaを11.0.6から11.0.7以降にアップグレードします。</p></li>
<li><p>元のテーブルと同じスキーマを持つ新しいテーブルを作ります。</p></li>
<li><p>元のテーブルから新しいテーブルにデータをコピーします。</p></li>
</ol>
</li>
<li><p>[Windows] メモリー不足によって、新しくファイルのオープンに失敗した時にリソースリークする問題を修正しました。</p></li>
</ul>
</section>
<section id="id14">
<h3>既知の問題<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id15">
<h3>感謝<a class="headerlink" href="#id15" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-6-2021-08-29">
<span id="release-11-0-6"></span><h2>11.0.6リリース - 2021-08-29<a class="headerlink" href="#release-11-0-6-2021-08-29" title="Link to this heading">#</a></h2>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Groonga 11.0.6 には、Hashテーブルに新しいエントリーを追加できなくなることがある問題があります。</p>
<p>この問題は、Groonga 11.0.7で修正しました。この問題は、Groonga 11.0.6でのみ発生します。したがって、Groonga 11.0.6をお使いの方は、Groonga 11.0.7以降を使うことを強くおすすめします。</p>
</div>
</div></blockquote>
<section id="id16">
<h3>改良<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<ul>
<li><p>クラッシュ時に自動でリカバリーする機能を追加しました。(実験的な機能です。)</p>
<p>この機能は実験的な機能です。現状、この機能はまだ安定していません。</p>
<p>この機能によって、Groongaがクラッシュした時、Groongaはクラッシュした後、最初のデータベースオープン時に自動的にデータベースをリカバリーします。ただ、全てのクラッシュケースで自動的にデータベースをリカバリーできるわけではありません。クラッシュのタイミングによっては、手動でデータベースのリカバリーが必要になります。</p>
<p>この機能が有効な時、GroongaはWAL(ログ先行書き込み)を実行します。以下のツールを使うことでWALをダンプできますが、現状これらをユーザーが使う必要はありません。</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="../reference/executables/grndb.html"><span class="doc">grndb</span></a>] <code class="docutils literal notranslate"><span class="pre">dump-wal</span></code> コマンド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump-wal.rb</span></code> スクリプト</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/cache_limit.html"><span class="doc">cache_limit</span></a>] <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行したときにキャッシュを削除するようにしました。[GitHub#1224][higchiさんからの報告]</p>
<p>Groongaは内部的なテーブルにクエリーキャッシュを保存しています。このテーブルは、ハッシュテーブルなので、トータルのキーサイズは最大で4GiBです。そのため、もし多くの巨大なクエリーを実行した場合、トータルのキーサイズの最大値4GiBを超え、Groongaがクエリーをキャッシュできない可能性があります。このようなケースで、 <code class="docutils literal notranslate"><span class="pre">cache_limit</span> <span class="pre">0</span></code> を実行することで、クエリーキャッシュ用のテーブルをクリアーし、Groongaがクエリーキャッシュを保存できるようにします。</p>
</li>
</ul>
</section>
<section id="id17">
<h3>修正<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<ul>
<li><p>同時期に複数のスレッドで同じオブジェクトをオープンした時に、Groongaがロックを解除しない問題を修正しました。</p>
<p>同時期に複数のスレッドが同じオブジェクトをオープンすると、最初にオブジェクトを開いたスレッド以外のスレッドは対象のオブジェクトが開かれるまで待ちます。この時、対象のオブジェクトが開かれるのを待っているスレッドもロックを取得しますが、これらのロックは解放されません。したがって、Groongaのプロセスを再起動するまでこれらのロックが残り、その新しいスレッドは、Groongaが再起動するまで、そのオブジェクトを開けません。</p>
<p>ただ、スレッドがオブジェクトを開く時間は非常に短いため、このバグは滅多に起こりません。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>] <code class="docutils literal notranslate"><span class="pre">query()</span></code> と結果が異なることがある問題を修正しました。</p>
<p>例えば、 <code class="docutils literal notranslate"><span class="pre">query(&quot;tags</span> <span class="pre">||</span> <span class="pre">tags2&quot;,</span> <span class="pre">&quot;beginner</span> <span class="pre">man&quot;)</span></code> とした場合は、以下のレコードはマッチしますが、<code class="docutils literal notranslate"><span class="pre">query_parallel_or(&quot;tags</span> <span class="pre">||</span> <span class="pre">tags2&quot;,</span> <span class="pre">&quot;beginner</span> <span class="pre">man&quot;)</span></code> とした場合は、今までは、以下のレコードはマッチしませんでした。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;_key&quot;:</span> <span class="pre">&quot;Bob&quot;,</span>&#160;&#160; <span class="pre">&quot;comment&quot;:</span> <span class="pre">&quot;Hey!&quot;,</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">&quot;tags&quot;:</span> <span class="pre">[&quot;expert&quot;,</span> <span class="pre">&quot;man&quot;],</span> <span class="pre">&quot;tags2&quot;:</span> <span class="pre">[&quot;beginner&quot;]}</span></code></p></li>
</ul>
<p>今回の変更によって、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or(&quot;tags</span> <span class="pre">||</span> <span class="pre">tags2&quot;,</span> <span class="pre">&quot;beginner</span> <span class="pre">man&quot;)</span></code> を使った場合であっても、上記のレコードがマッチするようになりました。</p>
</li>
</ul>
</section>
<section id="id18">
<h3>既知の問題<a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GRN_II_CURSOR_SET_MIN_ENABLE</span></code> が原因でマッチするはずのレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id19">
<h3>感謝<a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>higchiさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-5-2021-07-29">
<span id="release-11-0-5"></span><h2>11.0.5リリース - 2021-07-29<a class="headerlink" href="#release-11-0-5-2021-07-29" title="Link to this heading">#</a></h2>
<section id="id20">
<h3>改良<a class="headerlink" href="#id20" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/normalizers.html"><span class="doc">ノーマライザー</span></a>] ノーマライザーを複数指定できるようになりました。</p>
<p>テーブル作成時に <code class="docutils literal notranslate"><span class="pre">--normalizers</span></code> オプションを使うことで、複数のノーマライザーを指定できます。互換性のため、既存の <code class="docutils literal notranslate"><span class="pre">--normalizer</span></code> を使っても複数のノーマライザーを指定できます。</p>
<p>Groonga 11.0.4 でノーマライザーをカスタマイズするための <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> を追加しました。この <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> と既存のノーマライザーを組み合わせることでより柔軟な制御ができます。</p>
<p>例えば、この機能は、以下のようなケースで有用です。</p>
<blockquote>
<div><ul class="simple">
<li><p>電話番号を検索します。ただし、データはOCRで手書きのデータを取り込みます。OCRは数字と文字列をご認識することがあります。(例えば、 5とS など)</p></li>
</ul>
</div></blockquote>
<p>具体的には以下の通りです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Normalizations</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Normalizations</span> <span class="n">normalized</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Normalizations</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">}</span>
<span class="p">]</span>


<span class="n">table_create</span> <span class="n">Tels</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Tels</span> <span class="n">tel</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">TelsIndex</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">normalizers</span> <span class="s1">&#39;NormalizerNFKC130(&quot;unify_hyphen_and_prolonged_sound_mark&quot;, true), </span><span class="se">\</span>
<span class="s1">                 NormalizerTable(&quot;column&quot;, &quot;Normalizations.normalized&quot;)&#39;</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="s1">&#39;TokenNgram(&quot;loose_symbol&quot;, true, &quot;loose_blank&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="n">TelsIndex</span> <span class="n">tel_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span> <span class="n">Tels</span> <span class="n">tel</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Tels</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;tel&quot;</span><span class="p">:</span> <span class="s2">&quot;03-4S-1234&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;tel&quot;</span><span class="p">:</span> <span class="s2">&quot;03-45-9876&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Tels</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;tel @ &quot;03-45-1234&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1625227424.560146</span><span class="p">,</span>
    <span class="mf">0.0001730918884277344</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tel&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;03-4S-1234&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>既存のノーマライザーでは、このようなケースには対応できませんでしたが、このリリースから既存のノーマライザーと <code class="docutils literal notranslate"><span class="pre">NormalizerTable</span></code> を組み合わせることで、このようなケースにも対応できます。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>][<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] シーケンシャルサーチのしきい値をカスタマイズできるようにしました。</p>
<p>以下のオプションを使うことで、シーケンシャルサーチを使うかどうかのしきい値をクエリーごとにカスタマイズできます。</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;max_n_enough_filtered_records&quot;:</span> <span class="pre">xx}</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">max_n_enough_filtered_records</span></code> は、レコード数を指定します。 <code class="docutils literal notranslate"><span class="pre">query</span></code> または、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> で、この値以下までレコードが絞り込めそうな場合、シーケンシャルサーチを使います。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;enough_filtered_ratio&quot;:</span> <span class="pre">x.x}</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">enough_filtered_ratio</span></code> は、全体に占める割合を指定します。 <code class="docutils literal notranslate"><span class="pre">query</span></code> または、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> で、この割合以下までレコードが絞り込めそうな場合、シーケンシャルサーチを使います。例えば、　<code class="docutils literal notranslate"><span class="pre">{&quot;enough_filtered_ratio&quot;:</span> <span class="pre">0.5}</span></code> とした場合、 <code class="docutils literal notranslate"><span class="pre">query</span></code> または <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> で全体の半分まで絞り込めそうな場合はシーケンシャルサーチを使います。</p>
</li>
</ul>
</div></blockquote>
<p>具体的には以下の通りです。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Products</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">products_name</span> <span class="n">COLUMN_INDEX</span> <span class="n">Products</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Products</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Mroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Rroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;PGroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Ruby&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;PostgreSQL&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query(&quot;name&quot;, &quot;r name:Ruby&quot;, {&quot;enough_filtered_ratio&quot;: 0.5})&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Products</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">products_name</span> <span class="n">COLUMN_INDEX</span> <span class="n">Products</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Products</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Mroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Rroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;PGroonga&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Ruby&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;PostgreSQL&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">select</span> \
  <span class="o">--</span><span class="n">table</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query(&quot;name&quot;, &quot;r name:Ruby&quot;, {&quot;max_n_enough_filtered_records&quot;: 10})&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/between.html"><span class="doc">between</span></a>][<a class="reference internal" href="../reference/functions/in_values.html"><span class="doc">in_values</span></a>] シーケンシャルサーチのしきい値をカスタマイズできるようにしました。</p>
<p>[<a class="reference internal" href="../reference/functions/between.html"><span class="doc">between</span></a>] と [<a class="reference internal" href="../reference/functions/in_values.html"><span class="doc">in_values</span></a>] は、検索対象のレコードが十分に絞り込まれている時に、シーケンシャルサーチに切り替える機能があります。</p>
<p><code class="docutils literal notranslate"><span class="pre">GRN_IN_VALUES_TOO_MANY_INDEX_MATCH_RATIO</span></code> / <code class="docutils literal notranslate"><span class="pre">GRN_BETWEEN_TOO_MANY_INDEX_MATCH_RATIO</span></code> の値は、Groongaがシーケンシャルサーチを実行するかインデックスを使った検索をするかのしきい値として使われます。</p>
<p>今までは、以下の環境変数でのみカスタマイズ可能でした。</p>
<p><code class="docutils literal notranslate"><span class="pre">in_values()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t use auto sequential search</span>
<span class="n">GRN_IN_VALUES_TOO_MANY_INDEX_MATCH_RATIO</span><span class="o">=-</span><span class="mi">1</span>
<span class="c1"># Set threshold to 0.02</span>
<span class="n">GRN_IN_VALUES_TOO_MANY_INDEX_MATCH_RATIO</span><span class="o">=</span><span class="mf">0.02</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">between()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t use auto sequential search</span>
<span class="n">GRN_BETWEEN_TOO_MANY_INDEX_MATCH_RATIO</span><span class="o">=-</span><span class="mi">1</span>
<span class="c1"># Set threshold to 0.02</span>
<span class="n">GRN_BETWEEN_TOO_MANY_INDEX_MATCH_RATIO</span><span class="o">=</span><span class="mf">0.02</span>
</pre></div>
</div>
<p>環境変数によるカスタマイズは、すべてのクエリーに対して適用されますが、この機能を使うことで、クエリーごとにしきい値を指定できます。</p>
<p>具体的には以下の通りです。 <code class="docutils literal notranslate"><span class="pre">{&quot;too_many_index_match_ratio&quot;:</span> <span class="pre">x.xx}</span></code> オプションでしきい値を指定できます。このオプションの値の型は <code class="docutils literal notranslate"><span class="pre">double</span></code> 型です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">timestamp</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Time</span>

<span class="n">table_create</span> <span class="n">Times</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Time</span>
<span class="n">column_create</span> <span class="n">Times</span> <span class="n">memos_timestamp</span> <span class="n">COLUMN_INDEX</span> <span class="n">Memos</span> <span class="n">timestamp</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;001&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:23&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;002&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:24&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;003&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:25&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;004&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:26&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;005&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:27&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;006&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:28&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;007&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:29&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;008&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:30&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;009&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:31&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;010&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:32&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;011&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:33&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;012&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:34&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;013&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:35&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;014&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:36&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;015&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:37&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;016&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:38&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;017&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:39&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;018&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:40&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;019&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:41&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;020&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:42&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;021&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:43&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;022&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:44&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;023&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:45&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;024&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:46&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;025&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:47&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;026&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:48&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;027&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:49&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;028&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:50&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;029&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:51&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;030&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:52&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;031&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:53&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;032&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:54&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;033&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:55&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;034&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:56&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;035&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:57&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;036&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:58&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;037&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:25:59&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;038&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:00&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;039&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:01&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;040&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:02&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;041&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:03&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;042&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:04&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;043&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:05&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;044&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:06&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;045&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:07&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;046&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:08&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;047&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:09&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;048&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:10&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;049&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:11&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;050&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-11-10 07:26:12&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_key == &quot;003&quot; &amp;&amp; </span><span class="se">\</span>
<span class="s1">            between(timestamp, </span><span class="se">\</span>
<span class="s1">                    &quot;2014-11-10 07:25:24&quot;, </span><span class="se">\</span>
<span class="s1">                    &quot;include&quot;, </span><span class="se">\</span>
<span class="s1">                    &quot;2014-11-10 07:27:26&quot;, </span><span class="se">\</span>
<span class="s1">                    &quot;exclude&quot;, </span><span class="se">\</span>
<span class="s1">                    {&quot;too_many_index_match_ratio&quot;: 0.03})&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Tags</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga sticker!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is good!&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Tags</span> <span class="n">memos_tag</span> <span class="n">COLUMN_INDEX</span> <span class="n">Memos</span> <span class="n">tag</span>

<span class="n">select</span> \
  <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;_id &gt;= 3 &amp;&amp; </span><span class="se">\</span>
<span class="s1">            in_values(tag, </span><span class="se">\</span>
<span class="s1">                     &quot;Groonga&quot;, </span><span class="se">\</span>
<span class="s1">                     {&quot;too_many_index_match_ratio&quot;: 0.7})&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_id</span><span class="p">,</span><span class="n">_score</span><span class="p">,</span><span class="n">_key</span><span class="p">,</span><span class="n">tag</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/between.html"><span class="doc">between</span></a>] <code class="docutils literal notranslate"><span class="pre">GRN_EXPR_OPTIMIZE=yes</span></code> をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">between()</span></code> で、条件式の評価順序の最適化をサポートしました。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>][<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] match_columns を vector で指定できるようにしました。[GitHub#1238][naoaさんがパッチ提供]</p>
<p>以下のように、 <code class="docutils literal notranslate"><span class="pre">query</span></code> と <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> の <code class="docutils literal notranslate"><span class="pre">match_columns</span></code> に vector を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">memo</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">name</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">name</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memo</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">memo</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">tag</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">tag</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga user&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>   <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga user&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_score</span><span class="p">,</span><span class="n">name</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query([&quot;name * 100&quot;, &quot;memo&quot;, &quot;tag * 10&quot;], </span><span class="se">\</span>
<span class="s1">                  &quot;Alice OR Groonga&quot;)&#39;</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 前方一致検索でセクションと重みをサポートしました。[GitHub#1240][naoaさんがパッチ提供]</p>
<p>前方一致検索でマルチカラムインデックスと、スコアーの調整ができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">title</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_SECTION</span> <span class="n">Memos</span> <span class="n">title</span><span class="p">,</span><span class="n">tags</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Ruby&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Groonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Mroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;MySQL&quot;</span><span class="p">]}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="s2">&quot;Terms.index.title * 2&quot;</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;G*&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">title</span><span class="p">,</span><span class="n">tags</span><span class="p">,</span><span class="n">_score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;title&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;Groonga&quot;</span>
        <span class="p">],</span>
        <span class="mi">2</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/executables/grndb.html"><span class="doc">grndb</span></a>] <code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">recover</span></code> で使用したオブジェクトを即時閉じるようにしました。</p>
<p>これにより、メモリ消費を抑制できます。おそらくパフォーマンスは低下していますが、許容可能な低下です。</p>
<p><code class="docutils literal notranslate"><span class="pre">grndb</span> <span class="pre">check</span></code> はまだ、使用したオブジェクトを即時閉じないので注意してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>][<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] 以下のように、 <code class="docutils literal notranslate"><span class="pre">match_columns</span></code> に <code class="docutils literal notranslate"><span class="pre">scorer_tf_idf</span></code> を指定できるようにしました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Tags</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">tags</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Tags</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
 <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beginner&quot;</span><span class="p">,</span> <span class="s2">&quot;active&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
 <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;expert&quot;</span><span class="p">,</span> <span class="s2">&quot;passive&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Chris&quot;</span><span class="p">,</span>
 <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beginner&quot;</span><span class="p">,</span> <span class="s2">&quot;passive&quot;</span><span class="p">]}</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Tags</span> <span class="n">users</span> <span class="n">COLUMN_INDEX</span> <span class="n">Users</span> <span class="n">tags</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">_score</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="n">_id</span> \
  <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query_parallel_or(&quot;scorer_tf_idf(tags)&quot;, </span><span class="se">\</span>
<span class="s1">                              &quot;beginner active&quot;)&#39;</span>
<span class="p">{</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;return_code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;elapsed_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
  <span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;n_hits&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;records&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
        <span class="mf">2.098612308502197</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/query_expand.html"><span class="doc">query_expand</span></a>] 展開後の語の重みを操作できるようにしました。</p>
<p>展開後の語に対して、重みを指定できます。</p>
<p>スコアーを増やしたい場合は、 <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> を使います。スコアーを減らしたい場合は、 <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> を指定します。</p>
<p>数字でスコアーの量を指定できます。負の数も指定できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">TermExpansions</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">TermExpansions</span> <span class="n">term</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">TermExpansions</span> <span class="n">expansions</span> <span class="n">COLUMN_VECTOR</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">TermExpansions</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;expansions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Rroonga&quot;</span><span class="p">,</span> <span class="s2">&quot;Ruby Groonga&quot;</span><span class="p">]}</span>
<span class="p">]</span>

<span class="n">query_expand</span> <span class="n">TermExpansions</span> <span class="s2">&quot;Groonga &lt;-0.2Rroonga Mroonga&quot;</span> \
  <span class="o">--</span><span class="n">term_column</span> <span class="n">term</span> \
  <span class="o">--</span><span class="n">expanded_term_column</span> <span class="n">expansions</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="s2">&quot;Groonga &lt;-0.2((Rroonga) OR (Ruby Groonga)) Mroonga&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.21.1に更新しました。</p></li>
<li><p>バンドルしているApache Arrowを5.0.0に更新しました。</p></li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 20.10 (Groovy Gorilla)サポートをやめました。</p>
<ul class="simple">
<li><p>Ubuntu 20.10 は、2021年7月22日でEOLとなったためです。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id21">
<h3>修正<a class="headerlink" href="#id21" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>][<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] <code class="docutils literal notranslate"><span class="pre">query_options</span></code> とその他のオプションを指定すると、その他のオプションが無視される問題を修正しました。</p>
<p>例えば、以下のケースでは、 <code class="docutils literal notranslate"><span class="pre">&quot;default_operator&quot;:</span> <span class="pre">&quot;OR&quot;</span></code> オプションは無視されていました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">token_filters</span><span class="o">/</span><span class="n">stop_word</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span> \
  <span class="o">--</span><span class="n">token_filters</span> <span class="n">TokenFilterStopWord</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">is_stop_word</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Bool</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Terms</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;is_stop_word&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello and Good-bye&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Good-bye&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query_parallel_or( </span><span class="se">\</span>
<span class="s1">              &quot;content&quot;, </span><span class="se">\</span>
<span class="s1">              &quot;Hello and&quot;, </span><span class="se">\</span>
<span class="s1">              {&quot;default_operator&quot;: &quot;OR&quot;, </span><span class="se">\</span>
<span class="s1">               &quot;options&quot;: {&quot;TokenFilterStopWord.enable&quot;: false}})&#39;</span> \
  <span class="o">--</span><span class="n">match_escalation_threshold</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Hello and Good-bye&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id22">
<h3>既知の問題<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>多くのデータを削除し、同じデータを再度loadすることを繰り返すと、Groongaがヒットすべきレコードを返さないことがあります。</p></li>
</ul>
</section>
<section id="id23">
<h3>感謝<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-4-2021-06-29">
<span id="release-11-0-4"></span><h2>11.0.4リリース - 2021-06-29<a class="headerlink" href="#release-11-0-4-2021-06-29" title="Link to this heading">#</a></h2>
<section id="id24">
<h3>改良<a class="headerlink" href="#id24" title="Link to this heading">#</a></h3>
<ul>
<li><p>[Normalizer] カスタマイズされたノーマライザーを使えるようになりました。</p>
<p>この機能を使うためにノーマライズ用のテーブルを定義し、このテーブルを使ってノーマライズします。つまり、カスタマイズされたノーマライザーを使うことができます。</p>
<p>例えば、以下の例では、 &quot;S&quot; を &quot;5&quot; に正規化するよう定義しています。<code class="docutils literal notranslate"><span class="pre">Substitutions</span></code> テーブルが正規化用のテーブルです。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Substitutions</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Substitutions</span> <span class="n">substituted</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Substitutions</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;substituted&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">table_create</span> <span class="n">TelLists</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">TelLists</span> <span class="n">tel</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenNgram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="s1">&#39;NormalizerTable(&quot;column&quot;, &quot;Substitutions.substituted&quot;, </span><span class="se">\</span>
<span class="s1">                                &quot;report_source_offset&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">tel_index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">TelLists</span> <span class="n">tel</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">TelLists</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;tel&quot;</span><span class="p">:</span> <span class="s2">&quot;03-4S-1234&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">TelLists</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;tel @ &quot;03-45-1234&quot;&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1624686303.538532</span><span class="p">,</span>
    <span class="mf">0.001319169998168945</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tel&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;03-4S-1234&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>例えば、手書きの文字を取り込む際に誤認識されやすい語を定義できます。そうすることで、誤ったデータを正規化して正しいデータにできます。</p>
<p>この正規化用のテーブルを更新した場合は、インデックスの再構築が必要なことに注意してください。</p>
</li>
<li><p>新しいコマンド <code class="docutils literal notranslate"><span class="pre">object_warm</span></code> を追加しました。</p>
<p>このコマンドは、GroongaのDBをOSのページキャッシュに乗せます。</p>
<p>OS起動後、Groongaを一度も起動していない場合、GroongaのDBはOSのページキャッシュ上に存在しません。そのため、Groongaに対する最初の操作は遅くなります。</p>
<p>予めこのコマンドを実行した場合、Groongaへの最初の操作は速くなります。Linuxでは、 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">*.db</span> <span class="pre">&gt;</span> <span class="pre">dev/null</span></code> で同等のことができますが、Windowsでは、いままで、同様のことはできませんでした。</p>
<p>このコマンドを使うことで、LinuxでもWindowsでもGroongaのDBをOSのページキャッシュへ乗せることができます。また、テーブル、カラム、インデックス単位でも同様のことができます。したがって、よく使うテーブルやカラム、インデックスのみをOSのページキャッシュに乗せることができます。</p>
<p>このコマンドは、以下のように様々な対象に対して実行できます。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">object_warm</span> <span class="pre">--name</span> <span class="pre">index_name</span></code> と指定した場合は、指定したインデックスがOSのページキャッシュへ転送されます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_warm</span> <span class="pre">--name</span> <span class="pre">column_name</span></code> と指定した場合は、指定したカラムがOSののページキャッシュへ転送されます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_warm</span> <span class="pre">--name</span> <span class="pre">table_name</span></code> と指定した場合は、指定したテーブルをOSのページキャッシュへ転送します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_warm</span></code> と指定した場合は、GroongaのDB全体がOSのページキャッシュへ転送されます。</p></li>
</ul>
</div></blockquote>
<p>ただ、メモリーに空きスペースが無い場合は、このコマンドは効果がないことに注意してください。</p>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 内で特定のレコードのスコアーを調整できるようにしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">*~</span></code> という演算子を使うことで、特定のレコードのスコアーを調整できます。<code class="docutils literal notranslate"><span class="pre">*~</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> や <code class="docutils literal notranslate"><span class="pre">||</span></code> と同じ論理演算子です。したがって、 <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> や <code class="docutils literal notranslate"><span class="pre">||</span></code> と同じように使えます。<code class="docutils literal notranslate"><span class="pre">*~</span></code> のデフォルトの重みは -1 です。</p>
<p>したがって、例えば、 <code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*~</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code> は以下の操作を意味します。</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span></code> と <code class="docutils literal notranslate"><span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;MySQL&quot;</span></code> にマッチしたレコードを抽出します。</p></li>
<li><p>以下のようにスコアーを追加します。</p>
<ol class="loweralpha simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span></code> のスコアーを計算します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code> のスコアーを計算します。</p></li>
<li><p>bのスコアーを -1 倍します。</p></li>
<li><p>このレコードのスコアーは a + b です。したがって、 aのスコアー 1 で bのスコアーが1 の場合、このレコードのスコアーは 1 + (1 * -1) = 0 です。</p></li>
</ol>
</li>
</ol>
</div></blockquote>
<p>また、 <code class="docutils literal notranslate"><span class="pre">*~${score_quantity}</span></code> とすることで、スコアーの量を指定できます。</p>
<p>具体的には、 以下の条件( <code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*~2.5</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;MySQL&quot;'</span></code> ) にマッチしたレコードのスコアーを調整します。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is a full text search engine.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is the Ruby bindings of Groonga.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is a MySQL storage engine based of Groonga.&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content @ &quot;Groonga&quot; *~2.5 content @ &quot;Mroonga&quot;&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;content, _score&#39;</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span><span class="p">,</span><span class="n">_id</span>
<span class="p">{</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;return_code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mf">1624605205.641078</span><span class="p">,</span>
    <span class="s2">&quot;elapsed_time&quot;</span><span class="p">:</span> <span class="mf">0.002965450286865234</span>
  <span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;n_hits&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;records&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga is a full text search engine.&quot;</span><span class="p">,</span>
        <span class="mf">1.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Rroonga is the Ruby bindings of Groonga.&quot;</span><span class="p">,</span>
        <span class="mf">1.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Mroonga is a MySQL storage engine based of Groonga.&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.5</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><a class="reference internal" href="../reference/commands/select.html#select-adjuster"><span class="std std-ref">adjuster</span></a> を使っても同様のことができます。<a class="reference internal" href="../reference/commands/select.html#select-adjuster"><span class="std std-ref">adjuster</span></a> を使う場合、アプリケーション上で、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 条件と <code class="docutils literal notranslate"><span class="pre">--adjuster</span></code> 条件を作る必要がありますが、この改良で、 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 条件のみを作成すればよくなりました。</p>
<p>以下のように、 <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使って、filter条件を記述することもできます。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--filter</span> <span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*~2.5</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 重み付き <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> をサポートしました。</p>
<p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> を使うことで、重み付きの <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> を使えます。<code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> のデフォルトの重みは 0.5です。 <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> のデフォルトの重みは 2.0 です。</p>
<p><code class="docutils literal notranslate"><span class="pre">*&lt;${score_quantity}</span></code> や <code class="docutils literal notranslate"><span class="pre">*&gt;${score_quantity}</span></code> とすることで、スコアーの量を指定できます。また、 <code class="docutils literal notranslate"><span class="pre">*&lt;${score_quantity}</span></code> と指定した場合は、 ${score_quantity} の正負の符号が反転します。</p>
<p>例えば、 <code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;2.5</span> <span class="pre">query(&quot;content&quot;,</span> <span class="pre">&quot;MySQL&quot;)'</span></code> は以下の操作を意味します。</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span></code> と <code class="docutils literal notranslate"><span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;MySQL&quot;</span></code> にマッチしたレコードを抽出します。</p></li>
<li><p>以下のようにスコアーを追加します。</p>
<ol class="loweralpha simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span></code> のスコアーを計算します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query(&quot;content&quot;,</span> <span class="pre">&quot;MySQL&quot;)</span></code> のスコアーを計算します。</p></li>
<li><p>bのスコアーは、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> によって -2.5倍されます。</p></li>
<li><p>このレコードのスコアーは a + b です。したがって、 aのスコアー 1 で bのスコアーが1 の場合、このレコードのスコアーは 1 + (1 * -2.5) = −1.5 です。</p></li>
</ol>
</li>
</ol>
</div></blockquote>
<p>具体的には、 以下の条件( <code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*~2.5</span> <span class="pre">query(&quot;content&quot;,</span> <span class="pre">&quot;MySQL&quot;)'</span></code> にマッチしたレコードのスコアーを調整します。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">index</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is a full text search engine.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Rroonga is the Ruby bindings of Groonga.&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is a MySQL storage engine based of Groonga.&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;content @ &quot;Groonga&quot; *&lt;2.5 query(&quot;content&quot;, &quot;Mroonga&quot;)&#39;</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;content, _score&#39;</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span><span class="p">,</span><span class="n">_id</span>
<span class="p">{</span>
  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;return_code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="mf">1624605205.641078</span><span class="p">,</span>
    <span class="s2">&quot;elapsed_time&quot;</span><span class="p">:</span> <span class="mf">0.002965450286865234</span>
  <span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;n_hits&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ShortText&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;records&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga is a full text search engine.&quot;</span><span class="p">,</span>
        <span class="mf">1.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Rroonga is the Ruby bindings of Groonga.&quot;</span><span class="p">,</span>
        <span class="mf">1.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Mroonga is a MySQL storage engine based of Groonga.&quot;</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.5</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>[<a class="reference internal" href="../reference/log.html"><span class="doc">ログ</span></a>] 標準出力、標準エラー出力への出力をサポートしました。</p>
<p>[<a class="reference internal" href="../reference/log.html#process-log"><span class="std std-ref">プロセスログ</span></a>] と [<a class="reference internal" href="../reference/log.html#query-log"><span class="std std-ref">クエリーログ</span></a>] が標準出力と標準エラー出力への出力をサポートしました。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--log-path</span> <span class="pre">-</span></code> や <code class="docutils literal notranslate"><span class="pre">--query-log-path</span> <span class="pre">-</span></code> と指定した場合、Groongaはログを標準出力に出力します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--log-path</span> <span class="pre">+</span></code> や <code class="docutils literal notranslate"><span class="pre">--query-log-path</span> <span class="pre">+</span></code> と指定した場合、Groongaはログを標準エラー出力に出力します。</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="../reference/log.html#process-log"><span class="std std-ref">プロセスログ</span></a>] はGroongaの動作全てに関することのログです。 [<a class="reference internal" href="../reference/log.html#query-log"><span class="std std-ref">クエリーログ</span></a>] は、クエリー処理に関することだけのログです。</p>
<p>この機能はDocker上でGroongaを実行する際に有用です。Dockerは標準で標準出力と標準エラー出力を記録する機能を持っています。したがって、Groongaのログを取得するために、Dockerの環境にログインする必要がなくなります。</p>
<p>例えば、この機能は、以下のようなケースで有用です。</p>
<blockquote>
<div><ul>
<li><p>Docker上のGroongaのスロークエリーを解析したい場合。</p>
<p>Groonga起動時に <code class="docutils literal notranslate"><span class="pre">--query-log-path</span> <span class="pre">-</span></code> と指定している場合、以下のコマンドを実行するだけでスロークエリーを解析できます。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">${container_name}</span> <span class="pre">|</span> <span class="pre">groonga-query-log-analyze</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>このように、 Groonga上のDockerから出力したクエリーログを使って、簡単にスロークエリの解析ができます。</p>
</li>
<li><p>[ドキュメント] <code class="docutils literal notranslate"><span class="pre">string_substring</span></code> に不足している内容を追加しました。[Github#1209][Takashi Hashidaさんがパッチ提供]</p></li>
</ul>
</section>
<section id="id25">
<h3>既知の問題<a class="headerlink" href="#id25" title="Link to this heading">#</a></h3>
<ul>
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は、filter条件の右辺に <code class="docutils literal notranslate"><span class="pre">query()</span></code> を使う時のみ有効です。もし、以下のように指定した場合、 <code class="docutils literal notranslate"><span class="pre">*&lt;</span></code> と <code class="docutils literal notranslate"><span class="pre">*&gt;</span></code> は <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> として機能します。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Groonga&quot;</span> <span class="pre">*&lt;</span> <span class="pre">content</span> <span class="pre">&#64;</span> <span class="pre">&quot;Mroonga&quot;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="id26">
<h3>感謝<a class="headerlink" href="#id26" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-3-2021-05-29">
<span id="release-11-0-3"></span><h2>11.0.3リリース - 2021-05-29<a class="headerlink" href="#release-11-0-3-2021-05-29" title="Link to this heading">#</a></h2>
<section id="id27">
<h3>改良<a class="headerlink" href="#id27" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] クエリー毎に <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> を無効にできるようになりました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> は語幹を使った検索ができます。例えば <code class="docutils literal notranslate"><span class="pre">develop</span></code> も <code class="docutils literal notranslate"><span class="pre">developing</span></code> も <code class="docutils literal notranslate"><span class="pre">developed</span></code> も <code class="docutils literal notranslate"><span class="pre">develops</span></code> も、すべてステミングすると <code class="docutils literal notranslate"><span class="pre">develop</span></code> になります。そのため、 <code class="docutils literal notranslate"><span class="pre">develops</span></code> というクエリーで <code class="docutils literal notranslate"><span class="pre">develop</span></code> も <code class="docutils literal notranslate"><span class="pre">developing</span></code> も <code class="docutils literal notranslate"><span class="pre">developed</span></code> も検索できます。</p></li>
<li><p>今回のリリースでは、以下のように特定のクエリーでのみ <code class="docutils literal notranslate"><span class="pre">TokenFilterStem</span></code> を無効にして検索できるようになりました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">token_filters</span><span class="o">/</span><span class="n">stem</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span> \
  <span class="o">--</span><span class="n">token_filters</span> <span class="s1">&#39;TokenFilterStem(&quot;keep_original&quot;, true)&#39;</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I develop Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m developing Groonga&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I developed Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s1">&#39;&quot;developed groonga&quot;&#39;</span> \
  <span class="o">--</span><span class="n">query_options</span> <span class="s1">&#39;{&quot;TokenFilterStem.enable&quot;: false}&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;I developed Groonga&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>この機能は、通常は語幹を使った検索がしたいが、時々、以下のように(ステミングされていない)正確な語で検索したいときに有用です。</p>
<ul class="simple">
<li><p>ステミングされた語を使った検索だとGroongaが大量の検索結果を返す場合。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenFilerStem</span></code> が間違ったステミング結果を返す場合。</p></li>
<li><p>(ステミングされていない)正確な語を含むレコードのみを検索したい場合。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] クエリー毎に <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> を無効にできるようになりました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> は、予め登録したストップワードを検索から除外します。これは、 <code class="docutils literal notranslate"><span class="pre">and</span></code> や <code class="docutils literal notranslate"><span class="pre">is</span></code> などの頻出語を無視することで検索ノイズを減らすために使います。</p></li>
<li><p>ただ、ときどき、特定のクエリーでのみこれらの語を含めて検索したいときがあります。今回のリリースでは、以下のように特定のクエリーでのみ <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord</span></code> を無効にして検索できるようになりました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">token_filters</span><span class="o">/</span><span class="n">stop_word</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span> \
  <span class="o">--</span><span class="n">token_filters</span> <span class="n">TokenFilterStopWord</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">is_stop_word</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Bool</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Terms</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;is_stop_word&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello and Good-bye&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Good-bye&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="n">match_columns</span> <span class="n">content</span> \
  <span class="o">--</span><span class="n">query</span> <span class="s2">&quot;Hello and&quot;</span> \
  <span class="o">--</span><span class="n">query_options</span> <span class="s1">&#39;{&quot;TokenFilterStopWord.enable&quot;: false}&#39;</span> \
  <span class="o">--</span><span class="n">match_escalation_threshold</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Hello and Good-bye&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">--query-options</span></code> を使って、 <code class="docutils literal notranslate"><span class="pre">TokenFilterStopWord.enable</span></code> を指定していますが、以下のように <code class="docutils literal notranslate"><span class="pre">{&quot;options&quot;:</span> <span class="pre">{&quot;TokenFilterStopWord.enable&quot;:</span> <span class="pre">false}}</span></code> を使っても指定できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">token_filters</span><span class="o">/</span><span class="n">stop_word</span>

<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Memos</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span> \
  <span class="o">--</span><span class="n">token_filters</span> <span class="n">TokenFilterStopWord</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">memos_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Memos</span> <span class="n">content</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">is_stop_word</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Bool</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Terms</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;is_stop_word&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello and Good-bye&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Good-bye&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Memos</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;query(&quot;content&quot;, </span><span class="se">\</span>
<span class="s1">                  &quot;Hello and&quot;, </span><span class="se">\</span>
<span class="s1">                  {&quot;options&quot;: {&quot;TokenFilterStopWord.enable&quot;: false}})&#39;</span> \
  <span class="o">--</span><span class="n">match_escalation_threshold</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">sort_keys</span> <span class="o">-</span><span class="n">_score</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;Hello and Good-bye&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>この機能は、よく使われる語を含めて検索しないとGroongaが正しい結果を返さない時に便利です。(例えば、曲名や店名等を検索する場合です。)</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/normalizers.html"><span class="doc">ノーマライザー</span></a>][NormalizerNFKC] 新しいオプション <code class="docutils literal notranslate"><span class="pre">remove_new_line</span></code> を追加しました。</p>
<ul class="simple">
<li><p>データを格納するテーブルのキーを正規化したい場合、そのテーブルにノーマライザーを設定しますが、通常ノーマライザーは改行を削除します。</p></li>
<li><p>ノーマライザーが改行を削除してしまうと、Groongaは改行のみのキーを扱えません。</p></li>
<li><p>このオプションを使うことで、改行のみのデータをキーとして登録できます。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/string_slice.html"><span class="doc">string_slice</span></a>] 新しい関数 <code class="docutils literal notranslate"><span class="pre">string_slice()</span></code> を追加しました。 [Github#1177][Takashi Hashidaさんがパッチ提供]</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">string_slice()</span></code> は、文字列の部分文字列を抽出します。</p></li>
<li><p>この関数を使うには、 <code class="docutils literal notranslate"><span class="pre">functions/string</span></code> プラグインの登録が必要です。</p></li>
<li><p>以下のように、引数によって２つの異なる抽出方法を使えます。</p>
<ul>
<li><p>位置を使った抽出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">string</span>
<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Memos</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_key, string_slice(_key, 2, 3)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;string_slice&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oon&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>正規表現を使った抽出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">string</span>
<span class="n">table_create</span> <span class="n">Memos</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Memos</span>
<span class="p">[</span>
  <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Memos</span> <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_key, string_slice(_key, &quot;(Gro+)(.*)&quot;, 2)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span><span class="n">p</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1337566253.89858</span><span class="p">,</span>
    <span class="mf">0.000355720520019531</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;string_slice&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Groonga&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nga&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 16.04 LTS (Xenial Xerus)のサポートをやめました。</p></li>
<li><p>Visual Studio 用の EditorConfig を追加しました。[GitHub#1191][Takashi Hashidaさんがパッチ提供]</p>
<ul class="simple">
<li><p>多くの設定は、Visual Studio 専用です。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.20.1に更新しました。</p>
<ul class="simple">
<li><p>CVE-2021-23017のセキュリティの修正が含まれています。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id28">
<h3>修正<a class="headerlink" href="#id28" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>オプションをサポートしているトークナイザーやノーマライザー、トークンフィルターが使われている際、多くの検索クエリーを送信するとGroongaが応答を返さなくなることがある問題を修正しました。</p></li>
</ul>
</section>
<section id="id29">
<h3>既知の問題<a class="headerlink" href="#id29" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。</p></li>
</ul>
</section>
<section id="id30">
<h3>感謝<a class="headerlink" href="#id30" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Takashi Hashidaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-2-2021-05-10">
<span id="release-11-0-2"></span><h2>11.0.2リリース - 2021-05-10<a class="headerlink" href="#release-11-0-2-2021-05-10" title="Link to this heading">#</a></h2>
<section id="id31">
<h3>改良<a class="headerlink" href="#id31" title="Link to this heading">#</a></h3>
<ul>
<li><p>[Documentation] <code class="docutils literal notranslate"><span class="pre">ruby_load</span></code> コマンドのリファレンスを削除しました。　[GitHub#1172][Anthony M. Cookさんがパッチ提供]</p>
<ul class="simple">
<li><p>このコマンドはすでに削除されているためです。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] Debian 11(Bullseye) をサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--post_filter</span></code> をサポートしました。</p>
<ul>
<li><p>以下のように、 <code class="docutils literal notranslate"><span class="pre">filtered</span></code> ステージの動的カラムに対して <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使ってフィルターできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s2">&quot;price &gt;= 150&quot;</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">price_with_tax</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">filtered</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">price_with_tax</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">UInt32</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">price_with_tax</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">price_with_tax</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="s2">&quot;price * 1.1&quot;</span> \
  <span class="o">--</span><span class="n">post_filter</span> <span class="s2">&quot;price_with_tax &lt;= 250&quot;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price_with_tax&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">165</span><span class="p">,</span>
        <span class="mi">150</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">220</span><span class="p">,</span>
        <span class="mi">200</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--slices[].post_filter</span></code> をサポートしました。</p>
<ul>
<li><p>以下のように、 <code class="docutils literal notranslate"><span class="pre">--slices[].filter</span></code> の条件でフィルターされた結果に対して <code class="docutils literal notranslate"><span class="pre">post_filter</span></code> を使えます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Items</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Items</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Items</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Items</span> \
  <span class="o">--</span><span class="n">slices</span><span class="p">[</span><span class="n">expensive</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span> <span class="s1">&#39;price &gt;= 1000&#39;</span> \
  <span class="o">--</span><span class="n">slices</span><span class="p">[</span><span class="n">expensive</span><span class="p">]</span><span class="o">.</span><span class="n">post_filter</span> <span class="s1">&#39;price &lt; 3000&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;price&quot;</span><span class="p">,</span>
          <span class="s2">&quot;UInt32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">100</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">200</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">300</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="mi">1000</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">2000</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="mi">3000</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">{</span>
      <span class="s2">&quot;expensive&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">2</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UInt32&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;price&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UInt32&quot;</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="mi">4</span><span class="p">,</span>
          <span class="mi">1000</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="mi">5</span><span class="p">,</span>
          <span class="mi">2000</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] <code class="docutils literal notranslate"><span class="pre">--sort_keys</span></code> 内に式を記述できるようになりました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--sort_keys</span></code> に式を記述できます。</p>
<ul class="simple">
<li><p>存在しないキーが sort_keys の式に含まれていた場合、それらは、無視され警告がログに出力されます。</p></li>
</ul>
</li>
<li><p>これによって、例えば、 <code class="docutils literal notranslate"><span class="pre">--sort_keys</span></code> に <code class="docutils literal notranslate"><span class="pre">VECTOR_COLUMN</span></code> の要素を指定し、 <code class="docutils literal notranslate"><span class="pre">VECTOR_COLUMN</span></code> の要素で結果をソートできます。</p></li>
<li><p>以前のバージョンでも動的カラムを使えば、 <code class="docutils literal notranslate"><span class="pre">VECTOR</span> <span class="pre">COLUMN</span></code> の要素で結果をソートできましたが、この機能によって、動的カラムを使わずに <code class="docutils literal notranslate"><span class="pre">VECTOR_COLUMN</span></code> の要素で結果をソートできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Values</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Values</span> <span class="n">numbers</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Int32</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Values</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">127</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">129</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">126</span><span class="p">,</span> <span class="mi">255</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;numbers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="o">-</span><span class="mi">254</span><span class="p">]}</span>
<span class="p">]</span>
<span class="n">select</span> <span class="n">Values</span> <span class="o">--</span><span class="n">sort_keys</span> <span class="s1">&#39;numbers[1]&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">numbers</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;numbers&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">128</span><span class="p">,</span>
          <span class="o">-</span><span class="mi">254</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">127</span><span class="p">,</span>
          <span class="mi">128</span><span class="p">,</span>
          <span class="mi">129</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="mi">126</span><span class="p">,</span>
          <span class="mi">255</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/token_filters.html"><span class="doc">トークンフィルター</span></a>] オプションをつけた複数のトークンフィルターを使えるようにしました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--token_filters</span> <span class="pre">'TokenFilterStopWord(&quot;column&quot;,</span> <span class="pre">&quot;ignore&quot;),</span> <span class="pre">TokenFilterNFKC130(&quot;unify_kana&quot;,</span> <span class="pre">true)'</span></code> のように複数のトークンフィルターを指定できます。 [Github#mroonga/mroonga#399][MASUDA Kazuhiroさんが報告]</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query.html"><span class="doc">query</span></a>] 複雑な式で <code class="docutils literal notranslate"><span class="pre">result_set</span></code> ステージの動的カラムを扱えるようにしました。</p>
<ul>
<li><p>複雑な式とは、以下のように一時的な内部結果セットが必要な式です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;(true &amp;&amp; query(&quot;name * 10&quot;, &quot;ali&quot;, {&quot;score_column&quot;: &quot;ali_score&quot;})) || </span><span class="se">\</span>
<span class="s1"> (true &amp;&amp; query(&quot;name * 2&quot;, &quot;li&quot;, {&quot;score_column&quot;: &quot;li_score&quot;}))&#39;</span>
</pre></div>
</div>
<ul>
<li><p>上記の式では、 <code class="docutils literal notranslate"><span class="pre">true</span></code> の評価結果を格納するために一時的な結果セットを使用します。</p></li>
<li><p>したがって、例えば、以下の式では、式の中で <code class="docutils literal notranslate"><span class="pre">result_set</span></code> ステージの動的カラムの値を使えます。以下の式では、一時的な内部結果セットが必要ないためです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;(query(&quot;name * 10&quot;, &quot;ali&quot;, {&quot;score_column&quot;: &quot;ali_score&quot;})) || </span><span class="se">\</span>
<span class="s1"> (query(&quot;name * 2&quot;, &quot;li&quot;, {&quot;score_column&quot;: &quot;li_score&quot;}))&#39;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>今回のリリースでは、以下のように <code class="docutils literal notranslate"><span class="pre">li_score</span></code> に値を設定できます。(以前のバージョンでは、2番めの式が動的カラムの値を取得出来なかったため、 <code class="docutils literal notranslate"><span class="pre">li_score</span></code> の値は <code class="docutils literal notranslate"><span class="pre">0</span></code> になっていました。)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Lexicon</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigramSplitSymbolAlphaDigit</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Lexicon</span> <span class="n">users_name</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alisa&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">ali_score</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">result_set</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">ali_score</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">ali_score</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">li_score</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">result_set</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">li_score</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">Float</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">li_score</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">name</span><span class="p">,</span><span class="n">_score</span><span class="p">,</span><span class="n">ali_score</span><span class="p">,</span><span class="n">li_score</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;(true &amp;&amp; query(&quot;name * 10&quot;, &quot;ali&quot;, {&quot;score_column&quot;: &quot;ali_score&quot;})) || </span><span class="se">\</span>
<span class="s1">            (true &amp;&amp; query(&quot;name * 2&quot;, &quot;li&quot;, {&quot;score_column&quot;: &quot;li_score&quot;}))&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;ali_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Float&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;li_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Float&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
        <span class="mi">14</span><span class="p">,</span>
        <span class="mf">10.0</span><span class="p">,</span>
        <span class="mf">2.0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alisa&quot;</span><span class="p">,</span>
        <span class="mi">14</span><span class="p">,</span>
        <span class="mf">10.0</span><span class="p">,</span>
        <span class="mf">2.0</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>以下のように、 <code class="docutils literal notranslate"><span class="pre">result_set</span></code> ステージの動的ベクターカラムも扱えるようにしました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Users</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Users</span> <span class="n">name</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Lexicon</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigramSplitSymbolAlphaDigit</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerAuto</span>
<span class="n">column_create</span> <span class="n">Lexicon</span> <span class="n">users_name</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> <span class="n">Users</span> <span class="n">name</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Users</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alisa&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Users</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">result_set</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">name</span><span class="p">,</span><span class="n">tags</span> \
  <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;(true &amp;&amp; query(&quot;name&quot;, &quot;al&quot;, {&quot;tags&quot;: [&quot;al&quot;], &quot;tags_column&quot;: &quot;tags&quot;})) || </span><span class="se">\</span>
<span class="s1">            (true &amp;&amp; query(&quot;name&quot;, &quot;sa&quot;, {&quot;tags&quot;: [&quot;sa&quot;], &quot;tags_column&quot;: &quot;tags&quot;}))&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">2</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;name&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;al&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;Alisa&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;al&quot;</span><span class="p">,</span>
          <span class="s2">&quot;sa&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>動的ベクターカラムを使う場合、格納する値は各要素が追加された値になります。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../install/ubuntu.html"><span class="doc">Ubuntu</span></a>] Ubuntu 21.04 (Hirsute Hippo)をサポートしました。</p></li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.10に更新しました。</p></li>
</ul>
</section>
<section id="id32">
<h3>既知の問題<a class="headerlink" href="#id32" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
<li><p>[ブラウザーベースの管理ツール] 現在Groongaには、レコード一覧の管理モードのチェックボックスにチェックを入れても、非管理モードに入力された検索クエリーが送信されるという問題があります。 [Github#1186][potiさんが報告]</p></li>
</ul>
</section>
<section id="id33">
<h3>感謝<a class="headerlink" href="#id33" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Anthony M. Cookさん</p></li>
<li><p>MASUDA Kazuhiroさん</p></li>
<li><p>potiさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-1-2021-03-31">
<span id="release-11-0-1"></span><h2>11.0.1リリース - 2021-03-31<a class="headerlink" href="#release-11-0-1-2021-03-31" title="Link to this heading">#</a></h2>
<section id="id34">
<h3>改良<a class="headerlink" href="#id34" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../install/debian.html"><span class="doc">Debian GNU/Linux</span></a>] ARM64向けのパッケージをサポートしました。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] キーワードごとに重みをカスタマイズできるようにしました。</p>
<ul class="simple">
<li><p>今まで、スコアーを調整するには、すべてのキーワードに対して <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> や <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> を指定する必要がありました。デフォルトのスコアの重み(1)より、デフォルトの重みの調整量(6 または 4)のほうが大きいためです。</p>
<ul>
<li><p>例えば、<code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&lt;B</span></code> では、 &quot;A&quot; の重みは1、 &quot;B&quot; の重みは4になります。デクリメントされていない &quot;A&quot; の重み(1)より、デクリメントされた &quot;B&quot; の重み(4)のほうが大きくなります。これは、期待した動作ではありません。&quot;B&quot; に &quot;A&quot; より小さい重みを使うためには、 <code class="docutils literal notranslate"><span class="pre">&gt;A</span> <span class="pre">&lt;B</span></code> と指定する必要があります。<code class="docutils literal notranslate"><span class="pre">&gt;A</span> <span class="pre">&lt;B</span></code> では、 &quot;A&quot; の重みは6、 &quot;B&quot; の重みは4になります。</p></li>
</ul>
</li>
<li><p>今回のリリースから、対象のキーワードに <code class="docutils literal notranslate"><span class="pre">&lt;${WEIGHT}</span></code> または <code class="docutils literal notranslate"><span class="pre">&gt;${WEIGHT}</span></code> と指定するだけで、キーワードごとに重みの調整量をカスタマイズできます。例えば、 <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&lt;0.1B</span></code> では、 &quot;A&quot; の重みは1、 &quot;B&quot; の重みは0.9になります。(&quot;B&quot; の重みを0.1デクリメントしています。)</p></li>
<li><p>ただし、これらの形式(<code class="docutils literal notranslate"><span class="pre">&gt;${WEIGHT}...</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;${WEIGHT}...</span></code>, and <code class="docutils literal notranslate"><span class="pre">~${WEIGHT}...</span></code>)は互換性が無いことに注意してください。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] Apache Arrow形式で <code class="docutils literal notranslate"><span class="pre">Float</span></code> と <code class="docutils literal notranslate"><span class="pre">Float32</span></code> の値を出力できるようにしました。</p>
<ul class="simple">
<li><p>例えば、以下のように出力します。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Data</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Data</span> <span class="nb">float</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Float</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Data</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Data</span> \
  <span class="o">--</span><span class="n">command_version</span> <span class="mi">3</span> \
  <span class="o">--</span><span class="n">output_type</span> <span class="n">apache</span><span class="o">-</span><span class="n">arrow</span>

  <span class="n">return_code</span><span class="p">:</span> <span class="n">int32</span>
  <span class="n">start_time</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
  <span class="n">elapsed_time</span><span class="p">:</span> <span class="n">double</span>
  <span class="o">--</span> <span class="n">metadata</span> <span class="o">--</span>
  <span class="n">GROONGA</span><span class="p">:</span><span class="n">data_type</span><span class="p">:</span> <span class="n">metadata</span>
   <span class="n">return_code</span>                    <span class="n">start_time</span>       <span class="n">elapsed_time</span>
  <span class="mi">0</span>                  <span class="mi">0</span>     <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T09</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>           <span class="mf">0.000000</span>
  <span class="o">========================================</span>
  <span class="n">_id</span><span class="p">:</span> <span class="n">uint32</span>
  <span class="nb">float</span><span class="p">:</span> <span class="n">double</span>
  <span class="o">--</span> <span class="n">metadata</span> <span class="o">--</span>
  <span class="n">GROONGA</span><span class="p">:</span><span class="n">n_hits</span><span class="p">:</span> <span class="mi">1</span>
   <span class="n">_id</span>          <span class="nb">float</span>
  <span class="mi">0</span>          <span class="mi">1</span>       <span class="mf">1.100000</span>
</pre></div>
</div>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 結果出力時に、インデックスカラム経由で参照先のデータを取得できるようになりました。</p>
<ul>
<li><p>今までは、 出力値に <code class="docutils literal notranslate"><span class="pre">index_column.xxx</span></code> のように指定すると、Groongaは意図しない値を返していました。例えば以下の例では、 <code class="docutils literal notranslate"><span class="pre">--columns[tags].value</span> <span class="pre">purchases.tag</span></code> の値は、 <code class="docutils literal notranslate"><span class="pre">[&quot;apple&quot;,[&quot;many&quot;]],[&quot;banana&quot;,[&quot;man&quot;]],[&quot;cacao&quot;,[&quot;man&quot;]]</span></code> になりました。このケースでは、期待される値は、 <code class="docutils literal notranslate"><span class="pre">[&quot;apple&quot;,[&quot;man&quot;,&quot;many&quot;]],[&quot;banana&quot;,[&quot;man&quot;]],[&quot;cacao&quot;,[&quot;woman&quot;]]</span></code> でした。今回のリリースから、以下のように、インデックスカラム経由で参照先の正しい値を取得できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">product</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Products</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">column_create</span> <span class="n">Products</span> <span class="n">purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Purchases</span> <span class="n">product</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Products</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;banana&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;cacao&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Purchases</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;man&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;man&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;woman&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;many&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="n">output</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">columns</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="n">purchases</span><span class="o">.</span><span class="n">tag</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">tags</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;man&quot;</span><span class="p">,</span>
          <span class="s2">&quot;many&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;banana&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;man&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;woman&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] ネストされたインデックスの一部として直接インデックスカラムを指定できるようになりました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">index_column.except_source_column</span></code> を使ってフィルター後にソーステーブルを検索できます。例えば、以下の例では、検索時に <code class="docutils literal notranslate"><span class="pre">comments.content</span></code> を指定しています。この場合、最初に、このクエリは <code class="docutils literal notranslate"><span class="pre">Comments</span></code> テーブルの <code class="docutils literal notranslate"><span class="pre">content</span></code> カラムを全文検索し、次に <code class="docutils literal notranslate"><span class="pre">Comments</span></code> テーブルを検索した結果のレコードを参照する <code class="docutils literal notranslate"><span class="pre">Articles</span></code> テーブルのレコードを取得します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Articles</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Comments</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Comments</span> <span class="n">article</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Articles</span>
<span class="n">column_create</span> <span class="n">Comments</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">column_create</span> <span class="n">Articles</span> <span class="n">content</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Text</span>
<span class="n">column_create</span> <span class="n">Articles</span> <span class="n">comments</span> <span class="n">COLUMN_INDEX</span> <span class="n">Comments</span> <span class="n">article</span>

<span class="n">table_create</span> <span class="n">Terms</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span> \
  <span class="o">--</span><span class="n">default_tokenizer</span> <span class="n">TokenBigram</span> \
  <span class="o">--</span><span class="n">normalizer</span> <span class="n">NormalizerNFKC130</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">articles_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> \
  <span class="n">Articles</span> <span class="n">content</span>
<span class="n">column_create</span> <span class="n">Terms</span> <span class="n">comments_content</span> <span class="n">COLUMN_INDEX</span><span class="o">|</span><span class="n">WITH_POSITION</span> \
  <span class="n">Comments</span> <span class="n">content</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Articles</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;article-1&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is fast!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;article-2&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Groonga is useful!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;article-3&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Mroonga is fast!&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Comments</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;article&quot;</span><span class="p">:</span> <span class="s2">&quot;article-1&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m using Groonga too!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;article&quot;</span><span class="p">:</span> <span class="s2">&quot;article-3&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m using Mroonga!&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;article&quot;</span><span class="p">:</span> <span class="s2">&quot;article-1&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m using PGroonga!&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Articles</span> <span class="o">--</span><span class="n">match_columns</span> <span class="n">comments</span><span class="o">.</span><span class="n">content</span> <span class="o">--</span><span class="n">query</span> <span class="n">groonga</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s2">&quot;_key, _score, comments.content</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">1</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Int32&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;comments.content&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;article-1&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="s2">&quot;I&#39;m using Groonga too!&quot;</span><span class="p">,</span>
          <span class="s2">&quot;I&#39;m using PGroonga!&quot;</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] オブジェクトリテラルを使って、参照先のレコードをロードできるようにしました。</p>
<ul>
<li><p>例えば、以下のように、 <code class="docutils literal notranslate"><span class="pre">&quot;key&quot;</span> <span class="pre">:</span> <span class="pre">&quot;[</span> <span class="pre">{</span> <span class="pre">&quot;key&quot;</span> <span class="pre">:</span> <span class="pre">&quot;value&quot;,</span> <span class="pre">...,</span> <span class="pre">&quot;key&quot;</span> <span class="pre">:</span> <span class="pre">&quot;value&quot;</span> <span class="pre">}</span> <span class="pre">]&quot;</span></code> のようなデータをロードできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">table_create</span> <span class="n">Settlements</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Settlements</span> <span class="n">purchases</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Purchases</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">settlements_purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Settlements</span> <span class="n">purchases</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Settlements</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;super market&quot;</span><span class="p">,</span>
  <span class="s2">&quot;purchases&quot;</span><span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
     <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;milk&quot;</span><span class="p">,</span>  <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;shoes shop&quot;</span><span class="p">,</span>
  <span class="s2">&quot;purchases&quot;</span><span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;sneakers&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>この機能によって、参照カラムにJSONデータを追加しやすくなります。</p></li>
<li><p>現状、この機能は、JSONの入力のみをサポートしています。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/load.html"><span class="doc">load</span></a>] JSON文字列で、参照先のレコードをロードできるようにしました。</p>
<ul>
<li><p>以下のように、JSONテキストを使ってソーステーブルから参照ベクターへデータをロードできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">item</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">price</span> <span class="n">COLUMN_SCALAR</span> <span class="n">UInt32</span>

<span class="n">table_create</span> <span class="n">Settlements</span> <span class="n">TABLE_HASH_KEY</span> <span class="n">ShortText</span>
<span class="n">column_create</span> <span class="n">Settlements</span> <span class="n">purchases</span> <span class="n">COLUMN_VECTOR</span> <span class="n">Purchases</span>

<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">settlements_purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Settlements</span> <span class="n">purchases</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Settlements</span>
<span class="p">[</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;super market&quot;</span><span class="p">,</span>
  <span class="s2">&quot;purchases&quot;</span><span class="p">:</span> <span class="s2">&quot;[{</span><span class="se">\&quot;</span><span class="s2">_key</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">super market-1</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">item</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">apple</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">price</span><span class="se">\&quot;</span><span class="s2">: 100}, {</span><span class="se">\&quot;</span><span class="s2">_key</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">super market-2</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">item</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">milk</span><span class="se">\&quot;</span><span class="s2">,  </span><span class="se">\&quot;</span><span class="s2">price</span><span class="se">\&quot;</span><span class="s2">: 200}]&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;shoes shop&quot;</span><span class="p">,</span>
  <span class="s2">&quot;purchases&quot;</span><span class="p">:</span> <span class="s2">&quot;[{</span><span class="se">\&quot;</span><span class="s2">_key</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">shoes shop-1</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">item</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">sneakers</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">price</span><span class="se">\&quot;</span><span class="s2">: 3000}]&quot;</span>
<span class="p">}</span>
<span class="p">]</span>

<span class="n">dump</span> \
  <span class="o">--</span><span class="n">dump_plugins</span> <span class="n">no</span> \
  <span class="o">--</span><span class="n">dump_schema</span> <span class="n">no</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Purchases</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;item&quot;</span><span class="p">,</span><span class="s2">&quot;price&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;super market-1&quot;</span><span class="p">,</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;super market-2&quot;</span><span class="p">,</span><span class="s2">&quot;milk&quot;</span><span class="p">,</span><span class="mi">200</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;shoes shop-1&quot;</span><span class="p">,</span><span class="s2">&quot;sneakers&quot;</span><span class="p">,</span><span class="mi">3000</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Settlements</span>
<span class="p">[</span>
<span class="p">[</span><span class="s2">&quot;_key&quot;</span><span class="p">,</span><span class="s2">&quot;purchases&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;super market&quot;</span><span class="p">,[</span><span class="s2">&quot;super market-1&quot;</span><span class="p">,</span><span class="s2">&quot;super market-2&quot;</span><span class="p">]],</span>
<span class="p">[</span><span class="s2">&quot;shoes shop&quot;</span><span class="p">,[</span><span class="s2">&quot;shoes shop-1&quot;</span><span class="p">]]</span>
<span class="p">]</span>

<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">settlements_purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Settlements</span> <span class="n">purchases</span>
</pre></div>
</div>
</li>
<li><p>現状、この機能は、ネストされた参照レコードをサポートしていません。</p></li>
</ul>
</li>
<li><p>[Windows] <code class="docutils literal notranslate"><span class="pre">time_classify_*</span></code> 関数で UNIXエポック を扱えるようになりました。</p>
<ul>
<li><p>Groongaは、現地時刻でタイムスタンプを扱っています。したがって、例えば日本でUNIXエポックを入力した場合、入力した時刻はUNIXエポックの9時間前になります。</p></li>
<li><p>WindowsのAPIはUNIXエポックより前の時間が入力されるとエラーになります。</p></li>
<li><p>今回のリリースから、以下のようにUNIXエポックを <code class="docutils literal notranslate"><span class="pre">time_classify_*</span></code> 内で使えるように</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin_register</span> <span class="n">functions</span><span class="o">/</span><span class="n">time</span>

<span class="n">table_create</span> <span class="n">Timestamps</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">Time</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Timestamps</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-06 00:00:00.000001&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-06 23:59:59.999999&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-07 00:00:00.000000&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-07 00:00:00.000001&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-08 23:59:59.999999&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-05-08 00:00:00.000000&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Timestamps</span> \
  <span class="o">--</span><span class="n">sortby</span> <span class="n">_id</span> \
  <span class="o">--</span><span class="n">limit</span> <span class="o">-</span><span class="mi">1</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="s1">&#39;_key, time_classify_day_of_week(_key)&#39;</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">7</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Time&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;time_classify_day_of_week&quot;</span><span class="p">,</span>
          <span class="n">null</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">0.0</span><span class="p">,</span>
        <span class="mi">4</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462460400.000001</span><span class="p">,</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462546799.999999</span><span class="p">,</span>
        <span class="mi">5</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462546800.0</span><span class="p">,</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462546800.000001</span><span class="p">,</span>
        <span class="mi">6</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462719599.999999</span><span class="p">,</span>
        <span class="mi">0</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="mf">1462633200.0</span><span class="p">,</span>
        <span class="mi">0</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/functions/query_parallel_or.html"><span class="doc">query_parallel_or</span></a>] クエリーを並行して実行できる新しい関数を追加しました。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> でクエリーを並行で処理するためにはApache Arrowが必要です。Apache Arrowが無い場合は、 <code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> はクエリーをシーケンシャルに実行します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> は、 <code class="docutils literal notranslate"><span class="pre">match_columns</span></code> と <code class="docutils literal notranslate"><span class="pre">query_string</span></code> の組み合わせを平行に処理します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query_parallel_or</span></code> の構文は以下の通りです。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query_parallel_or</span><span class="p">(</span><span class="n">match_columns</span><span class="p">,</span> <span class="n">query_string1</span><span class="p">,</span>
                                 <span class="n">query_string2</span><span class="p">,</span>
                                 <span class="o">.</span>
                                 <span class="o">.</span>
                                 <span class="o">.</span>
                                 <span class="n">query_stringN</span><span class="p">,</span>
                                 <span class="p">{</span><span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">})</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] 存在しないソートキーを無視するようにしました。</p>
<ul class="simple">
<li><p>今まで、存在しないソートキーを指定したとき、Groongaはエラーを出力していましたが、今回のリリースから存在しないソートキーを無視します。(エラーを出力しなくなります。)</p></li>
<li><p>この機能は、一貫性のために実装しています。<code class="docutils literal notranslate"><span class="pre">output_columns</span></code> も無効な値を無視します。また、 <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> も無効な値のほとんどを無視します。</p></li>
</ul>
</li>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] drilldowns[].table で存在しないテーブルを無視します。 [GitHub#1169][naoaさんが報告]</p>
<ul class="simple">
<li><p>今まで、  <code class="docutils literal notranslate"><span class="pre">drilldowns[].table</span></code> で存在しないテーブルを指定したとき、Groongaはエラーを出力していましたが、今回のリリースから存在しないテーブルを無視します。(エラーを出力しなくなります。)</p></li>
<li><p>この機能は、一貫性のために実装しています。<code class="docutils literal notranslate"><span class="pre">output_columns</span></code> も無効な値を無視します。また、 <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> も無効な値のほとんどを無視します。</p></li>
</ul>
</li>
<li><p>[httpd] バンドルしているnginxのバージョンを1.19.8に更新しました。</p></li>
</ul>
</section>
<section id="id35">
<h3>修正<a class="headerlink" href="#id35" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>[<a class="reference internal" href="../reference/commands/reference_acquire.html"><span class="doc">reference_acquire</span></a>] 参照の自動リリースが発生する前に、テーブルにカラムが追加されテーブルの参照が獲得されたときにGroongaがクラッシュする問題を修正しました。</p>
<ul>
<li><p>追加されたカラムの参照は獲得されませんが、自動リリースの対象になるためです。</p></li>
</ul>
</li>
<li><p>[Windows] 別のスレッドで、他のバックトレースロギングプロセスが動作しているときに、新しくバックトレースロギングプロセスが開始されると、1つ以上のプロセスがSEGVのバックトレースの出力に失敗する問題を修正しました。</p></li>
</ul>
</section>
<section id="id36">
<h3>既知の問題<a class="headerlink" href="#id36" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>現在Groongaには、ベクターカラムに対してデータを大量に追加、削除、更新した際にデータが破損することがある問題があります。</p></li>
</ul>
</section>
<section id="id37">
<h3>感謝<a class="headerlink" href="#id37" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>naoaさん</p></li>
</ul>
</section>
</section>
<section id="release-11-0-0-2021-02-09">
<span id="release-11-0-0"></span><h2>11.0.0リリース - 2021-02-09<a class="headerlink" href="#release-11-0-0-2021-02-09" title="Link to this heading">#</a></h2>
<p>メジャーバージョンアップです! メジャーバージョンアップですが、互換性は壊れていないので、データベースを再構築することなく11.0.0へアップグレードできます。</p>
<section id="id38">
<h3>改良<a class="headerlink" href="#id38" title="Link to this heading">#</a></h3>
<ul>
<li><p>[<a class="reference internal" href="../reference/commands/select.html"><span class="doc">select</span></a>] ネストされたインデックス経由でスカラーカラムとベクターカラムの値を出力できるようになりました。</p>
<ul>
<li><p>ネストされたインデックスとは、以下のような構造です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">product</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Products</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">column_create</span> <span class="n">Products</span> <span class="n">purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Purchases</span> <span class="n">product</span>
</pre></div>
</div>
</li>
<li><p>上記の例では、 <code class="docutils literal notranslate"><span class="pre">Products.purchases</span></code> カラムは <code class="docutils literal notranslate"><span class="pre">Purchases.product</span></code> カラムのインデックスです。また、 <code class="docutils literal notranslate"><span class="pre">Purchases.product</span></code> カラムは、 <code class="docutils literal notranslate"><span class="pre">Products</span></code> テーブルへの参照です。</p></li>
<li><p>今までは、ネストされたインデックス経由の検索は、期待した結果を返しませんでした。</p></li>
<li><p>今までの結果は以下のようになっていました。 <code class="docutils literal notranslate"><span class="pre">{&quot;product&quot;:</span> <span class="pre">&quot;apple&quot;,</span>&#160; <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;man&quot;}</span></code> が出力されていないことがわかります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="n">Products</span> <span class="n">TABLE_PAT_KEY</span> <span class="n">ShortText</span>

<span class="n">table_create</span> <span class="n">Purchases</span> <span class="n">TABLE_NO_KEY</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">product</span> <span class="n">COLUMN_SCALAR</span> <span class="n">Products</span>
<span class="n">column_create</span> <span class="n">Purchases</span> <span class="n">tag</span> <span class="n">COLUMN_SCALAR</span> <span class="n">ShortText</span>

<span class="n">column_create</span> <span class="n">Products</span> <span class="n">purchases</span> <span class="n">COLUMN_INDEX</span> <span class="n">Purchases</span> <span class="n">product</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Products</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;banana&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span> <span class="s2">&quot;cacao&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Purchases</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;man&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;man&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;woman&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;many&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">select</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">purchases</span><span class="o">.</span><span class="n">tag</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">1612504193.380738</span><span class="p">,</span>
    <span class="mf">0.0002026557922363281</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;purchases.tag&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
        <span class="s2">&quot;many&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;banana&quot;</span><span class="p">,</span>
        <span class="s2">&quot;man&quot;</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>
        <span class="s2">&quot;man&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>このリリースから、結果は以下のようになります。 <code class="docutils literal notranslate"><span class="pre">{&quot;product&quot;:</span> <span class="pre">&quot;apple&quot;,</span>&#160; <span class="pre">&quot;tag&quot;:</span> <span class="pre">&quot;man&quot;}</span></code> が出力されているのがわかります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">Products</span> \
  <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">purchases</span><span class="o">.</span><span class="n">tag</span>
<span class="p">[</span>
  <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span>
      <span class="p">[</span>
        <span class="mi">3</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">&quot;_key&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ShortText&quot;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">&quot;purchases.tags&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Tags&quot;</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;man&quot;</span><span class="p">,</span>
            <span class="s2">&quot;one&quot;</span>
          <span class="p">],</span>
          <span class="p">[</span>
            <span class="s2">&quot;child&quot;</span><span class="p">,</span>
            <span class="s2">&quot;many&quot;</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;banana&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;man&quot;</span><span class="p">,</span>
            <span class="s2">&quot;many&quot;</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s2">&quot;cacao&quot;</span><span class="p">,</span>
        <span class="p">[</span>
          <span class="p">[</span>
            <span class="s2">&quot;woman&quot;</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>[Windows] Linux上のMinGWを使ってクロスコンパイルしていたWindows向けパッケージの提供をやめました。</p>
<ul class="simple">
<li><p>おそらく、ほとんどの人がこのパッケージを使っていないためです。</p></li>
<li><p>上記のパッケージはこれまで、以下のような名前で提供されていたものです。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-x.x.x-x86.exe</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-x.x.x-x86.zip</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-x.x.x-x64.exe</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-x.x.x-x86.zip</span></code></p></li>
</ul>
</li>
<li><p>これからは、以下のパッケージを使用してください。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-latest-x86-vs2019-with-vcruntime.zip</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-latest-x64-vs2019-with-vcruntime.zip</span></code></p></li>
</ul>
</li>
<li><p>既に Microsoft Visual C++ Runtime Library がインストール済みのシステムの場合は、以下のパッケージを使用してください。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-latest-x86-vs2019.zip</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groonga-latest-x64-vs2019.zip</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id39">
<h3>修正<a class="headerlink" href="#id39" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>インデックス内のデータを大量に追加、削除、更新した際にインデックスが破損することがある問題を修正しました。</p>
<ul>
<li><p>この問題は、インデックス内のデータを大量に削除しただけでも発生します。ただ、インデックスにデータを追加しただけでは発生しません。</p></li>
<li><p>この問題によって破損したインデックスは、インデックスを再構築することで修復できます。</p></li>
<li><p>この問題は、壊れたインデックスを参照しない限り発覚しません。したがって、既にインデックスが破損しているかもしれません。</p></li>
<li><p>[<a class="reference internal" href="../reference/commands/index_column_diff.html"><span class="doc">index_column_diff</span></a>] コマンドを使うことで、インデックスが破損しているかどうかを確認できます。</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-1-3-2022-01-29">11.1.3リリース - 2022-01-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improvements">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fixes">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#known-issues">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thanks">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-1-1-2021-12-29">11.1.1リリース - 2021-12-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-1-0-2021-11-29">11.1.0リリース - 2021-11-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-9-2021-11-04">11.0.9リリース - 2021-11-04</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">既知の問題</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-7-2021-09-29">11.0.7リリース - 2021-09-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-6-2021-08-29">11.0.6リリース - 2021-08-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-5-2021-07-29">11.0.5リリース - 2021-07-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-4-2021-06-29">11.0.4リリース - 2021-06-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-3-2021-05-29">11.0.3リリース - 2021-05-29</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-2-2021-05-10">11.0.2リリース - 2021-05-10</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-1-2021-03-31">11.0.1リリース - 2021-03-31</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">修正</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">既知の問題</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">感謝</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#release-11-0-0-2021-02-09">11.0.0リリース - 2021-02-09</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">改良</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">修正</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2009-2024 Groonga Project.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>